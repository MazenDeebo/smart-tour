/*! SDK Interface v25.11.2_webgl-1327-g527db53a6e */var e={846:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"Floorplans"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"assets"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"floorplans"},arguments:[{kind:"Argument",name:{kind:"Name",value:"provider"},value:{kind:"StringValue",value:"Matterport",block:!1}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"validUntil"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"filename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"format"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"height"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"width"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"resolution"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"origin"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"x"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"y"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"floor"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"flags"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"provider"},arguments:[],directives:[]}]}}]}}]}}]}}],loc:{start:0,end:402}};t.loc.source={body:'query Floorplans($modelId: ID!) {\n  model(id: $modelId) {\n    id\n    assets {\n      floorplans(provider: "Matterport") {\n        id\n        status\n        url\n        validUntil\n        filename\n        format\n        height\n        width,\n        resolution,\n        origin {\n          x,\n          y\n        }\n        floor {\n          id\n        }\n        flags\n        provider\n      }\n    }\n  }\n}\n',name:"GraphQL request",locationOffset:{line:1,column:1}};function n(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var a=e.type;"NamedType"===a.kind&&t.add(a.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){n(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){n(e,t)})),e.definitions&&e.definitions.forEach((function(e){n(e,t)}))}var a={};function o(e,t){for(var n=0;n<e.definitions.length;n++){var a=e.definitions[n];if(a.name&&a.name.value==t)return a}}t.definitions.forEach((function(e){if(e.name){var t=new Set;n(e,t),a[e.name.value]=t}})),e.exports=t,e.exports.Floorplans=function(e,t){var n={kind:e.kind,definitions:[o(e,t)]};e.hasOwnProperty("loc")&&(n.loc=e.loc);var s=a[t]||new Set,r=new Set,i=new Set;for(s.forEach((function(e){i.add(e)}));i.size>0;){var c=i;i=new Set,c.forEach((function(e){r.has(e)||(r.add(e),(a[e]||new Set).forEach((function(e){i.add(e)})))}))}return r.forEach((function(t){var a=o(e,t);a&&n.definitions.push(a)})),n}(t,"Floorplans")}},t={};function n(a){var o=t[a];if(void 0!==o)return o.exports;var s=t[a]={exports:{}};return e[a](s,s.exports,n),s.exports}n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var a={};n.d(a,{m:()=>ld});const o="$ExternalCommands",s="$CwfTypes",r="$Libs",i="IAnalytics",c="ILayersModule",d="ITranslate",l="IPolicyModule",u="IRoomBoundDataModule",h="IRoomBoundModule",p="ISweepDataModule";var m,g,f,w,y,v,T,I,b,E,S,C,A,O,D,M,x,R,P;!function(e){let t,n,a,o;!function(e){e.PHASE_CHANGE="application.phasechange"}(t=e.Event||(e.Event={})),function(e){e.UNINITIALIZED="appphase.uninitialized",e.WAITING="appphase.waiting",e.LOADING="appphase.loading",e.STARTING="appphase.starting",e.PLAYING="appphase.playing",e.ERROR="appphase.error"}(n=e.Phase||(e.Phase={})),function(e){e.UNKNOWN="application.unknown",e.WEBVR="application.webvr",e.SHOWCASE="application.showcase",e.WORKSHOP="application.workshop"}(a=e.Application||(e.Application={})),function(e){e.RoomBounds="feature.roombounds",e.Defurnish="feature.defurnish"}(o=e.Feature||(e.Feature={}))}(m||(m={})),function(e){let t,n;!function(e){e.MOVE="camera.move"}(t=e.Event||(e.Event={})),function(e){e.FORWARD="FORWARD",e.LEFT="LEFT",e.RIGHT="RIGHT",e.BACK="BACK",e.UP="UP",e.DOWN="DOWN"}(n=e.Direction||(e.Direction={}))}(g||(g={})),function(e){let t;!function(e){let t,n,a;!function(e){e.TO_API="coordinatesToAPI",e.TO_SDK="coordinatesToSDK"}(t=e.Coordinates||(e.Coordinates={})),function(e){e.TO_API="sweepRotationToAPI",e.TO_SDK="sweepRotationToSDK"}(n=e.SweepRotation||(e.SweepRotation={})),function(e){e.TO_API="cameraRotationToAPI",e.TO_SDK="cameraRotationToSDK"}(a=e.CameraRotation||(e.CameraRotation={}))}(t=e.TransformType||(e.TransformType={}))}(f||(f={})),function(e){let t;!function(e){e.CHANGE_START="floors.changestart",e.CHANGE_END="floors.changeend"}(t=e.Event||(e.Event={}))}(w||(w={})),function(e){let t;!function(e){e.SUCCESS="astar.status.success",e.NO_PATH="astar.status.no_path",e.TIMEOUT="astar.status.timeout",e.NO_START_VERTEX="astar.status.no_start",e.NO_END_VERTEX="astar.status.no_end"}(t=e.AStarStatus||(e.AStarStatus={}))}(y||(y={})),function(e){let t;!function(e){e.POSITION_UPDATED="label.positionupdated"}(t=e.Event||(e.Event={}))}(v||(v={})),function(e){let t,n,a;!function(e){e.WINDOW="link.creationpolicy.window",e.REFERRER="link.creationpolicy.referrer",e.MATTERPORT="link.creationpolicy.matterport"}(t=e.CreationPolicy||(e.CreationPolicy={})),function(e){e.DEFAULT="link.openpolicy.default",e.NEW_WINDOW="link.openpolicy.newwindow",e.SAME_FRAME="link.openpolicy.sameframe",e.CURRENT_WINDOW="link.openpolicy.current"}(n=e.OpenPolicy||(e.OpenPolicy={})),function(e){e.DEFAULT="link.destination.default",e.MATTERPORT="link.destination.matterport"}(a=e.DestinationPolicy||(e.DestinationPolicy={}))}(T||(T={})),function(e){let t,n,a,o,s;!function(e){e.INSTANT="transition.instant",e.FLY="transition.fly",e.FADEOUT="transition.fade"}(t=e.Transition||(e.Transition={})),function(e){e.NAVIGATION="tag.link.nav",e.MODEL="tag.link.model",e.EXT_LINK="tag.link.ext"}(n=e.LinkType||(e.LinkType={})),function(e){e.NONE="tag.chunk.none",e.TEXT="tag.chunk.text",e.LINK="tag.chunk.link"}(a=e.DescriptionChunkType||(e.DescriptionChunkType={})),function(e){e.HOVER="tag.hover",e.CLICK="tag.click",e.LINK_OPEN="tag.linkopen"}(o=e.Event||(e.Event={})),function(e){e.NONE="mattertag.media.none",e.PHOTO="mattertag.media.photo",e.VIDEO="mattertag.media.video",e.RICH="mattertag.media.rich"}(s=e.MediaType||(e.MediaType={}))}(I||(I={})),function(e){let t,n,a;!function(e){e.INSIDE="mode.inside",e.OUTSIDE="mode.outside",e.DOLLHOUSE="mode.dollhouse",e.FLOORPLAN="mode.floorplan",e.TRANSITIONING="mode.transitioning"}(t=e.Mode||(e.Mode={})),function(e){e.CHANGE_START="viewmode.changestart",e.CHANGE_END="viewmode.changeend"}(n=e.Event||(e.Event={})),function(e){e.INSTANT="transition.instant",e.FLY="transition.fly",e.FADEOUT="transition.fade"}(a=e.TransitionType||(e.TransitionType={}))}(b||(b={})),function(e){let t;!function(e){e.MODEL_LOADED="model.loaded"}(t=e.Event||(e.Event={}))}(E||(E={})),function(e){let t;!function(e){e.NONE="intersectedobject.none",e.MODEL="intersectedobject.model",e.TAG="intersectedobject.tag",e.SWEEP="intersectedobject.sweep",e.UNKNOWN="intersectedobject.unknown"}(t=e.Colliders||(e.Colliders={}))}(S||(S={})),function(e){let t,n;!function(e){e.CAMERA="sensor.sensortype.camera"}(t=e.SensorType||(e.SensorType={})),function(e){e.SPHERE="sensor.sourcetype.sphere",e.BOX="sensor.sourcetype.box",e.CYLINDER="sensor.sourcetype.cylinder"}(n=e.SourceType||(e.SourceType={}))}(C||(C={})),function(e){let t,n,a,o;!function(e){e.ENTER="sweep.enter",e.EXIT="sweep.exit"}(t=e.Event||(e.Event={})),function(e){e.INSTANT="transition.instant",e.FLY="transition.fly",e.FADEOUT="transition.fade"}(n=e.Transition||(e.Transition={})),function(e){e.ALIGNED="aligned",e.UNALIGNED="unaligned"}(a=e.Alignment||(e.Alignment={})),function(e){e.UNPLACED="unplaced",e.AUTO="auto",e.MANUAL="manual"}(o=e.Placement||(e.Placement={}))}(A||(A={})),function(e){let t;!function(e){e.UNKNOWN="tag.attachment.unknown",e.APPLICATION="tag.attachment.application",e.AUDIO="tag.attachment.audio",e.IMAGE="tag.attachment.image",e.MODEL="tag.attachment.model",e.PDF="tag.attachment.pdf",e.RICH="tag.attachment.rich",e.TEXT="tag.attachment.text",e.VIDEO="tag.attachment.video",e.ZIP="tag.attachment.zip",e.SANDBOX="tag.attachment.sandbox"}(t=e.AttachmentType||(e.AttachmentType={}))}(O||(O={})),function(e){let t,n;!function(e){e.STARTED="tour.started",e.STOPPED="tour.stopped",e.ENDED="tour.ended",e.STEPPED="tour.stepped"}(t=e.Event||(e.Event={})),function(e){e.INACTIVE="tour.inactive",e.ACTIVE="tour.active",e.STOP_SCHEDULED="tour.stopscheduled"}(n=e.PlayState||(e.PlayState={}))}(D||(D={})),function(e){let t,n;!function(e){e.BASE="viewtype.base",e.LAYERED_BASE="viewtype.layeredbase",e.USER="viewtype.user",e.DEFURNISH="viewtype.defurnish",e.OTHER="viewtype.other"}(t=e.ViewType||(e.ViewType={})),function(e){e.BASE="layertype.base",e.VIEW_DATA="layertype.viewdata",e.USER="layertype.user",e.IN_MEMORY="layertype.inmemory",e.OTHER="layertype.other"}(n=e.LayerType||(e.LayerType={}))}(M||(M={})),function(e){let t,n,a;!function(e){e.OBJ_LOADER="mp.objLoader",e.FBX_LOADER="mp.fbxLoader",e.DAE_LOADER="mp.daeLoader",e.GLTF_LOADER="mp.gltfLoader",e.SCROLLING_TUBE="mp.scrollingTube",e.TRANSFORM_CONTROLS="mp.transformControls",e.LIGHTS_COMPONENT="mp.lights",e.POINT_LIGHT="mp.pointLight",e.DIRECTIONAL_LIGHT="mp.directionalLight",e.AMBIENT_LIGHT="mp.ambientLight",e.CAMERA="mp.camera",e.INPUT="mp.input",e.XR="mp.xr"}(t=e.Component||(e.Component={})),function(e){e.CLICK="INTERACTION.CLICK",e.HOVER="INTERACTION.HOVER",e.DRAG="INTERACTION.DRAG",e.DRAG_BEGIN="INTERACTION.DRAG_BEGIN",e.DRAG_END="INTERACTION.DRAG_END",e.POINTER_MOVE="INTERACTION.POINTER_MOVE",e.POINTER_BUTTON="INTERACTION.POINTER_BUTTON",e.SCROLL="INTERACTION.SCROLL",e.KEY="INTERACTION.KEY",e.LONG_PRESS_START="INTERACTION.LONG_PRESS_START",e.LONG_PRESS_END="INTERACTION.LONG_PRESS_END",e.MULTI_SWIPE="INTERACTION.MULTI_SWIPE",e.MULTI_SWIPE_END="INTERACTION.MULTI_SWIPE_END",e.PINCH="INTERACTION.PINCH",e.PINCH_END="INTERACTION.PINCH_END",e.ROTATE="INTERACTION.ROTATE",e.ROTATE_END="INTERACTION.ROTATE_END"}(n=e.InteractionType||(e.InteractionType={})),function(e){e.INPUT="input",e.OUTPUT="output",e.EVENT="event",e.EMIT="emit"}(a=e.PathType||(e.PathType={}))}(x||(x={})),function(e){let t;!function(e){e.ON="on",e.OFF="off"}(t=e.Visibility||(e.Visibility={}))}(R||(R={}));class N{constructor(e){this.directionMap={[g.Direction.FORWARD]:e.FORWARD.clone(),[g.Direction.LEFT]:e.LEFT.clone(),[g.Direction.RIGHT]:e.RIGHT.clone(),[g.Direction.BACK]:e.BACK.clone(),[g.Direction.UP]:e.UP.clone(),[g.Direction.DOWN]:e.DOWN.clone()}}toVector(e){return this.directionMap[e]}}class _{constructor(e){this.CwfViewmode=e}toSdk(e,t,n){switch(e){case this.CwfViewmode.Panorama:return t?b.Mode.INSIDE:b.Mode.OUTSIDE;case this.CwfViewmode.Dollhouse:return n?b.Mode.FLOORPLAN:b.Mode.DOLLHOUSE;case this.CwfViewmode.Floorplan:return b.Mode.FLOORPLAN;case this.CwfViewmode.Transition:return b.Mode.TRANSITIONING;case this.CwfViewmode.Outdoor:return b.Mode.OUTSIDE;default:return b.Mode.INSIDE}}fromSdk(e){switch(e){case b.Mode.INSIDE:case b.Mode.OUTSIDE:return this.CwfViewmode.Panorama;case b.Mode.DOLLHOUSE:return this.CwfViewmode.Dollhouse;case b.Mode.FLOORPLAN:return this.CwfViewmode.Floorplan;case b.Mode.TRANSITIONING:return this.CwfViewmode.Transition}}}class k{constructor(e){this.CommandMode=e}toSdk(e){switch(e){case this.CommandMode.INSIDE:return b.Mode.INSIDE;case this.CommandMode.DOLLHOUSE:return b.Mode.DOLLHOUSE;case this.CommandMode.FLOORPLAN:return b.Mode.FLOORPLAN;case this.CommandMode.TRANSITIONING:return b.Mode.TRANSITIONING;case this.CommandMode.OUTSIDE:return b.Mode.OUTSIDE;default:return b.Mode.INSIDE}}fromSdk(e){switch(e){case b.Mode.INSIDE:return this.CommandMode.INSIDE;case b.Mode.OUTSIDE:return this.CommandMode.OUTSIDE;case b.Mode.DOLLHOUSE:return this.CommandMode.DOLLHOUSE;case b.Mode.FLOORPLAN:return this.CommandMode.FLOORPLAN;case b.Mode.TRANSITIONING:return this.CommandMode.TRANSITIONING}}}!function(e){e.INSTANT="transition.instant",e.FLY="transition.fly",e.FADEOUT="transition.fade",e.MOVEFADE="transition.movefade",e.ORBIT="transition.orbit"}(P||(P={}));class L{constructor(e){this.toSdkTransitionMap={[e.Interpolate]:P.FLY,[e.FadeToBlack]:P.FADEOUT,[e.Instant]:P.INSTANT,[e.MoveToBlack]:P.MOVEFADE,[e.OrbitTo]:P.ORBIT},this.fromSdkTransitionMap={[P.FLY]:e.Interpolate,[P.FADEOUT]:e.FadeToBlack,[P.INSTANT]:e.Instant,[P.MOVEFADE]:e.MoveToBlack,[P.ORBIT]:e.OrbitTo}}toSdkTransition(e){return this.toSdkTransitionMap[e]}fromSdkTransition(e){return this.fromSdkTransitionMap[e]}}class V{constructor(e){this.THREE=e,this.tempEuler=new e.Euler}quaternionToRotation(e,t){const n=this.tempEuler.setFromQuaternion(e,V.eulerOrder),a=t||{};return a.x=this.THREE.MathUtils.radToDeg(n.x),a.y=this.THREE.MathUtils.radToDeg(n.y),a.z=this.THREE.MathUtils.radToDeg(n.z),a}rotationToQuaternion(e,t){const n=t||new this.THREE.Quaternion;return this.tempEuler.x=this.THREE.MathUtils.degToRad(e.x),this.tempEuler.y=this.THREE.MathUtils.degToRad(e.y),this.tempEuler.z=this.THREE.MathUtils.degToRad(e.z||0),this.tempEuler.order=V.eulerOrder,n.setFromEuler(this.tempEuler)}}V.eulerOrder="YXZ";class F{constructor(e){this.CwfSweepAlignmentType=e}isSweepAligned(e,t){if(!e||!t)return!1;const n=t&&e.getSweep(t);return!!n&&n.alignmentType===this.CwfSweepAlignmentType.ALIGNED}isCurrentSweepAligned(e){return this.isSweepAligned(e,e.state.currentSweep)}}class U{constructor(e){this.sweepData=e}getIdForSweep(e){return e.platformId}getSweepForId(e){return this.sweepData.getSweep(e)}getIdFromCwfId(e){const t=this.sweepData.getSweep(e);return this.getIdForSweep(t)}}class G{constructor(e){this.floorData=e}getIdForFloor(e){return e.id}getFloorForId(e){return this.floorData.getFloor(e)}getIdFromCwfId(e){const t=this.floorData.getFloor(e);return this.getIdForFloor(t)}}class H{constructor(e){this.roomData=e}getIdForRoom(e){return e.id}getRoomForId(e){return this.roomData.get(e)}getIdFromCwfId(e){const t=this.roomData.get(e);return this.getIdForRoom(t)}}class B{constructor(){this.observers=new Set}observe(e){this.observers.add(e);const t=this;return{renew(){t.observers.add(e)},cancel(){t.removeObserver(e)}}}removeObserver(e){this.observers.delete(e)}notify(){for(const e of this.observers)e.notify()}}class z{constructor(...e){this.fulfilledOptionals=[],this.observable=new B,this.dependencies=e||[]}static createWithOptionals(e,t){const n=new z(...e);n.fulfilledOptionals.length=t.length;for(let e=0;e<t.length;++e){let a;n.fulfilledOptionals[e]={get:()=>a};const o=t[e];Promise.all([o]).then((([e])=>{a=e,n.notify()}))}return n}static getBuilder(){class e{constructor(){this.dependencies=[],this.optionals=[]}addDependencies(...t){const n=new e,a=[...this.dependencies,...t];return n.dependencies=a,n.optionals=this.optionals,n}addOptionals(...t){const n=new e,a=[...this.optionals,...t];return n.dependencies=this.dependencies,n.optionals=a,n}build(){return z.createWithOptionals(this.dependencies,this.optionals)}}return new e}static get none(){return this._none}async getDependencies(){return Promise.all(this.dependencies)}getOptionals(){return this.fulfilledOptionals}onOptionalsFulfilled(e){return this.observable.observe({notify:e})}notify(){this.observable.notify()}static extend(e,...t){return new z(...e.dependencies,...t)}static combine(e,t){return new z(...e.dependencies,...t.dependencies)}static async createFromDI(e,t,n){const a=await Promise.all(t.map((t=>e.resolve(t)))),o=n?n(...a):a;return new z(...o)}}z._none=new z;class ${constructor(e,...t){this.ctor=e,this.args=t}create(...e){return new this.ctor(...this.args,...e)}}const j=window.navigationStart||Date.now(),q=new WeakMap;var W;!function(e){e[e.ERROR=0]="ERROR",e[e.WARN=1]="WARN",e[e.INFO=2]="INFO",e[e.DEBUG=3]="DEBUG"}(W||(W={}));class K{static for(e){let t=q.get(e);if(!t){const n=e.name||e.constructor.name;t=new K(n),q.set(e,t)}return t}constructor(e){this.timers={},this.handlers={[W.DEBUG]:console.debug,[W.INFO]:console.info,[W.WARN]:console.warn,[W.ERROR]:console.error};const t=e.split(new RegExp("/|\\\\"));this.prefix="["+t[t.length-1].replace(".js","")+"]"}message(e){if(K.level>=e&&console){return(this.handlers[e]?this.handlers[e]:console.log).bind(console,this.getPrefix())}return()=>{}}get debug(){return this.message(W.DEBUG)}get devInfo(){return()=>{}}get debugInfo(){return this.debug}get warnError(){return this.warn}get debugWarn(){return this.message(K.level>=W.DEBUG?W.WARN:W.DEBUG)}get info(){return this.message(W.INFO)}get warn(){return this.message(W.WARN)}get error(){return this.message(W.ERROR)}get assert(){return(e,...t)=>{if(e)return;const n="Assertion failed";0===t.length?t=[n]:"string"==typeof t[0]?t[0]=n+": "+t[0]:t.unshift(n);this.message(W.ERROR)(...t)}}time(e){K.level>=W.DEBUG&&(this.timers[e]=Date.now())}timeEnd(e){if(K.level>=W.DEBUG){const t=this.timers[e];if(!t)return;const n=(Date.now()-t)/1e3;this.debug(e,n+"s")}}getPrefix(){const e=(Date.now()-j)/1e3+"s";return`${this.prefix} ${e}`}}K.level=W.INFO;const Y=new K("sdk command");class X{static async create(e,t){const n=await e.getDependencies(),a=e.getOptionals();return new X("function"==typeof t?t(...n,...a):t.create(...n,...a))}static async createDI(e,t,n,a){const o=a?await z.createFromDI(e,t,a):await z.createFromDI(e,t),s=await o.getDependencies();return new X(n(...s))}constructor(e){this._executor=e}get executor(){return this._executor}validateInput(e,t){return this.executor.validateInput(e,t)}exec(e,t){const n=this.executor.validateInput(e,t);return this.executor.exec(n,t)}}function Z(e,t,n){return`'${e}' is expected to be a(n) ${t}; got '${JSON.stringify(n)}'`}function Q(e,t,n){return e.validateInput(t,n)}function J(e,t,n){return e.exec(t,n)}async function ee(e,t){return new class{constructor(e){this.command=e}validateInput(e,t){return Q(this.command,e,t)}exec(e,n){return Y.warn(t),this.command.exec(e,n)}}(await e)}function te(e){return!!e&&"string"==typeof e}function ne(e){return"string"==typeof e}const ae=["dev-app.matterport.com","dev-app.matterportvr.cn","qa3-app.matterport.com","qa3-app.matterportvr.cn","gc1-app.matterport.com","my.matterport.com","my.matterportvr.cn","showcase-next.matterport.com","static.matterport.com","static.matterportvr.cn","static.matterport.us","matterport.github.io","local-dev.matterport.com","127.0.0.1","localhost"];class oe{constructor(e){this.getModelViewsQuery=e}validateInput(e,t){return te(e.spaceSid)||this.throw(Z("spaceSid","string",e.spaceSid)),{spaceSid:e.spaceSid}}async exec(e,t){return await this.getModelViewsQuery(e.spaceSid)}throw(e){throw Error("Api.getViews: "+e)}}class se{constructor(e){this.toSdkPhaseMap={[e.UNINITIALIZED]:m.Phase.UNINITIALIZED,[e.WAITING]:m.Phase.WAITING,[e.LOADING]:m.Phase.LOADING,[e.STARTING]:m.Phase.STARTING,[e.PLAYING]:m.Phase.PLAYING,[e.ERROR]:m.Phase.ERROR},this.fromSdkPhaseMap={[m.Phase.UNINITIALIZED]:e.UNINITIALIZED,[m.Phase.WAITING]:e.WAITING,[m.Phase.LOADING]:e.LOADING,[m.Phase.STARTING]:e.STARTING,[m.Phase.PLAYING]:e.PLAYING,[m.Phase.ERROR]:e.ERROR}}toSdkAppPhase(e){return this.toSdkPhaseMap[e]}fromSdkAppPhase(e){return this.fromSdkPhaseMap[e]}}class re{constructor(e){this.toSdkApplicationMap={[e.SHOWCASE]:m.Application.SHOWCASE,[e.WORKSHOP]:m.Application.WORKSHOP,[e.WEBVR]:m.Application.WEBVR,[e.UNKNOWN]:m.Application.UNKNOWN},this.fromSdkApplicationMap={[m.Application.SHOWCASE]:e.SHOWCASE,[m.Application.WORKSHOP]:e.WORKSHOP,[m.Application.WEBVR]:e.WEBVR,[m.Application.UNKNOWN]:e.UNKNOWN}}toSdkApplication(e){return this.toSdkApplicationMap[e]}fromSdkApplication(e){return this.fromSdkApplicationMap[e]}}const ie="IAppPhaseModule",ce="ISettingsModule";class de{static async create(e,t,n){const a=await e.getDependencies();return new de(a,e,t,n)}static async createDI(e,t,n,a,o){const s=o?await z.createFromDI(e,t,o):await z.createFromDI(e,t);return this.create(s,n,a)}constructor(e,t,n,a){this.dependencies=e,this.optionals=t,this.subscriptionFactory=n,this.observers=new Set,this.currentData=a.create(),this.freshDataCache=a.create()}getData(){return this.currentData.data}subscribe(e){return this.addObserver(e),new class{constructor(e){this.sdkObservable=e,this.renew()}renew(){this.sdkObservable.addObserver(e)}cancel(){this.sdkObservable.removeObserver(e)}}(this)}addObserver(e){if(!this.observers.has(e)){class t{constructor(e){this.observable=e}onChanged(){this.observable.onChanged()}}if(this.observers.add(e),1===this.observers.size){const e=()=>{const e=this.optionals.getOptionals();this.currentData.update(...this.dependencies,...e),this.changeSubscription=this.subscriptionFactory.create(new t(this),...this.dependencies,...e)};this.dependencySubscription=this.optionals.onOptionalsFulfilled((()=>{var t;null===(t=this.changeSubscription)||void 0===t||t.cancel(),e()})),e()}e.dirty=!0}}removeObserver(e){0!==this.observers.size&&(this.observers.delete(e),0===this.observers.size&&(this.dependencySubscription.cancel(),this.changeSubscription.cancel()))}onChanged(){if(this.freshDataCache.update(...this.dependencies,...this.optionals.getOptionals()),!this.currentData.equals(this.freshDataCache)){this.currentData.copy(this.freshDataCache);for(const e of this.observers)e.dirty=!0}}}const le=e=>"propertyObservers"===e||"changeObservers"===e||"isObservable"===e||"childChangeFunctions"===e||"isObservableProxy"===e||"diffRoot"===e||"elementChangedHandlers"===e||"knownKeysMap"===e||"knownKeysList"===e||"isVector2"===e||"isVector3"===e||"isQuaternion"===e||"onPropertyChanged"===e||"removeOnPropertyChanged"===e||"onChanged"===e||"target"===e,ue=(e,t=[])=>{if(void 0!==e){if(t.includes(e))return Array.isArray(e)||ArrayBuffer.isView(e)?[]:{};if(e instanceof Date)return new Date(e);if(null===e)return null;if(e.deepCopy)return e.deepCopy();if(e.isQuaternion)return{x:e.x,y:e.y,z:e.z,w:e.w};if(ArrayBuffer.isView(e))for(const t of[Float32Array,Float64Array,Int8Array,Int16Array,Int32Array,Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array])if(e instanceof t)return new t(e);if("object"==typeof e){const n=Array.isArray(e)||ArrayBuffer.isView(e)?[]:{};for(const a in e){if(le(a))continue;const o=e[a];o instanceof Date?n[a]=new Date(o):"function"!=typeof o&&(t.push(e),n[a]="object"==typeof o?ue(o,t):o,t.pop())}return n}return e}},he=(e,t)=>{if(null===e||"object"!=typeof e)return e!==t;if(!t)return!0;for(const n in t)if(!(n in e))return!0;for(const n in e)if(he(e[n],t[n]))return!0;return!1};class pe{create(e,t){return t.onChanged((()=>e.onChanged()))}}class me{constructor(e,t){this._data={phase:m.Phase.UNINITIALIZED,phaseTimes:{},application:m.Application.SHOWCASE},this.AppPhase=e.AppPhase,this.appPhaseConverter=t.appPhaseConverter,this.applicationConverter=t.applicationConverter}get data(){return this._data}equals(e){return!he(this,e)}copy(e){this._data.phase=e.data.phase,function(e,t,...n){for(const a of n)e[a]=t[a]}(this.data.phaseTimes,e.data.phaseTimes),this._data.application=e.data.application}update(e){this._data.phase=this.appPhaseConverter.toSdkAppPhase(e.phase),this._data.application=this.applicationConverter.toSdkApplication(e.application),this._data.phaseTimes[m.Phase.WAITING]=e.phaseTimes[this.AppPhase.WAITING],this._data.phaseTimes[m.Phase.LOADING]=e.phaseTimes[this.AppPhase.LOADING],this._data.phaseTimes[m.Phase.PLAYING]=e.phaseTimes[this.AppPhase.PLAYING],this._data.phaseTimes[m.Phase.STARTING]=e.phaseTimes[this.AppPhase.STARTING],this._data.phaseTimes[m.Phase.UNINITIALIZED]=e.phaseTimes[this.AppPhase.UNINITIALIZED],this._data.phaseTimes[m.Phase.ERROR]=e.phaseTimes[this.AppPhase.ERROR]}}class ge{get id(){return this.constructor.id}}class fe extends ge{constructor(){super()}}fe.id="GET_APP_STATE";class we extends ge{constructor(){super()}}var ye,ve,Te;function Ie(e){return e.viewType===ye.DEFURNISH}we.id="GET_APP_PHASE_TIMES",function(e){e.BASE="base",e.LAYERED_BASE="layered-base",e.INSIGHTS="insights",e.USER="user",e.DEFURNISH="defurnish",e.SESSION="session",e.DIGIPRO_SESSION="digipro-session",e.TRUEPLAN="trueplan",e.PRIVATE_SESSION="bundle-session",e.COMPOSITE="composite",e.OTHER="other"}(ye||(ye={})),function(e){e.BASE_LAYER="matterport.base",e.VIEW_DATA_LAYER="matterport.user.data",e.USER_LAYER="matterport.user.data.ext",e.OVERLAY_ASSETS_LAYER="matterport.overlay.assets",e.COMMON_USER_LAYER="matterport.user.data.common",e.PROXY_LAYER="matterport.proxy.common",e.IN_MEMORY="matterport.in-memory",e.COMMON_IN_MEMORY="matterport.in-memory.common",e.WORKSHOP="matterport.workshop.jsonstore",e.OTHER="other layer type",e.COMPOSITE_BASE="matterport.base.composite",e.COMPOSITE_USER_LAYER="matterport.user.data.ext.composite",e.COMPOSITE_VIEW_DATA_LAYER="matterport.user.data.composite"}(ve||(ve={})),function(e){e.TYPE="type",e.FLOOR="floor",e.ROOM="room",e.LAYER="layer",e.DATE="date"}(Te||(Te={}));const be="model-views-feature",Ee="data-layers-feature";var Se;!function(e){e.DISABLED="disabled",e.VIEWS_OPTIONAL_OPT_IN="user_views",e.VIEWS_ENABLED="views_enabled",e.VIEWS_AND_LAYERS="views_layers",e.LAYERS_ONLY="layers"}(Se||(Se={}));var Ce;!function(e){e.DISABLED="0",e.VIEWS_ENABLED="2",e.VIEWS_AND_LAYERS="3",e.LAYERS_ONLY="4"}(Ce||(Ce={}));const Ae=new K("Subscription");class Oe{constructor(e,t,n=!1,a=""){this.startSubscription=e,this.endSubscription=t,this.id=a,this.isSubbed=!1,n&&this.renew()}renew(){this.isSubbed?Ae.debugWarn(`Duplicate subscription renew ${this.id}`):(this.startSubscription(),this.isSubbed=!0)}cancel(){this.isSubbed&&(this.endSubscription(),this.isSubbed=!1)}get active(){return this.isSubbed}}function De(e,t,n=!0,a=""){return new Oe(e,t,n,a)}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var Me=function(e,t){return Me=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},Me(e,t)};function xe(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}Me(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function Re(e,t,n,a){return new(n||(n=Promise))((function(o,s){function r(e){try{c(a.next(e))}catch(e){s(e)}}function i(e){try{c(a.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,i)}c((a=a.apply(e,t||[])).next())}))}function Pe(e,t){var n,a,o,s,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(s){return function(i){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(o=2&s[0]?a.return:s[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,s[1])).done)return o;switch(a=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,a=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(!(o=r.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){r=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){r.label=s[1];break}if(6===s[0]&&r.label<o[1]){r.label=o[1],o=s;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(s);break}o[2]&&r.ops.pop(),r.trys.pop();continue}s=t.call(e,r)}catch(e){s=[6,e],a=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,i])}}}Object.create;function Ne(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],a=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&a>=e.length&&(e=void 0),{value:e&&e[a++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function _e(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var a,o,s=n.call(e),r=[];try{for(;(void 0===t||t-- >0)&&!(a=s.next()).done;)r.push(a.value)}catch(e){o={error:e}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(o)throw o.error}}return r}function ke(e,t){for(var n=0,a=t.length,o=e.length;n<a;n++,o++)e[o]=t[n];return e}function Le(e){return this instanceof Le?(this.v=e,this):new Le(e)}function Ve(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var a,o=n.apply(e,t||[]),s=[];return a={},r("next"),r("throw"),r("return"),a[Symbol.asyncIterator]=function(){return this},a;function r(e){o[e]&&(a[e]=function(t){return new Promise((function(n,a){s.push([e,t,n,a])>1||i(e,t)}))})}function i(e,t){try{(n=o[e](t)).value instanceof Le?Promise.resolve(n.value.v).then(c,d):l(s[0][2],n)}catch(e){l(s[0][3],e)}var n}function c(e){i("next",e)}function d(e){i("throw",e)}function l(e,t){e(t),s.shift(),s.length&&i(s[0][0],s[0][1])}}function Fe(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=Ne(e),t={},a("next"),a("throw"),a("return"),t[Symbol.asyncIterator]=function(){return this},t);function a(n){t[n]=e[n]&&function(t){return new Promise((function(a,o){(function(e,t,n,a){Promise.resolve(a).then((function(t){e({value:t,done:n})}),t)})(a,o,(t=e[n](t)).done,t.value)}))}}}Object.create;function Ue(e){return"function"==typeof e}function Ge(e){var t=e((function(e){Error.call(e),e.stack=(new Error).stack}));return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var He=Ge((function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}));function Be(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var ze=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}var t;return e.prototype.unsubscribe=function(){var e,t,n,a,o;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var r=Ne(s),i=r.next();!i.done;i=r.next()){i.value.remove(this)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}else s.remove(this);var c=this.initialTeardown;if(Ue(c))try{c()}catch(e){o=e instanceof He?e.errors:[e]}var d=this._finalizers;if(d){this._finalizers=null;try{for(var l=Ne(d),u=l.next();!u.done;u=l.next()){var h=u.value;try{qe(h)}catch(e){o=null!=o?o:[],e instanceof He?o=ke(ke([],_e(o)),_e(e.errors)):o.push(e)}}}catch(e){n={error:e}}finally{try{u&&!u.done&&(a=l.return)&&a.call(l)}finally{if(n)throw n.error}}}if(o)throw new He(o)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)qe(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&Be(t,e)},e.prototype.remove=function(t){var n=this._finalizers;n&&Be(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e}(),$e=ze.EMPTY;function je(e){return e instanceof ze||e&&"closed"in e&&Ue(e.remove)&&Ue(e.add)&&Ue(e.unsubscribe)}function qe(e){Ue(e)?e():e.unsubscribe()}var We={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Ke={setTimeout:function(e,t){for(var n=[],a=2;a<arguments.length;a++)n[a-2]=arguments[a];var o=Ke.delegate;return(null==o?void 0:o.setTimeout)?o.setTimeout.apply(o,ke([e,t],_e(n))):setTimeout.apply(void 0,ke([e,t],_e(n)))},clearTimeout:function(e){var t=Ke.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function Ye(e){Ke.setTimeout((function(){var t=We.onUnhandledError;if(!t)throw e;t(e)}))}function Xe(){}var Ze=Qe("C",void 0,void 0);function Qe(e,t,n){return{kind:e,value:t,error:n}}var Je=null;function et(e){if(We.useDeprecatedSynchronousErrorHandling){var t=!Je;if(t&&(Je={errorThrown:!1,error:null}),e(),t){var n=Je,a=n.errorThrown,o=n.error;if(Je=null,a)throw o}}else e()}var tt=function(e){function t(t){var n=e.call(this)||this;return n.isStopped=!1,t?(n.destination=t,je(t)&&t.add(n)):n.destination=ct,n}return xe(t,e),t.create=function(e,t,n){return new st(e,t,n)},t.prototype.next=function(e){this.isStopped?it(function(e){return Qe("N",e,void 0)}(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?it(Qe("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?it(Ze,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(ze),nt=Function.prototype.bind;function at(e,t){return nt.call(e,t)}var ot=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){rt(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){rt(e)}else rt(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){rt(e)}},e}(),st=function(e){function t(t,n,a){var o,s,r=e.call(this)||this;Ue(t)||!t?o={next:null!=t?t:void 0,error:null!=n?n:void 0,complete:null!=a?a:void 0}:r&&We.useDeprecatedNextContext?((s=Object.create(t)).unsubscribe=function(){return r.unsubscribe()},o={next:t.next&&at(t.next,s),error:t.error&&at(t.error,s),complete:t.complete&&at(t.complete,s)}):o=t;return r.destination=new ot(o),r}return xe(t,e),t}(tt);function rt(e){var t;We.useDeprecatedSynchronousErrorHandling?(t=e,We.useDeprecatedSynchronousErrorHandling&&Je&&(Je.errorThrown=!0,Je.error=t)):Ye(e)}function it(e,t){var n=We.onStoppedNotification;n&&Ke.setTimeout((function(){return n(e,t)}))}var ct={closed:!0,next:Xe,error:function(e){throw e},complete:Xe},dt="function"==typeof Symbol&&Symbol.observable||"@@observable";function lt(e){return e}function ut(e){return 0===e.length?lt:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}var ht=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var a,o=this,s=(a=e)&&a instanceof tt||function(e){return e&&Ue(e.next)&&Ue(e.error)&&Ue(e.complete)}(a)&&je(a)?e:new st(e,t,n);return et((function(){var e=o,t=e.operator,n=e.source;s.add(t?t.call(s,n):n?o._subscribe(s):o._trySubscribe(s))})),s},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=pt(t))((function(t,a){var o=new st({next:function(t){try{e(t)}catch(e){a(e),o.unsubscribe()}},error:a,complete:t});n.subscribe(o)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[dt]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return ut(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=pt(e))((function(e,n){var a;t.subscribe((function(e){return a=e}),(function(e){return n(e)}),(function(){return e(a)}))}))},e.create=function(t){return new e(t)},e}();function pt(e){var t;return null!==(t=null!=e?e:We.Promise)&&void 0!==t?t:Promise}var mt="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function gt(e){if(e instanceof ht)return e;if(null!=e){if(function(e){return Ue(e[dt])}(e))return r=e,new ht((function(e){var t=r[dt]();if(Ue(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if((s=e)&&"number"==typeof s.length&&"function"!=typeof s)return o=e,new ht((function(e){for(var t=0;t<o.length&&!e.closed;t++)e.next(o[t]);e.complete()}));if(Ue(null==(a=e)?void 0:a.then))return n=e,new ht((function(e){n.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,Ye)}));if(function(e){return Symbol.asyncIterator&&Ue(null==e?void 0:e[Symbol.asyncIterator])}(e))return ft(e);if(function(e){return Ue(null==e?void 0:e[mt])}(e))return t=e,new ht((function(e){var n,a;try{for(var o=Ne(t),s=o.next();!s.done;s=o.next()){var r=s.value;if(e.next(r),e.closed)return}}catch(e){n={error:e}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}e.complete()}));if(function(e){return Ue(null==e?void 0:e.getReader)}(e))return ft(function(e){return Ve(this,arguments,(function(){var t,n,a;return Pe(this,(function(o){switch(o.label){case 0:t=e.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,Le(t.read())];case 3:return n=o.sent(),a=n.value,n.done?[4,Le(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,Le(a)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}(e))}var t,n,a,o,s,r;throw function(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}(e)}function ft(e){return new ht((function(t){(function(e,t){var n,a,o,s;return Re(this,void 0,void 0,(function(){var r,i;return Pe(this,(function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),n=Fe(e),c.label=1;case 1:return[4,n.next()];case 2:if((a=c.sent()).done)return[3,4];if(r=a.value,t.next(r),t.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return i=c.sent(),o={error:i},[3,11];case 6:return c.trys.push([6,,9,10]),a&&!a.done&&(s=n.return)?[4,s.call(n)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(o)throw o.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))}))})(e,t).catch((function(e){return t.error(e)}))}))}var wt=Ge((function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),yt=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return xe(t,e),t.prototype.lift=function(e){var t=new vt(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new wt},t.prototype.next=function(e){var t=this;et((function(){var n,a;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var o=Ne(t.currentObservers),s=o.next();!s.done;s=o.next()){s.value.next(e)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}}}))},t.prototype.error=function(e){var t=this;et((function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var n=t.observers;n.length;)n.shift().error(e)}}))},t.prototype.complete=function(){var e=this;et((function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}}))},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,n=this,a=n.hasError,o=n.isStopped,s=n.observers;return a||o?$e:(this.currentObservers=null,s.push(e),new ze((function(){t.currentObservers=null,Be(s,e)})))},t.prototype._checkFinalizedStatuses=function(e){var t=this,n=t.hasError,a=t.thrownError,o=t.isStopped;n?e.error(a):o&&e.complete()},t.prototype.asObservable=function(){var e=new ht;return e.source=this,e},t.create=function(e,t){return new vt(e,t)},t}(ht),vt=function(e){function t(t,n){var a=e.call(this)||this;return a.destination=t,a.source=n,a}return xe(t,e),t.prototype.next=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===n||n.call(t,e)},t.prototype.error=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===n||n.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,n;return null!==(n=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==n?n:$e},t}(yt);function Tt(e){return function(t){if(function(e){return Ue(null==e?void 0:e.lift)}(t))return t.lift((function(t){try{return e(t,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")}}function It(e,t){for(var n=[],a=2;a<arguments.length;a++)n[a-2]=arguments[a];if(!0!==t){if(!1!==t){var o=new st({next:function(){o.unsubscribe(),e()}});return gt(t.apply(void 0,ke([],_e(n)))).subscribe(o)}}else e()}class bt{constructor(){this.isObservable=!0,this._dirtyObservable=!1,this._activeObservable=!0,this._observerNotifying=!1,this._changeObservers=new Set,this._parentObservables=new Set,this._childObservables=new Set,Object.defineProperties(this,{isObservable:{value:this.isObservable,writable:!1,enumerable:!1},_dirtyObservable:{value:this._dirtyObservable,enumerable:!1},_activeObservable:{value:this._activeObservable,enumerable:!1},_observerNotifying:{value:this._observerNotifying,enumerable:!1},_changeObservers:{value:this._changeObservers,writable:!1,enumerable:!1},_childObservables:{value:this._childObservables,writable:!1,enumerable:!1},_parentObservables:{value:this._parentObservables,writable:!1,enumerable:!1}})}onChanged(e){if(this._changeObservers.has(e))throw new Error("This observer function is already observing this Observable, and double subscriptions are not supported.");return De((()=>this._changeObservers.add(e)),(()=>this.removeOnChanged(e)),!0)}removeOnChanged(e){this._changeObservers.delete(e)}notifyObservers(){if(this._dirtyObservable&&!this._observerNotifying&&this._activeObservable){this._observerNotifying=!0;for(const e of this._changeObservers)this.notifyObserver(e);this._dirtyObservable=!1,this._observerNotifying=!1}}notifyObserver(e){e(void 0)}notifyDown(){for(const e of this._childObservables)e.notifyDown();this.notifyObservers()}notifyUp(){for(const e of this._parentObservables)e.notifyUp();this.notifyObservers()}setDirty(e=!0){this.setDirtyUp(),e&&this.notifyUp()}setDirtyUp(){if(!this._dirtyObservable){this._dirtyObservable=!0;for(const e of this._parentObservables)e.setDirtyUp()}}addChildObservable(e){bt.isObservable(e)&&(this._childObservables.add(e),e._parentObservables.add(this))}removeChildObservables(e){bt.isObservable(e)&&(this._childObservables.delete(e),e._parentObservables.delete(this))}atomic(e){if(!this._activeObservable)return e();try{this.setActive(!1),e()}finally{this.setActive(!0)}}setActive(e){const t=this._activeObservable;this._activeObservable=e,!t&&e&&this.notifyObservers();for(const t of this._childObservables)t.setActive(e)}deepCopy(){throw Error("deepCopy is only implemented in subclasses of Observable")}get asRxJS$(){return this._rxJS$||(this._rxJS$=new ht((e=>{const t=this.onChanged((t=>{e.next(t)}));return()=>{this._rxJS$=null,t.cancel()}})).pipe(function(e){void 0===e&&(e={});var t=e.connector,n=void 0===t?function(){return new yt}:t,a=e.resetOnError,o=void 0===a||a,s=e.resetOnComplete,r=void 0===s||s,i=e.resetOnRefCountZero,c=void 0===i||i;return function(e){var t,a,s,i=0,d=!1,l=!1,u=function(){null==a||a.unsubscribe(),a=void 0},h=function(){u(),t=s=void 0,d=l=!1},p=function(){var e=t;h(),null==e||e.unsubscribe()};return Tt((function(e,m){i++,l||d||u();var g=s=null!=s?s:n();m.add((function(){0!=--i||l||d||(a=It(p,c))})),g.subscribe(m),!t&&i>0&&(t=new st({next:function(e){return g.next(e)},error:function(e){l=!0,u(),a=It(h,o,e),g.error(e)},complete:function(){d=!0,u(),a=It(h,r),g.complete()}}),gt(e).subscribe(t))}))(e)}}({connector:()=>new yt,resetOnRefCountZero:!0}))),this._rxJS$}static isObservable(e){return e&&e.isObservable}}const Et=new K("ObservableObject"),St=1===function(e,t=null,n=typeof t){return function(e,t=null,n=typeof t){if(null===e)return t;if("boolean"===n)return"true"===e||"1"===e;if("number"===n)return+e;if("object"===n&&t instanceof Array)return""===e?t:e.split(",");return e}(new URLSearchParams(window.location.search).get(e),t,n)}("debug",0);const Ct=new Map;if(St){const e=setInterval((()=>{(function(){for(const e of Ct.values())for(const t in e)return Et.error(`ObservableObject property "${t}" was still dirty after one tick! Did you forget a .commit()?`),Et.error("See stack trace of the property write below:"),Et.error(e[t].stack),!0;return!1})()&&void 0!==e&&clearInterval(e)}),16)}var At,Ot,Dt,Mt,xt;!function(e){e.black="black",e.grey="grey",e.white="white",e.default="black"}(At||(At={})),function(e){e.IMPERIAL="imperial",e.METRIC="metric"}(Ot||(Ot={}));!function(e){e[e.Pan=0]="Pan",e[e.PanDollhouse=1]="PanDollhouse",e[e.Zoom=2]="Zoom",e[e.Delay=3]="Delay",e[e.None=4]="None"}(Dt||(Dt={})),function(e){e[e.Left=1]="Left",e[e.Auto=0]="Auto",e[e.Right=-1]="Right"}(Mt||(Mt={})),function(e){e[e.Move=0]="Move",e[e.Burns=1]="Burns",e[e.Zoom=2]="Zoom",e[e.Path=3]="Path",e[e.FloorChange=4]="FloorChange",e[e.Delay=5]="Delay",e[e.Nop=6]="Nop"}(xt||(xt={}));xt.Burns,xt.Zoom,xt.Delay;var Rt;!function(e){e[e.Panorama=1]="Panorama",e[e.Dollhouse=2]="Dollhouse",e[e.Floorplan=3]="Floorplan",e[e.Outdoor=4]="Outdoor",e[e.Orthographic=5]="Orthographic",e[e.Mesh=6]="Mesh",e[e.Transition=-1]="Transition"}(Rt||(Rt={}));Rt.Dollhouse,Rt.Panorama;var Pt,Nt;!function(e){e.BASE="base",e.STANDARD="standard",e.HIGH="high",e.ULTRAHIGH="ultrahigh"}(Pt||(Pt={})),function(e){e[e.BASE=512]="BASE",e[e.STANDARD=1024]="STANDARD",e[e.HIGH=2048]="HIGH",e[e.ULTRAHIGH=4096]="ULTRAHIGH"}(Nt||(Nt={}));Pt.BASE,Nt.BASE,Pt.STANDARD,Nt.STANDARD,Pt.HIGH,Nt.HIGH,Pt.ULTRAHIGH,Nt.ULTRAHIGH,Nt.BASE,Pt.BASE,Nt.STANDARD,Pt.STANDARD,Nt.HIGH,Pt.HIGH,Nt.ULTRAHIGH,Pt.ULTRAHIGH,Pt.BASE,Object.freeze({maxSweepDistance:1/0,maxRaycastDistance:10,maxDistanceBeforeAddingSweeps:3,minSweepDistance:1.5,maxSidestepDistance:.4,pathRadius:.1,maxTotalSteps:40}),Mt.Auto;var _t;!function(e){e.DefurnishView="defurnish_view",e.PresentedBy="presented_by",e.HighlightReel="highlight_reel",e.FloorPlan="floor_plan",e.RoomBounds="room_bounds",e.TourButtons="tour_buttons",e.Labels="labels",e.LabelsDollhouse="labels_dh",e.Measurements="measurements",e.FloorSelect="floor_select",e.SavedMeasurements="measurements_saved",e.Dollhouse="dollhouse",e.InstantTransitions="fast_transitions",e.TransitionSpeed="transition_speed",e.TransitionTime="transition_time",e.PanSpeed="pan_speed",e.DollhousePanSpeed="dollhouse_pan_speed",e.PanAlignment="pan_alignment",e.ZoomDuration="zoom_duration",e.PanAngle="pan_angle",e.PanDirection="pan_direction",e.Units="unit_type",e.DetailsEmail="contact_email",e.DetailsAddress="address",e.DetailsName="contact_name",e.DetailsSummary="model_summary",e.DetailsPhone="contact_phone",e.DetailsModelName="model_name",e.DetailsExternalUrl="external_url",e.BackgroundColor="background_color",e.SpaceSearch="space_search"}(_t||(_t={}));function kt(e){return e.tryGetSetting(_t.RoomBounds,!1)}class Lt{constructor(...e){this.subs=e}renew(){for(const e of this.subs)e.renew()}cancel(){for(const e of this.subs)e.cancel()}}class Vt{constructor(){this.rooms=0,this.rbError=!1,this.views=[],this.layers=[]}create(e,t,n,a){return new Lt(t.onChanged((()=>this.throttleSettingsDataChanges(e,t))),n.onChanged((()=>this.throttleRoomBoundDataChanges(e,n))),a.onChanged((()=>this.throttleLayersDataDataChanges(e,a))))}throttleRoomBoundDataChanges(e,t){const n=t.rooms.size;this.rooms!==n&&e.onChanged()}throttleSettingsDataChanges(e,t){const n=t.tryGetSetting("SETTING_RB_ERROR_GETTING_USER_VIEW",!1);this.rbError!==n&&e.onChanged()}throttleLayersDataDataChanges(e,t){let n=!1;const a=t.getOrderedModelViews();for(const e of a)if(!this.views.includes(e)){n=!0;break}this.views=a;const o=t.getCurrentUserLayers();for(const e of o)if(!this.layers.includes(e)){n=!0;break}this.layers=o,n&&e.onChanged()}}class Ft{constructor(){this._data={[m.Feature.RoomBounds]:void 0,[m.Feature.Defurnish]:void 0}}get data(){return this._data}equals(e){return Object.entries(e.data).every((([e,t])=>this.data[e]===t))}copy(e){for(const[t,n]of Object.entries(e.data))this.data[t]=n}update(e,t,n){const a=e.tryGetSetting("SETTING_RB_ERROR_GETTING_USER_VIEW",!1),o=t.rooms.size;var s;this.data[m.Feature.Defurnish]=!!(null===(s=n.getOrderedModelViews({includeDefurnish:!0,includeDisabled:!1}).filter((e=>Ie(e))).find((e=>Ie(e))))||void 0===s?void 0:s.id),this.data[m.Feature.RoomBounds]=kt(e)&&!a&&o>0}}var Ut;!function(e){e.POSTMESSAGE="postmessage",e.DIRECT="direct",e.WEBSOCKET="websocket"}(Ut||(Ut={}));const Gt={$id:"records",type:"object",minProperties:1,maxProperties:6,additionalProperties:{type:["string","number","boolean"]},required:[]},Ht={$id:"options",type:"object",properties:{alwaysTrack:{type:"boolean",nullable:!0},version:{type:"number"},records:{$ref:"records"}},required:[],additionalProperties:!1},Bt={$id:"payload",type:"object",properties:{name:{type:"string"},options:{$ref:"options"}},required:["name"],additionalProperties:!1};class zt{constructor(e,t){this.sdk=e,this.jsonSchemaValidator=t}validateInput(e,t){this.validate||(this.jsonSchemaValidator.addSchema([Bt,Gt,Ht]),this.validate=this.jsonSchemaValidator.getSchema("payload"));if(!this.validate(e)){const t=this.jsonSchemaValidator.prettify(this.validate,{data:e,colors:!1});throw Error(t)}return e}async exec(e,t){var n,a,o;const s={version:(null===(n=null==e?void 0:e.options)||void 0===n?void 0:n.version)||1,alwaysTrack:(null===(a=null==e?void 0:e.options)||void 0===a?void 0:a.alwaysTrack)||!1,records:(null===(o=null==e?void 0:e.options)||void 0===o?void 0:o.records)||{}};return this.sdk.track(t,e.name,s)}}class $t{constructor(e){this.localeInterface=e}validateInput(e,t){return e}async exec(e,t){return this.localeInterface.languageCode}}class jt{constructor(e){this.localeInterface=e}validateInput(e,t){return e}async exec(e,t){return this.localeInterface.t.bind(this.localeInterface)}}var qt,Wt;!function(e){e[e.LOW=0]="LOW",e[e.MEDIUM=1]="MEDIUM",e[e.HIGH=2]="HIGH",e[e.HIGHEST=3]="HIGHEST"}(qt||(qt={})),function(e){e[e.PENDING=0]="PENDING",e[e.SENDING=1]="SENDING",e[e.FAILED=2]="FAILED",e[e.DONE=3]="DONE"}(Wt||(Wt={}));const Kt=new WeakMap;class Yt{constructor({retries:e=0,concurrency:t=6}={}){this.totalBytesDownloaded=0,this.queue=[],this.retries=e,this.concurrency=t}get(e,t){return this.request("GET",e,t)}head(e,t){return this.request("HEAD",e,t)}options(e,t){return this.request("OPTIONS",e,t)}post(e,t){return this.request("POST",e,t)}put(e,t){return this.request("PUT",e,t)}patch(e,t){return this.request("PATCH",e,t)}delete(e,t){return this.request("DELETE",e,t)}request(e,t,n){const a=new Xt(e,t,n);if(null==n?void 0:n.signal){const e=()=>{this.queue.includes(a)&&(a.status===Wt.SENDING&&a.abort(),this.dequeue(a),a.onFail(new DOMException("Aborted","AbortError")))};n.signal.addEventListener("abort",e),Kt.set(a,(()=>{var t;null===(t=n.signal)||void 0===t||t.removeEventListener("abort",e),Kt.delete(a)}))}return this.enqueue(a),a.promise}update(){let e;for(;e=this.getNextPendingRequest();)this.sendRequest(e);for(;e=this.getNextOverflowingGet();)e.abort(),e.status=Wt.PENDING;this.updateTimeout=null}enqueue(e){let t=0;for(t=0;t<this.queue.length;t++){if(this.queue[t].priority<e.priority)break}this.queue.splice(t,0,e),this.updateTimeout||(this.updateTimeout=window.setTimeout((()=>{this.update()}),1))}dequeue(e){var t;null===(t=Kt.get(e))||void 0===t||t();const n=this.queue.indexOf(e);if(-1===n)throw new Error("Can't dequeue request not in queue");this.queue.splice(n,1),this.update()}getNextPendingRequest(){for(let e=0;e<this.queue.length&&e<this.concurrency;e++){const t=this.queue[e];if(t.status===Wt.PENDING)return t}return null}getNextOverflowingGet(){for(let e=this.concurrency;e<this.queue.length;e++){const t=this.queue[e];if(t.status===Wt.SENDING&&t.priority!==qt.HIGHEST&&"GET"===t.method)return t}return null}shouldRetryStatusCode(e){return!Yt.doNotRetryStatusCodes[e]}sendRequest(e){e.status=Wt.SENDING,e.send().then((t=>{e.status=Wt.DONE,this.dequeue(e),e.contentLength&&e.contentLength>0&&(this.totalBytesDownloaded+=Number(e.contentLength)),e.onDone(t)})).catch((t=>{const n=null!==e.maxRetries?e.maxRetries:this.retries;let a=e.sendAttempts<n;if("object"==typeof t){const e=t.status_code||0;a=a&&this.shouldRetryStatusCode(e)}a?(e.status=Wt.PENDING,this.update(),console.warn(`Retried ${e.url}`),console.warn(t)):(e.status=Wt.FAILED,this.dequeue(e),console.warn(`Failed ${e.url}`),e.onFail(t))}))}}Yt.doNotRetryStatusCodes={400:!0,401:!0,403:!0,404:!0,405:!0,406:!0,410:!0,411:!0,414:!0,415:!0,421:!0,431:!0,451:!0};class Xt{constructor(e,t,n={}){this.sendAttempts=0,this.status=Wt.PENDING,this.contentLength=0,this.isAborting=!1,this.url=t,this.method=e,this.auth=n.auth||null,this.withCredentials=n.withCredentials||!1,this.priority=n.priority||qt.MEDIUM,this.responseType=n.responseType||null,this.body=n.body||null,this.headers=n.headers||{},this.maxRetries=n.maxRetries||null,this.onProgress=n.onProgress,this.promise=new Promise(((e,t)=>{this.onDone=e,this.onFail=t}))}send(){const e=this.xhr=function(e,t,n){let a;if("undefined"!=typeof XMLHttpRequest)a=new XMLHttpRequest,a.withCredentials=n;else{if("undefined"==typeof XDomainRequest)throw new Error("No XMLHTTPRequest or XDomainRequest... are you trying to run me in node? :(");a=new XDomainRequest}return a.open(e,t,!0),a}(this.method,this.url,this.withCredentials);if(this.responseType)if("arraybuffer"===this.responseType||"text"===this.responseType||"json"===this.responseType||"blob"===this.responseType)e.responseType=this.responseType;else{if("image"!==this.responseType)throw new Error('reponseType can only be one of "arraybuffer", "text", "json", "blob", "image"');e.responseType="blob"}"json"===this.responseType&&e.setRequestHeader("Accept","application/json"),this.auth&&"string"==typeof this.auth&&e.setRequestHeader("Authorization",this.auth);for(const t in this.headers)e.setRequestHeader(t,this.headers[t]);return this.body&&"object"==typeof this.body&&(this.body instanceof FormData||(this.body=JSON.stringify(this.body),e.setRequestHeader("Content-Type","application/json"))),this.onProgress&&(e.onprogress=this.onProgress),new Promise(((t,n)=>{e.onreadystatechange=()=>{if(4===e.readyState){if(200===e.status||201===e.status||204===e.status)return this.parseResponse(this.xhr).then((e=>{t(e)}));if(!this.isAborting)return this.parseResponse(this.xhr).then((t=>{n(Object.assign({status_code:e.status},t))})).catch((()=>{n({status_code:e.status})}));this.isAborting=!1}},e.onerror=function(e){n(e)},e.send(this.body),this.sendAttempts++}))}parseResponse(e){return new Promise(((t,n)=>{var a;try{if(!e)throw new Error(`No request received. Trying ${this.method} on ${this.url} and expecting ${this.responseType}, but request was ${this.xhr}`);let n=e.response;if(this.contentLength=parseInt(null!==(a=e.getResponseHeader("Content-Length"))&&void 0!==a?a:"0",10),"json"===this.responseType&&"object"!=typeof n)t(JSON.parse(e.responseText));else if(200!==e.status&&201!==e.status&&204!==e.status||"image"!==this.responseType)t(n);else{const e=URL.createObjectURL(n);n=new Image,n.onload=function(){URL.revokeObjectURL(e),t(n)},n.src=e,n.crossOrigin="Anonymous"}}catch(e){n({error:"Payload was not valid JSON"})}}))}abort(){if(null===this.xhr)throw new Error("Cannot abort unsent Request");this.isAborting=!0,this.xhr.abort()}}const Zt=K;class Qt{constructor(){this.base=new Promise(((e,t)=>{this.resolver=e,this.rejecter=t})),this._promise=new Jt(this.base,this),this.progressCallbacks=[]}then(e,t){return this.base.then(e,t)}catch(e){return this.base.catch(e)}resolve(e){return this.resolver(e),this}reject(e){return this.rejecter(e),this}notify(e){for(const t of this.progressCallbacks)t(e)}progress(e){return this.progressCallbacks.push(e),this}promise(){return this._promise}nativePromise(){return this.base}static resolve(){const e=new Qt;return e.resolve(),e.promise()}static reject(e){const t=new Qt;return t.reject(e),t.promise()}static all(e){const t=[];for(const n of e)n.nativePromise?t.push(n.nativePromise()):t.push(n);const n=new Qt;return Promise.all(t).then((e=>n.resolve(e)),(e=>n.reject(e))),n.promise()}}class Jt{constructor(e,t){this.basePromise=e,this.baseDeferred=t}then(e,t){return this.baseDeferred.then(e,t),this}catch(e){return this.baseDeferred.catch(e),this}progress(e){return this.baseDeferred.progress(e),this}nativePromise(){return this.basePromise}}const en=new Zt("asset.registerTexture");class tn{constructor(e,t,n){this.THREE=e,this.loadImage=t,this.scopedTextures=n,this.svgLoader=new nn(new Yt)}validateInput(e,t){const{textureId:n,textureSrc:a}=e;if(!te(n))throw Error(`textureId ${n} is not a valid string`);if(!te(a))throw Error(`textureSrc ${a} is not a valid string`);const o=this.scopedTextures.get(t.client.applicationKey);if(o){if(o.map[n])throw Error(n+" already has a registered texture")}return{textureId:n,textureSrc:a}}async exec(e,t){const{textureId:n,textureSrc:a}=e,o=this.scopedTextures.get(t.client.applicationKey)||{imagePromise:{},map:{}};this.scopedTextures.set(t.client.applicationKey,o);const[s,r]=a.endsWith(".svg")?this.loadSvgTexture(a):this.loadImageTexture(a);o.imagePromise[n]=r;try{const e=await r;s.image=e,s.needsUpdate=!0,o.map[n]=s}catch(t){throw delete o.imagePromise[n],Error(`Failed to load ${e.textureSrc}`)}}loadImageTexture(e){const t=new Qt,n=this.loadImage(e,(()=>t.resolve(n.image)),(e=>t.reject(e)));return[n,t.nativePromise()]}loadSvgTexture(e){const t=new this.THREE.Texture;t.colorSpace=this.THREE.SRGBColorSpace;return[t,this.svgLoader.load(e)]}}class nn{constructor(e){this.queue=e}async load(e){const t=await this.queue.get(e,{responseType:"text"}),n=document.createElement("div");n.innerHTML=t;const a=n.querySelector("svg");if(!a)throw Error("Failed trying to load "+e+"as an svg.");const o=a.getAttribute("width"),s=a.getAttribute("height");return o||s?(s&&!o&&(en.warn(e,"does not have a defined width. Defaulting width equal to height"),a.setAttribute("width",s)),o&&!s&&(en.warn(e,"does not have a defined height. Defaulting height equal to width"),a.setAttribute("height",o))):(en.warn(e,"does not have a defined size. Defaulting to a 128x128 resolution"),a.setAttribute("width",nn.defaultResolution),a.setAttribute("height",nn.defaultResolution)),new Promise((e=>{const t=new Image;t.onload=()=>e(t),t.src=URL.createObjectURL(new Blob([a.outerHTML],{type:"image/svg+xml"}))}))}}nn.defaultResolution="128";var an,on,sn,rn,cn=n(846);!function(e){e.PHOTO="photo",e.RICH="rich",e.VIDEO="video"}(an||(an={})),function(e){e.COMMENT="comment",e.MATTERTAG="mattertag"}(on||(on={})),function(e){e.ALPHA="alpha",e.COLORED_ROOMS="colored_rooms",e.MEASUREMENTS="measurements",e.PHOTOGRAMY="photogramy",e.SCHEMATIC="schematic"}(sn||(sn={})),function(e){e.AVAILABLE="available",e.LOCKED="locked",e.UNAVAILABLE="unavailable"}(rn||(rn={}));class dn{constructor(e,t,n){this.floorData=e,this.modelData=t,this.apiClient=n}validateInput(e){const{sid:t}=e;if(!t)return{sid:this.modelData.model.sid};if(te(t))return{sid:t};throw Error(`"${t}" is not a valid sid string`)}async exec(e,t){var n,a,o,s,r,i,c,d,l;const u=this.floorData.getFloorIdMap(!1),h=await this.apiClient.query(cn.Floorplans,{modelId:e.sid});(null===(o=null===(a=null===(n=null==h?void 0:h.data)||void 0===n?void 0:n.model)||void 0===a?void 0:a.assets)||void 0===o?void 0:o.floorplans)||this.throw("error fetching floorplans");const p=[];for(const e of null===(r=null===(s=h.data)||void 0===s?void 0:s.model)||void 0===r?void 0:r.assets.floorplans){let t=!1,n=!1;for(const a of e.flags)a===sn.PHOTOGRAMY&&(t=!0),a===sn.ALPHA&&(n=!0);if(t&&n){const t=null===(i=e.url)||void 0===i?void 0:i.search("vr_colorplan");if(t&&-1!==t){const t=null===(c=null==e?void 0:e.floor)||void 0===c?void 0:c.id;if(t){const n=u[t];p[parseInt(n,10)]=e}}}}const m=[];for(const e of p)if(e.url){const t=fetch(e.url).then((e=>e.arrayBuffer()));m.push(t)}return{imageDataUrls:(await Promise.all([...m]).catch((e=>this.throw(e)))).map((e=>(e=>{const t=[];for(let n=0;n<e.length;n+=8192)t.push(String.fromCharCode.apply(null,e.subarray(n,n+8192)));return btoa(t.join(""))})(new Uint8Array(e)))),data:{height:p[0].height||100,imageOriginX:(null===(d=p[0].origin)||void 0===d?void 0:d.x)||0,imageOriginY:(null===(l=p[0].origin)||void 0===l?void 0:l.y)||0,resolutionPpm:p[0].resolution||100,width:p[0].width||100}}}throw(e){throw Error("Asset.getVrColorplans: "+e)}}class ln{constructor(e){this.attachmentRegistry=e}validateInput(e,t){return te(e.id)||this.throw(Z("tagId","string",e.id)),this.attachmentRegistry.get(t.client.applicationKey,e.id)||this.throw(`${e.id} does not map to a valid asset`),e}async exec(e,t){const n=this.attachmentRegistry.get(t.client.applicationKey,e.id);return n||this.throw(`${e.id} does not map to a valid asset`),n}throw(e){throw Error("Asset.getAssetById: "+e)}}class un{constructor(e){this.attachmentRegistry=e}validateInput(e,t){return e}exec(){return this.attachmentRegistry.refresh()}}function hn(e,t,n,a,o,s){const{floorData:r,modelData:i,modelApiClient:c}=o,d=function(e,t){const n=X.create(t,new $(dn));return e.addAsyncCommandToInterface({namespace:"Asset",name:"getVrColorplans",args:["sid"],origins:ae},n),n}(e,new z(r,i,c)),l=function(e,t,n,a){const o=X.create(a,new $(tn,t,n.loadImage));return e.addAsyncCommandToInterface({namespace:"Asset",name:"registerTexture",args:["textureId","textureSrc"]},o),o}(e,t,n,new z(a)),u=function(e,t){const n=X.create(t,new $(ln));return e.addAsyncCommandToInterface({namespace:"Asset",name:"getAssetById",args:["id"],origins:ae},n),n}(e,new z(s)),h=function(e,t){const n=X.create(t,new $(un));return e.addAsyncCommandToInterface({namespace:"Asset",name:"refreshAssets",args:[],origins:ae},n),n}(e,new z(s));return{getVrColorplans:d,registerTexture:l,getAssetById:u,refreshAssets:h}}class pn extends ge{constructor(){super()}}pn.id="GET_POSE";const mn=40*Math.PI/180/1e3;class gn extends ge{constructor(e){super(),this.payload=e}}gn.id="LOOK_AT_SCREEN_COORDS";const fn=new Zt("broadcast.move"),wn=100;function yn(e,t){return Object.values(e).includes(t)}class vn extends ge{constructor(e){super(),this.payload=e}}vn.id="MOVE_DIRECTION";const Tn=.005;class In extends ge{constructor(e){super(),this.payload={x:e.x,z:e.z}}}function bn(e,t){e.x=t.x,e.y=t.y}function En(e,t){bn(e,t),e.z=t.z}In.id="PAN";class Sn extends Error{constructor(e,t){var n;super(e instanceof Error?e.message:e),this.name="BaseException",t&&(this.code=t),e instanceof Error&&(this.originalError=e,(n=e)&&n instanceof Error&&n.isMock&&(this.isMock=!0))}}function Cn(e,t){const n=t.length;e.length=n;for(let a=0;a<n;++a)e[a]=t[a];return e}class An extends Sn{constructor(){super("Cannot copy into an array of a different size"),this.name="ArraySizeMismatch"}}const On=(e,t,n=1e-5)=>Math.abs(e-t)<=n,Dn=(e,t,n=1e-5)=>On(e.x,t.x,n)&&On(e.y,t.y,n),Mn=(e,t,n=1e-5)=>Dn(e,t,n)&&On(e.z,t.z,n);class xn{create(e,t,n,a){const o=()=>e.onChanged();return new Lt(t.onChanged(o),n.onChanged(o),a.onChanged(o))}}class Rn{constructor(e,t){this._data={position:{x:0,y:0,z:0},rotation:{x:0,y:0},projection:new Float32Array(16),sweep:"",mode:b.Mode.TRANSITIONING},this.THREE=e,this.viewmodeConverter=t,this.tempEuler=new e.Euler}get data(){return this._data}equals(e){const t=1e-5;return Mn(e._data.position,this._data.position,t)&&Dn(e._data.rotation,this._data.rotation,t)&&((e,t,n=1e-5)=>e.length===t.length&&!Array.prototype.some.call(e,((e,a)=>!On(e,t[a],n))))(e._data.projection,this._data.projection,t)&&e._data.sweep===this._data.sweep&&e._data.mode===this._data.mode}update(e,t,n,a){const o=this.tempEuler.setFromQuaternion(e.pose.rotation,"YXZ"),s=t.state.currentSweep&&t.isSweepUnaligned(t.state.currentSweep),r=n.isInside()?e.pose.position:e.pose.fovCorrectedPosition();En(this._data.position,r),this._data.rotation.x=this.THREE.MathUtils.radToDeg(o.x),this._data.rotation.y=this.THREE.MathUtils.radToDeg(o.y),this._data.projection=Float32Array.from(e.pose.projection.asThreeMatrix4().transpose().elements),this._data.sweep=t.currentSweepObject?a.getIdForSweep(t.currentSweepObject):"",this._data.mode=this.viewmodeConverter.toSdk(n.currentMode,!s,e.pose.isPitchFactorOrtho)}copy(e){En(this._data.position,e.data.position),bn(this._data.rotation,e.data.rotation),function(e,t){if(e.byteLength!==t.byteLength)throw new An;const n=t.length;for(let a=0;a<n;++a)e[a]=t[a]}(this._data.projection,e.data.projection),this._data.sweep=e.data.sweep,this._data.mode=e.data.mode}}var Pn,Nn,_n,kn,Ln;!function(e){e.Desktop="desktop",e.Mobile="mobile",e.VrOrientOnly="xr.orientonly",e.VrWithController="xr.controller",e.VrWithTrackedController="xr.trackedcontroller",e.VrTransientPointer="xr.transient-pointer",e.VrUnknown="xr."}(Pn||(Pn={})),function(e){e.None="interaction.none",e.Direct="interaction.direct",e.Key="interaction.key",e.Gui="interaction.gui",e.Mouse="interaction.mouse",e.Touch="interaction.touch",e.Pen="interaction.pen",e.XRController="interaction.xr.controller",e.XRGaze="interaction.xr.gaze",e.XRScreen="interaction.xr.screen"}(Nn||(Nn={})),function(e){e[e.Instant=0]="Instant",e[e.FadeToBlack=1]="FadeToBlack",e[e.Interpolate=2]="Interpolate",e[e.MoveToBlack=3]="MoveToBlack",e[e.OrbitTo=4]="OrbitTo"}(_n||(_n={})),function(e){e[e.Full=0]="Full",e[e.ClearToBlack=1]="ClearToBlack",e[e.BlackToClear=2]="BlackToClear"}(kn||(kn={})),function(e){e[e.Top=1]="Top",e[e.Bottom=2]="Bottom"}(Ln||(Ln={}));const Vn=Math.PI/180;Math.PI;Object.freeze({camera:{transitionBlackoutTime:300,transitionFadeTime:800,baseTransitionTime:200,transitionSpeed:3,autoOrbitMinVelocity:.002,autoOrbitMaxVelocity:.08,autoOrbitTransitionTIme:1e3,autoOrbitLowerPhiLimit:30*Vn,autoOrbitUpperPhiLimit:90*Vn}});Pn.Desktop,_n.Interpolate,Pn.Mobile,_n.Interpolate,Pn.VrOrientOnly,_n.FadeToBlack,Pn.VrWithController,_n.FadeToBlack,Pn.VrWithTrackedController,_n.FadeToBlack,Pn.VrTransientPointer,_n.FadeToBlack,Pn.VrUnknown,_n.FadeToBlack;const Fn=75*Vn;function Un(e){return async function(t,n,a){const{x:o,y:s,z:r,w:i}=a.startOrientation,c=new e.Quaternion(o,s,r,i).normalize(),{x:d,y:l,z:u,w:h}=a.endOrientation,p=new e.Quaternion(d,l,u,h).normalize(),m=a.duration||0;await t.rotateBetweenOrientations(!!a.fadeToBlack,c,p,m,a.allowOverlappingTransitions)}}class Gn extends ge{constructor(e){super(),this.payload={xAngle:e.xAngle,yAngle:e.yAngle,zAngle:e.zAngle,rotationSpeed:e.rotationSpeed,clampYRotation:e.clampYRotation}}}Gn.id="ROTATE";class Hn extends ge{constructor(e){super(),this.payload={startOrientation:Object.assign({},e.startOrientation),endOrientation:Object.assign({},e.endOrientation),duration:e.duration,fadeToBlack:e.fadeToBlack,allowOverlappingTransitions:e.allowOverlappingTransitions}}}function Bn(e,t,n){const a=new e.Euler,o=new e.Euler;return async function(e,s,r,i){if(r.currentMode!==t.Panorama)throw Error("Camera.setRotation is only available in Panorama mode");const c=i.xAngle%(.5*Math.PI),d=i.yAngle%(2*Math.PI),l=e.pose.rotation;a.setFromQuaternion(l,"YXZ");let u=d-a.y;return Math.abs(u)>Math.PI&&(u-=2*Math.sign(u)*Math.PI),o.set(c-a.x,u,0,"YXZ"),o.y%=2*Math.PI,n(s,e,{xAngle:-o.y,yAngle:o.x,zAngle:0,rotationSpeed:i.rotationSpeed,clampYRotation:!1})}}Hn.id="ROTATE_BETWEEN_ORIENTATIONS";class zn extends Gn{}function $n(e,t,n,a){const o=t.MathUtils.degToRad(80)/1e3;a.getDependencies().then((([e,t,a])=>{n.addBinding(Gn,(async a=>await n.rotateCamera(e,t,a))),n.addBinding(Hn,(async a=>await n.rotateCameraBetweenOrientations(e,t,a))),n.addBinding(zn,(async o=>await n.orientCamera(t,e,a,o)))}));const s=e=>{const n=(e=e||{}).options||{},a=t.MathUtils.degToRad(e.xAngle||0),s=t.MathUtils.degToRad(e.yAngle||0),r=t.MathUtils.degToRad(e.zAngle||0),i=!!e.clampYRotation;let c=o;if(n.speed){if(isNaN(n.speed)||n.speed<=0)throw new Error(`${JSON.stringify(n)} does not contain valid rotation speed`);c=t.MathUtils.degToRad(n.speed)/1e3}if(isNaN(a)||isNaN(s)||isNaN(r))throw new Error(`${JSON.stringify(e)} does not contain valid rotation angles`);return{xAngle:a,yAngle:s,zAngle:r,rotationSpeed:c,clampYRotation:i}};e.addCommandCreator({namespace:"Camera",name:"rotate",args:["xAngle","yAngle","options"]},(e=>new Gn(s({xAngle:e.xAngle,yAngle:e.yAngle,zAngle:e.zAngle,options:e.options,clampYRotation:!0})))),e.addCommandCreator({namespace:"Camera",name:"rotateBetweenOrientations",args:["startOrientation","endOrientation","duration","fadeToBlack","allowOverlappingTransitions"]},(e=>new Hn((e=>{const t=e=>null===e.x||isNaN(e.x)||null===e.y||isNaN(e.y)||null===e.z||isNaN(e.z)||null===e.w||isNaN(e.w);if(!(e=e||{}).duration||isNaN(e.duration)||e.duration<=0)throw new Error(`${JSON.stringify(e)} does not contain valid rotation duration`);if(t(e.startOrientation)||t(e.endOrientation))throw new Error(`${JSON.stringify(e)} does not contain valid start and end orientations`);const{x:n,y:a,z:o,w:s}=e.startOrientation,{x:r,y:i,z:c,w:d}=e.endOrientation;return{startOrientation:{x:n,y:a,z:o,w:s},endOrientation:{x:r,y:i,z:c,w:d},duration:e.duration,fadeToBlack:!!e.fadeToBlack,allowOverlappingTransitions:!!e.allowOverlappingTransitions}})({startOrientation:null==e?void 0:e.startOrientation,endOrientation:null==e?void 0:e.endOrientation,duration:e.duration,fadeToBlack:e.fadeToBlack,allowOverlappingTransitions:e.allowOverlappingTransitions})))),e.addCommandCreator({namespace:"Camera",name:"setRotation",args:["rotation","options"]},(e=>{const t=(e=e||{}).rotation||{};return new zn(s({xAngle:t.x,yAngle:t.y,zAngle:t.z,options:e.options,clampYRotation:!1}))}))}zn.id="SET_ORIENTATION";class jn extends ge{}jn.id="STOP";const qn=.7,Wn=3,Kn=function(e,t,n){return Math.max(t,Math.min(e,n))};const Yn=new Zt("command.zoom");class Xn{constructor(e,t,n,a){this.cameraData=n,this.viewmodeData=a,this.Viewmode=e.Viewmode,this.ZoomSetCommand=e.ZoomSetCommand,this.issueCommand=t.issueCommand}validateInput(e){const t=e.zoomPct-0;if(isNaN(t))throw Error(t+" is not a valid zoom level");return t<qn&&Wn<t&&(e.zoomPct=Kn(t,qn,Wn),Yn.warn(t,`is outside the valid zoom range of [${qn}, ${Wn}]`)),e}async exec(e,t){return Jn(this.Viewmode,this.viewmodeData.currentMode),await this.issueCommand(new this.ZoomSetCommand(e.zoomPct)),this.cameraData.zoom()}}class Zn{constructor(e,t,n,a){this.cameraData=n,this.viewmodeData=a,this.Viewmode=e.Viewmode,this.ZoomInCommand=e.ZoomInCommand,this.issueCommand=t.issueCommand}validateInput(e){const t=e.zoomDelta-0;if(isNaN(t))throw Error(t+" is not a valid zoom delta");return e.zoomDelta=t||0,e}async exec(e,t){return Jn(this.Viewmode,this.viewmodeData.currentMode),await this.issueCommand(new this.ZoomInCommand(e.zoomDelta)),this.cameraData.zoom()}}class Qn{constructor(e,t,n,a){this.viewmodeData=a,this.Viewmode=e.Viewmode,this.ZoomResetCommand=e.ZoomResetCommand,this.issueCommand=t.issueCommand}validateInput(e){return e}async exec(e,t){Jn(this.Viewmode,this.viewmodeData.currentMode),await this.issueCommand(new this.ZoomResetCommand)}}function Jn(e,t){if(t!==e.Panorama)throw Error("Zoom controls are currently only supported in Panorama mode")}class ea{create(e,t){return t.onChanged((()=>e.onChanged()))}}class ta{constructor(e){this._data={level:1}}get data(){return this._data}equals(e){return this._data.level===e.data.level}copy(e){this._data.level=e.data.level}update(e,t){t.isInside()&&(this._data.level=e.zoom())}}function na(e,t){const n=new e.Euler;return function(a,o,s,r,i){const c=n.setFromQuaternion(o.pose.rotation,"YXZ"),d=s.state.currentSweep&&s.isSweepUnaligned(s.state.currentSweep);return a.position.x=o.pose.position.x,a.position.y=o.pose.position.y,a.position.z=o.pose.position.z,a.rotation.x=e.MathUtils.radToDeg(c.x),a.rotation.y=e.MathUtils.radToDeg(c.y),a.projection=Float32Array.from(o.pose.projection.asThreeMatrix4().transpose().elements),a.sweep=s.currentSweepObject?i.getIdForSweep(s.currentSweepObject):"",a.mode=t.toSdk(r.currentMode,!d,o.pose.isPitchFactorOrtho),a}}class aa{constructor(){this.wasInTransition=!1,this.currentFloor=""}create(e,t,n,a,o){return new Lt(t.makeFloorChangeSubscription((()=>this.throttleCurrentFloorChanges(e,t))),a.onChanged((()=>this.throttleCameraTranstionChanges(e,a,n,o))),n.onChanged((()=>this.throttleCameraTranstionChanges(e,a,n,o))),o.onChanged((()=>this.throttleCameraTranstionChanges(e,a,n,o))))}throttleCameraTranstionChanges(e,t,n,a){const o=t.transition.active||n.state.transition.active;o!==this.wasInTransition&&(this.wasInTransition=o,e.onChanged())}throttleCurrentFloorChanges(e,t){const n=t.currentFloorId;n!==this.currentFloor&&(this.currentFloor=n,e.onChanged())}}class oa{constructor(e){this._data={id:void 0,sequence:void 0,name:""},this.SweepAlignmentType=e.SweepAlignmentType,this.SweepPlacementType=e.SweepPlacementType}get data(){return this._data}equals(e){const t=this.data,n=e.data;return t.id===n.id&&t.sequence===n.sequence&&t.name===n.name}copy(e){this._data.id=e.data.id,this._data.sequence=e.data.sequence,this._data.name=e.data.name}update(e,t,n,a,o){const s=e.currentFloor,r=t.state.currentSweep&&t.getSweep(t.state.currentSweep);!a.isTourActive()&&n.transition.active&&!t.state.transition.active||function(){if(t.state.transition.active&&t.state.transition.to&&t.state.transition.from){const e=t.getSweep(t.state.transition.to),n=t.getSweep(t.state.transition.from);return e.floorId!==n.floorId}return!1}()?(this._data.id="",this._data.sequence=void 0,this._data.name=""):r&&r.alignmentType===this.SweepAlignmentType.UNALIGNED&&r.placementType===this.SweepPlacementType.UNPLACED?(this._data.id=void 0,this._data.sequence=void 0,this._data.name=""):s?(this._data.id=o.getIdFromCwfId(s.id),this._data.sequence=s.index,this._data.name=s.name):(this._data.id="",this._data.sequence=-1,this._data.name="all")}}class sa{static async create(e,t,n){const a=await e.getDependencies();return new sa(a,e,t,n)}static async createDI(e,t,n,a,o){const s=o?await z.createFromDI(e,t,o):await z.createFromDI(e,t);return this.create(s,n,a)}constructor(e,t,n,a){this.dependencies=e,this.optionals=t,this.subscriptionFactory=n,this.dataFactory=a,this.dirty=!0,this.observers=new Set,this.currentData=a.create(...e,...t.getOptionals());const o=new class{constructor(e){this.collection=e}onChanged(){this.collection.dirty=!0;for(const e of this.collection.observers)e.onChanged()}}(this);this.dependencySubscription=t.onOptionalsFulfilled((()=>{var e;null===(e=this.changeSubscription)||void 0===e||e.cancel(),this.changeSubscription=this.subscriptionFactory.create(o,...this.dependencies,...this.optionals.getOptionals()),o.onChanged()})),this.changeSubscription=this.subscriptionFactory.create(o,...this.dependencies,...this.optionals.getOptionals()),this.changeSubscription.cancel()}getData(){return this.currentData.data}subscribe(e){const t=this.dependencies,n=this.optionals;const a=new class{constructor(e){this.sdkCollection=e,this.needsUpdate=!0,this.diffRecord={added:new Map,removed:new Map,updated:new Map},this.dataView=e.dataFactory.create(...t,...n.getOptionals())}get dirty(){return this.needsUpdate}readDiff(){const{added:t,removed:n,updated:a}=this.diffRecord;if(t.clear(),n.clear(),a.clear(),!this.dirty)return this.diffRecord;this.sdkCollection.update(e);const o=this.sdkCollection.currentData;for(const e in o.data)this.dataView.data.hasOwnProperty(e)?this.dataView.isItemEqual(o,e)||a.set(e,o.data[e]):t.set(e,o.data[e]);for(const e in this.dataView.data)o.data.hasOwnProperty(e)||n.set(e,this.dataView.data[e]);return this.dataView.update(e),this.needsUpdate=!1,this.diffRecord}onChanged(){this.needsUpdate=!0}renew(){this.sdkCollection.addObserver(this)}cancel(){this.sdkCollection.removeObserver(this)}}(this);return this.addObserver(a),a}update(e){this.dirty&&this.observers.size>0&&(this.currentData.update(e),this.dirty=!1)}addObserver(e){0===this.observers.size&&(this.dependencySubscription.renew(),this.changeSubscription.renew(),this.dirty=!0),this.observers.add(e)}removeObserver(e){this.observers.delete(e),0===this.observers.size&&(this.dependencySubscription.cancel(),this.changeSubscription.cancel(),this.currentData.clear())}}class ra{create(e,t){return t.onChanged((()=>e.onChanged()))}}class ia{constructor(e,t){this.floorData=e,this.floorIdMap=t,this._data={}}get data(){return this._data}isItemEqual(e,t){const n=this.data[t],a=e.data[t];return n.id===a.id&&n.name===a.name&&n.sequence===a.sequence}update(){for(const e of this.floorData.getCollection()){const t=this.floorIdMap.getIdFromCwfId(e.id),n=this._data[t]||{};n.id=t,n.sequence=e.index,n.name=e.name,this._data[t]=n}for(const e in this.data){this.floorIdMap.getFloorForId(e)||delete this._data[e]}}clear(){this._data={}}}class ca extends ge{}async function da(e){try{const{currentFloor:t,totalFloors:n}=e,a=e.getFloorNames();return{currentFloor:t?t.index:-1,floorNames:a,totalFloors:n}}catch(e){throw Error("no floors currently loaded")}}ca.id="GET_FLOORS_DATA";class la extends ge{constructor(e){super(),this.payload=e}}la.id="MOVE_TO_FLOOR";class ua{constructor(e,t,n){this.floorsViewData=n,this.issueCommand=t.issueCommand,this.ShowAllFloorsCommand=e.ShowAllFloorsCommand}validateInput(e){return e}async exec(e,t){try{await this.issueCommand(new this.ShowAllFloorsCommand({moveCamera:!0}));const e=this.floorsViewData.currentFloor;return e?e.index:-1}catch(e){throw Error("Could not show all floors")}}}class ha{constructor(e){this.FloorsData=e}validateInput(e){return{invert:!!(null==e?void 0:e.invert)||!1}}async exec(e,t){return this.FloorsData.getFloorIdMap(e.invert)}}class pa extends ge{}function ma(e,t){return function(n,a,o,s){const r=o.getCollection(),i=[],c=new e.Vector2;for(const o of r){t(n,o.position,c);const{id:r,index:d}=a.getFloor(o.floorId),l=s.getIdFromCwfId(r),u=ue(o);i.push(Object.assign(Object.assign({},u),{position:(new e.Vector3).copy(o.position),screenPosition:c,floor:d,floorInfo:{id:l,sequence:d}}))}return i}}pa.id="LABEL_GET";class ga{create(e,t){return t.onChanged((()=>e.onChanged()))}}class fa{constructor(e,t,n){this.labelData=e,this.floorsData=t,this.floorIdMap=n,this._data={}}get data(){return this._data}isItemEqual(e,t){return!he(this.data[t],e.data[t])}update(){var e;for(const t of this.labelData.getCollection()){const n=null!==(e=this.data[t.sid])&&void 0!==e?e:{};n.position=t.position,n.sid=t.sid,n.text=t.text,n.visible=t.visible;const a=this.floorsData.getFloor(t.floorId);n.floorInfo={id:this.floorIdMap.getIdFromCwfId(a.id),sequence:a.index},this.data[n.sid]=n}for(const e in this.data){this.labelData.getLabel(e)||delete this.data[e]}}clear(){this._data={}}}class wa{constructor(e){this.deepLinker=e}validateInput(e){return e}async exec(e,t){const n=this.deepLinker.creator.createLink();return decodeURIComponent(n.href)}}class ya{constructor(e){this.deepLinker=e}validateInput(e){return e}async exec(e,t){const n=this.deepLinker.creator.createDeepLink();return decodeURIComponent(n.href)}}function va(e){return!!e&&"object"==typeof e}function Ta(e){return"boolean"==typeof e}function Ia(e,t,n,a){switch(e){case T.OpenPolicy.DEFAULT:n.handler.resetPolicy(t);break;case T.OpenPolicy.NEW_WINDOW:n.handler.setPolicy(t,n.handler.HandlingPolicy.NEW_WINDOW);break;case T.OpenPolicy.SAME_FRAME:n.handler.setPolicy(t,n.handler.HandlingPolicy.IN_FRAME);break;case T.OpenPolicy.CURRENT_WINDOW:n.handler.setPolicy(t,n.handler.HandlingPolicy.CUSTOM,(e=>{a.sendPrivateMessage("open link",{href:e})}))}}class ba{constructor(e,t,n){this.sdk=e,this.deepLinker=t,this.api=n}validateInput(e){if(!yn(T.OpenPolicy,e.policy))throw Error(`Link.setModelLinkPolicy: ${e.policy} is not a valid Link.OpenPolicy`);if(!te(e.baseHref))throw Error("Link.setModelLinkPolicy: could not determine window.location");if(yn(T.DestinationPolicy,e.destinationPolicy))return{policy:e.policy,baseHref:e.baseHref,destinationPolicy:e.destinationPolicy};const t=va(e.options)?e.options.templateHref:void 0;if(void 0!==t&&!te(t)||te(t)&&new URL(e.baseHref).origin!==new URL(t).origin)throw Error("Link.setModelLinkPolicy: setting the policy to a different domain is not supported");return{policy:e.policy,baseHref:e.baseHref,options:{templateHref:t}}}async exec(e,t){const n=Ea(e,this.api);e.policy!==T.OpenPolicy.NEW_WINDOW&&e.policy!==T.OpenPolicy.CURRENT_WINDOW||!n?Ia(e.policy,this.deepLinker.LinkType.MODEL,this.deepLinker,this.sdk):this.deepLinker.handler.setPolicy(this.deepLinker.LinkType.MODEL,this.deepLinker.handler.HandlingPolicy.CUSTOM,(t=>{const a=new URLSearchParams(window.location.search),o=new URL(t).searchParams;a.set("m",o.get("m")||o.get("model")||"");const s=new URL(Oa(n,a));s.searchParams.set("m",o.get("m")||o.get("model")||""),this.sdk.sendPrivateMessage("open link",{newWindow:e.policy===T.OpenPolicy.NEW_WINDOW,href:decodeURIComponent(s.href)})}))}}function Ea(e,t){var n;if(function(e){return!e.destinationPolicy}(e))return null===(n=e.options)||void 0===n?void 0:n.templateHref;const a=t.getApi().baseUrl;return{[T.DestinationPolicy.DEFAULT]:"",[T.DestinationPolicy.MATTERPORT]:a+"/show/"}[e.destinationPolicy]}class Sa{constructor(e,t,n){this.sdk=e,this.deepLinker=t,this.api=n}validateInput(e){if(!yn(T.OpenPolicy,e.policy))throw Error(`${e.policy} is not a valid Link.OpenPolicy`);if(!te(e.baseHref))throw Error("Link.setNavigationLinkPolicy: could not determine window.location");if(yn(T.DestinationPolicy,e.destinationPolicy))return{policy:e.policy,baseHref:e.baseHref,destinationPolicy:e.destinationPolicy};const t=va(e.options)?e.options.templateHref:void 0;if(void 0!==t&&!te(t)||te(t)&&new URL(e.baseHref).origin!==new URL(t).origin)throw Error("Link.setNavigationLinkPolicy: setting the policy to a different domain is not supported");return{policy:e.policy,baseHref:e.baseHref,options:{templateHref:t}}}async exec(e,t){const n=Ea(e,this.api);e.policy!==T.OpenPolicy.NEW_WINDOW&&e.policy!==T.OpenPolicy.CURRENT_WINDOW||!n?Ia(e.policy,this.deepLinker.LinkType.NAVIGATION,this.deepLinker,this.sdk):this.deepLinker.handler.setPolicy(this.deepLinker.LinkType.NAVIGATION,this.deepLinker.handler.HandlingPolicy.CUSTOM,(t=>{const a=new URLSearchParams(window.location.search),o=new URLSearchParams(t),s=new URL(Oa(n,a));!function(e,t){const[n,a,o,s,r,i,c]=[t.get("sm"),t.get("sp"),t.get("sq"),t.get("sr"),t.get("ss"),t.get("sz"),t.get("start")];te(n)&&e.set("sm",n);te(a)&&e.set("sp",a);te(o)&&e.set("sq",o);te(s)&&e.set("sr",s);te(r)&&e.set("ss",r);te(i)&&e.set("sz",i);te(c)&&e.set("start",c)}(s.searchParams,o),s.searchParams.set("m",o.get("m")||o.get("model")||""),this.sdk.sendPrivateMessage("open link",{newWindow:e.policy===T.OpenPolicy.NEW_WINDOW,href:decodeURIComponent(s.href)})}))}}class Ca{constructor(e,t){this.sdk=e,this.deepLinker=t}validateInput(e){if(!yn(T.OpenPolicy,e.policy))throw Error(`${e.policy} is not a valid Link.OpenPolicy`);return{policy:e.policy}}async exec(e,t){Ia(e.policy,this.deepLinker.LinkType.SAME_ORIGIN,this.deepLinker,this.sdk)}}class Aa{constructor(e,t){this.sdk=e,this.deepLinker=t}validateInput(e){const{openInNewWindow:t}=e;if(!Ta(t))throw Error(`${e.openInNewWindow} is expected to strictly be a boolean to avoid confusion about truth-y and false-y values.`);return{openInNewWindow:t}}async exec(e,t){e.openInNewWindow?this.deepLinker.handler.setPolicy(this.deepLinker.LinkType.EXTERNAL,this.deepLinker.handler.HandlingPolicy.NEW_WINDOW):this.deepLinker.handler.setPolicy(this.deepLinker.LinkType.EXTERNAL,this.deepLinker.handler.HandlingPolicy.CUSTOM,(e=>{this.sdk.sendPrivateMessage("open link",{href:e})}))}}function Oa(e,t){const n=/\$\{([a-zA-Z]+)\}/,a=new URL(e);let o,s=decodeURI(a.pathname);for(;o=s.match(n);){const e=t.get(o[1]);s=s.replace(o[0],`${e}`)}for(a.pathname=s;o=a.search.match(n);){const e=t.get(o[1]);a.search=null!==e||""===e?a.search.replace(o[0],`${o[1]}=${e}`):a.search.replace(o[0],`${o[1]}`)}return a.href}function Da(e,t){return!!Array.isArray(e)&&e.every(t)}class Ma{constructor(e){this.deepLinks=e}validateInput(e){const{policy:t,baseHref:n}=e;if(!yn(T.CreationPolicy,t))throw Error(`Link.setShareLinkPolicy: ${e.policy} is not a valid Link.ShareLinkPolicy`);if(!te(n))throw Error("Link.setShareLinkPolicy: Could not determine window.location");const a=va(e.options)&&e.options.includeParams?e.options.includeParams:[];if(!Da(a,te))throw Error("Link.setShareLinkPolicy: 'includeParams' expects an array of strings");return{policy:t,baseHref:this.validateBaseHref(t,n),options:{includeParams:a}}}validateBaseHref(e,t){const n=/^https:\/\/([a-z0-9\-]*\.)*(matterport\.com|matterportvr\.cn)$/,a=/^https:\/\/static\.(matterport\.com|matterportvr\.cn)$/;return{[T.CreationPolicy.MATTERPORT]:function(){if(window.location.origin.match(n)&&!window.location.origin.match(a))return window.location.href;const e=decodeURIComponent(new URLSearchParams(window.location.search.toLowerCase()).get("apihost")||"");return e.match(n)?e+"/show/":"https://my.matterport.com/show/"},[T.CreationPolicy.REFERRER]:function(){return t},[T.CreationPolicy.WINDOW]:function(){return window.location.href}}[e]()}async exec(e,t){this.deepLinks.creator.setDefaultBaseHref(e.baseHref,e.options.includeParams)}}class xa{constructor(e,t){this.toSdkMediaMap={[e.PHOTO]:I.MediaType.PHOTO,[e.VIDEO]:I.MediaType.VIDEO,[e.RICH]:I.MediaType.RICH},this.toSdkMediaFromChunk={[t.error]:I.MediaType.NONE,[t.link]:I.MediaType.NONE,[t.none]:I.MediaType.NONE,[t.photo]:I.MediaType.PHOTO,[t.rich]:I.MediaType.RICH,[t.text]:I.MediaType.NONE,[t.video]:I.MediaType.VIDEO}}toSdkMedia(e){return this.toSdkMediaMap[e]}fromTagChunkType(e){return this.toSdkMediaFromChunk[e]}}class Ra{constructor(e){this.toSdkChunkTypeMap={[e.error]:I.DescriptionChunkType.NONE,[e.link]:I.DescriptionChunkType.LINK,[e.none]:I.DescriptionChunkType.NONE,[e.photo]:I.DescriptionChunkType.NONE,[e.rich]:I.DescriptionChunkType.NONE,[e.text]:I.DescriptionChunkType.TEXT,[e.video]:I.DescriptionChunkType.NONE}}toSdkChunkType(e){return this.toSdkChunkTypeMap[e]}}class Pa{constructor(e){this.toSdkLinkTypeMap={[e.NAVIGATION]:I.LinkType.NAVIGATION,[e.MODEL]:I.LinkType.MODEL,[e.EXT_LINK]:I.LinkType.EXT_LINK}}toSdkLinkType(e){return this.toSdkLinkTypeMap[e]}}var Na,_a,ka,La,Va;!function(){(Na||(Na={})).create=async function(t,n){const a=await t.getDependencies();return new e(n.create(...a))};class e{constructor(e){this.executor=e}validateInput(e,t){return this.executor.validateInput(e,t)}exec(e,t){const n=this.executor.validateInput(e,t);return this.executor.exec(n,t)}}}(),function(e){e.FILE_TOO_LARGE="oversize",e.EMPTY_FILE="empty",e.OVER_QUOTA="overQuota",e.UPLOAD_FAILED="failed",e.PERMISSION_DENIED="permission"}(_a||(_a={})),function(e){e.EMBED_FAIL="embedFail",e.EMBED_SUCCESS="success"}(ka||(ka={})),function(e){e.IMAGE="image",e.PDF="pdf",e.VIDEO="video",e.RICH="rich",e.ZIP="zip",e.TEXT="text",e.AUDIO="audio",e.MODEL="model",e.APPLICATION="application"}(La||(La={})),function(e){e.EXTERNAL="external",e.UPLOAD="upload",e.SANDBOX="sandbox"}(Va||(Va={}));const Fa=new Zt("expiring-resource"),Ua=new WeakMap;class Ga{constructor(e,t){this.value=e,this.validUntil=t}refreshFrom(e){if(!e)return;this.value=e.value,this.validUntil=e.validUntil;const t=Ua.get(this);t&&(t.resolve(),Ua.delete(this))}async get(){if(this.validUntil&&this.onStale){const e=Date.now();if(e+6e4+1e4>this.validUntil.getTime()){let t=Ua.get(this);t||(t=new Qt,Ua.set(this,t),this.onStale()),e+6e4+1e3>this.validUntil.getTime()&&(Fa.info("Stale resource, waiting for refresh"),await t.nativePromise(),Fa.info("Refreshed resource"))}}return this.value}getCurrentValue(){return this.value}}function Ha(e=11,t="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"){let n="";const a=window.crypto||window.msCrypto;let o;o=a?a.getRandomValues(new Uint8Array(e)):new Uint8Array(e).map((()=>255*Math.random()));for(let a=0;a<e;a++)n+=t.charAt(o[a]%t.length);return n}var Ba,za;!function(e){e.PHOTO="photo",e.VIDEO="video",e.LINK="link",e.RICH="rich"}(Ba||(Ba={})),function(e){e.IMAGE="tag.attachment.image",e.RICH="tag.attachment.rich",e.VIDEO="tag.attachment.video"}(za||(za={}));class $a{constructor(e,t,n,a){this.attachmentsModule=t,this.pluginConfigData=a,this.globalAttachments=new Map,this.perClientAttachments=new Map,this.clientAttachments=new Map,this.clientIds=new Set,this.attachmentDescriptors=new Map,this.attachmentsToRefresh=new Map,this.refreshTimeout=0,this.shouldRefresh=!1,this.observable=new B,this.oEmbed=n;for(const t of e.getTagList()){const n=e.getTag(t);for(const e of n.fileAttachments)this.globalAttachments.set(e.id,e),this.attachmentsToRefresh.set(e.id,e);for(const e of n.externalAttachments)this.globalAttachments.set(e.id,e),this.setDescriptorUrl(e,e.src)}null==a||a.getMdsResult().then((e=>e.flatMap((e=>e.attachments)))).then((e=>{e.forEach((e=>{this.globalAttachments.set(e.id,e),this.attachmentsToRefresh.set(e.id,e)}))}))}async refresh(){const e=await this.attachmentsModule.getAllAttachments();for(const t of e)this.globalAttachments.has(t.id)||(this.globalAttachments.set(t.id,t),this.attachmentsToRefresh.set(t.id,t));if(this.pluginConfigData){(await this.pluginConfigData.getMdsResult()).flatMap((e=>e.attachments)).forEach((e=>{this.globalAttachments.set(e.id,e),this.attachmentsToRefresh.set(e.id,e)}))}this.refreshNextExpiringAttachment()}get(e,t){return this.globalAttachments.get(t)||this.clientAttachments.get(t)}add(e,t){const n=this.createIAttachment({src:t.src,type:t.type});return this.clientAttachments.set(n.id,n),this.setDescriptorUrl(n,t.src),this.clientIds.add(n.id),this.observable.notify(),n.id}async addBySrc(e,t){const n=await this.createOEmbedIAttachment(t);return this.clientAttachments.set(n.id,n),this.setDescriptorUrl(n,t),this.clientIds.add(n.id),this.observable.notify(),n.id}addSandbox(e,t){const n=this.getUniqueId(),a=t.name||"sandbox-"+n,o={id:n,src:a,srcDoc:t.srcDoc,onLoad:t.sandboxLoadedHandler,category:Va.SANDBOX,mediaType:La.RICH,parentType:on.MATTERTAG,thumbnailUrl:new Ga("",null),downloadUrl:new Ga("",null),url:new Ga("",null),created:new Date,height:t.size.h,width:t.size.w};return this.clientAttachments.set(n,o),this.setDescriptorUrl(o,a),this.clientIds.add(n),this.observable.notify(),[n,o]}has(e){return this.globalAttachments.has(e)||this.clientIds.has(e)}*[Symbol.iterator](e){for(const e of this.globalAttachments)yield e;for(const e of this.clientAttachments)yield e;if(e){const t=this.perClientAttachments.get(e)||[];for(const e of t)yield e}}*descriptors(){for(const e of this.attachmentDescriptors)yield e}onChanged(e){return this.shouldRefresh=!0,this.refreshNextExpiringAttachment(),this.observable.observe(e)}getUniqueId(){const e=Ha(10);return this.globalAttachments.has(e)||this.clientIds.has(e)?this.getUniqueId():e}async refreshNextExpiringAttachment(){if(!this.shouldRefresh)return;const e=Array.from(this.attachmentsToRefresh.values()).reduce(((e,t)=>e&&e.url.validUntil?t.url.validUntil&&t.url.validUntil<e.url.validUntil?t:e:t),null);if(!e)return;for(const[,e]of this.attachmentsToRefresh)this.setDescriptorUrl(e,await e.url.get());const t=e.url;if(t.validUntil){const n=t.validUntil.getTime()-Date.now();if(n<=0){const n=await t.get();this.setDescriptorUrl(e,n);for(const e of this.attachmentsToRefresh.values())this.setDescriptorUrl(e,e.url.getCurrentValue());this.observable.notify(),this.refreshTimeout=0}else this.refreshTimeout&&clearTimeout(this.refreshTimeout),this.refreshTimeout=window.setTimeout((()=>this.refreshNextExpiringAttachment()),n)}}setDescriptorUrl(e,t){this.attachmentDescriptors.set(e.id,{id:e.id,src:t,type:this.getAttachmentType(e.mediaType)})}getAttachmentType(e){return{[La.APPLICATION]:O.AttachmentType.APPLICATION,[La.AUDIO]:O.AttachmentType.AUDIO,[La.IMAGE]:O.AttachmentType.IMAGE,[La.MODEL]:O.AttachmentType.MODEL,[La.PDF]:O.AttachmentType.PDF,[La.RICH]:O.AttachmentType.RICH,[La.TEXT]:O.AttachmentType.TEXT,[La.VIDEO]:O.AttachmentType.VIDEO,[La.ZIP]:O.AttachmentType.ZIP}[e]}createIAttachment(e){const t={[za.IMAGE]:La.IMAGE,[za.RICH]:La.RICH,[za.VIDEO]:La.VIDEO};return{id:this.getUniqueId(),mediaType:t[e.type],category:Va.EXTERNAL,src:e.src,parentType:on.MATTERTAG,created:new Date,height:0,width:0,thumbnailUrl:new Ga("",null),downloadUrl:new Ga("",null),url:new Ga("",null),mimeType:""}}async createOEmbedIAttachment(e){const t={[Ba.PHOTO]:La.IMAGE,[Ba.RICH]:La.RICH,[Ba.VIDEO]:La.VIDEO},n=this.getUniqueId(),a=t[(await this.oEmbed.getOEmbedData(e)).type];if(!a)throw Error("unable to determine media type");return{id:n,mediaType:a,category:Va.EXTERNAL,src:e,parentType:on.MATTERTAG,created:new Date,height:0,width:0,thumbnailUrl:new Ga("",null),downloadUrl:new Ga("",null),url:new Ga("",null),mimeType:""}}}const ja={[I.MediaType.PHOTO]:za.IMAGE,[I.MediaType.RICH]:za.RICH,[I.MediaType.VIDEO]:za.VIDEO};class qa{constructor(e,t,n,a){this.tagAdd=e,this.tagEditIcon=t,this.tagAttach=n,this.attachmentRegistry=a}validateInput(e,t){return{descriptors:this.tagAdd.validateInput({descriptors:Array.isArray(e.descriptors)?e.descriptors:[e.descriptors]},t).descriptors}}async exec(e,t){const n=Array.isArray(e.descriptors)?e.descriptors:[e.descriptors],a=new Map;for(const e of n)if(e.media&&e.media.type!==I.MediaType.NONE){const n=this.attachmentRegistry.add(t.client.applicationKey,{src:e.media.src,type:ja[e.media.type]});a.set(e.media.src,n)}const o=async e=>{for(let a=0;a<e.length;++a){const o=n[a];o.iconId&&await this.tagEditIcon.exec({id:e[a],iconId:o.iconId},t)}},s=async e=>{for(let o=0;o<e.length;++o){const s=n[o];if(s.media&&s.media.type!==I.MediaType.NONE){const n=a.get(s.media.src);n&&this.tagAttach.exec({tagId:e[o],attachmentIds:[n]},t)}}};return this.tagAdd.exec({descriptors:n},t).then((async e=>(await o(e),await s(e),e)))}}function Wa(e,t,n){return(n=n||{}).x=e[t].x,n.y=e[t].y,n.z=e[t].z,n}function Ka(e,t,n){return(n=n||{}).r=e[t].r,n.g=e[t].g,n.b=e[t].b,n}class Ya{create(e,t){return t.onChanged((()=>e.onChanged()))}}class Xa{constructor(e,t,n,a){this.mattertagData=t,this.floorsData=n,this.floorIdMap=a,this._data={},this.mediaConverter=e.mediaConverter}get data(){return this._data}isItemEqual(e,t){return!he(this.data[t],e.data[t])}update(){for(const e of this.mattertagData.getTagList()){const t=this.mattertagData.getTag(e),n=this.floorsData.getFloor(t.floorId),a=this.data[t.sid]||{};a.sid=t.sid,a.enabled=t.enabled,a.anchorPosition=Wa(t,"anchorPosition",a.anchorPosition),a.stemVector=Wa(t,"stemVector",a.stemVector),a.stemVisible=t.stemVisible,a.label=t.label,a.description=t.description,a.media=this.getMedia(t,a.media),a.color=Ka(t,"color",a.color),a.floorIndex=n?n.index:-1,a.floorInfo=a.floorInfo||{},a.floorInfo.id=this.floorIdMap.getIdFromCwfId(n.id),a.floorInfo.sequence=n.index,this._data[t.sid]=a}for(const e in this.data){this.mattertagData.getTag(e)||delete this._data[e]}}clear(){this._data={}}getMedia(e,t){const n=e.externalAttachments.get(0),a=n?this.mediaConverter.toSdkMedia(n.mediaType):I.MediaType.NONE,o=n&&a!==I.MediaType.NONE?n.src:"";return(t=t||{}).src=o,t.type=a,t}}class Za{constructor(e,t,n){this.tagEditBillboard=t,this.tagAttach=n,[this.mattertagData,this.attachmentRegistry]=e}validateInput(e,t){if(!va(e.properties))throw Error("Mattertag.editBillboard: editable properties is not an object");const n=Q(this.tagEditBillboard,e,t),a=e.properties.media;if(a){if(!va(a)||!yn(I.MediaType,a.type))throw Error("Mattertag.editBillboard: media was not a valid media descriptor");if(a.type!==I.MediaType.NONE){if(!te(a.src))throw Error(`Mattertag.editBillboard: media was of type "${a.type}" but has no src value`);return{id:n.id,properties:Object.assign(Object.assign({},n.properties),{media:{src:a.src,type:a.type}})}}n.properties.media={src:"",type:I.MediaType.NONE}}return n}async exec(e,t){const n=this.mattertagData.getTag(e.id),a=(()=>{if(e.properties.media&&e.properties.media.type!==I.MediaType.NONE)return this.attachmentRegistry.add(t.client.applicationKey,{src:e.properties.media.src,type:ja[e.properties.media.type]})})(),o=this.mattertagData;return J(this.tagEditBillboard,e,t).then((()=>{e.properties.media&&(n.fileAttachments.replace([]),n.externalAttachments.replace([])),a&&J(this.tagAttach,{tagId:n.sid,attachmentIds:[a]},t),o.commit()}))}}function Qa(e,t,n){function a(e){if(!e)return;return{label:e.label,type:n.toSdkLinkType(e.type),url:e.url,navigationData:e.navigationData}}const o=[];for(const n of e)o.push({type:t.toSdkChunkType(n.type),link:a(n.link),text:n.text});return o}class Ja{constructor(e,t,n,a){this.commands=e,this.tagData=t,this.floorData=n,this.floorIdMap=a}validateInput(e,t){return e}async exec(e,t){return function(e,t,n,a){const o=[];return e.iterate((e=>{const{id:s,index:r}=t.getFloor(e.floorId),i=n.getIdFromCwfId(s),c=e.externalAttachments.get(0),d=c?a.mediaConverter.toSdkMedia(c.mediaType):I.MediaType.NONE,l=c&&d!==I.MediaType.NONE?c.src:"";o.push({sid:e.sid,label:e.label,description:e.description,parsedDescription:Qa(e.parsedDescription,a.chunkTypeConverter,a.linkTypeConverter),mediaSrc:l,mediaType:d,media:{type:d,src:l},anchorPosition:{x:e.anchorPosition.x,y:e.anchorPosition.y,z:e.anchorPosition.z},anchorNormal:{x:e.anchorNormal.x,y:e.anchorNormal.y,z:e.anchorNormal.z},color:{r:e.color.r,g:e.color.g,b:e.color.b},enabled:e.enabled,floorId:r,floorIndex:r,floorInfo:{id:i,sequence:r},stemVector:{x:e.stemVector.x,y:e.stemVector.y,z:e.stemVector.z},stemHeight:e.stemHeight,stemVisible:e.stemVisible})})),o}(this.tagData,this.floorData,this.floorIdMap,this.commands)}}class eo extends Sn{constructor(e){super("Expected tagId parameter to be of type string; got "+(Array.isArray(e)?"Array":typeof e))}}class to{constructor(e,t,n){this.mattertagsData=e,this.attachmentRegistry=t,this.registerSandbox=n}validateInput(e,t){var n,a;if(!te(e.tagId)||!this.mattertagsData.getTag(e.tagId))throw new eo(e.tagId);const o=e.options||{};return"string"==typeof(null===(n=o.size)||void 0===n?void 0:n.w)&&(o.size.w=parseInt(o.size.w,10)),"string"==typeof(null===(a=o.size)||void 0===a?void 0:a.h)&&(o.size.h=parseInt(o.size.h,10)),Object.assign(Object.assign({},this.registerSandbox.validateInput(Object.assign(Object.assign({},e),{options:o}),t)),{tagId:e.tagId})}async exec(e,t){const{clientId:n,html:a,options:o,tagId:s}=e,{sandboxId:r,attachmentId:i}=await this.registerSandbox.exec({clientId:n,html:a,options:o},t),c=this.attachmentRegistry.get(t.client.applicationKey,i);return c&&function(e){return"onLoad"in e}(c)&&this.mattertagsData.getTag(s).sandboxAttachments.replace([c]),{sandboxId:r,attachmentId:i}}}class no{constructor(e){this.tagRemove=e}validateInput(e,t){return{ids:Q(this.tagRemove,{ids:Array.isArray(e.ids)?e.ids:[e.ids]},t).ids}}async exec(e,t){return J(this.tagRemove,{ids:Array.isArray(e.ids)?e.ids:[e.ids]},t)}}const ao={[I.Transition.FLY]:_n.Interpolate,[I.Transition.FADEOUT]:_n.FadeToBlack,[I.Transition.INSTANT]:_n.Instant};class oo{constructor(e,t,n,a,o,s){this.FocusOnPinInsideCommand=e,this.OpenTagCommand=t,this.issueCommand=n,this.mattertagData=a,this.tagsViewData=o,this.annotationsViewData=s}validateInput(e,t){if(!te(e.id)||!this.mattertagData.getTag(e.id))throw Error(`${e.id} does not map to a valid Tag`);if(void 0!==e.transitionType&&!yn(I.Transition,e.transitionType))throw Error(`${e.transitionType} does not match valid transition type`);return{id:e.id,transitionType:e.transitionType,force:!!e.force}}async exec(e,t){const n=this.mattertagData.getTag(e.id);let a=ao[e.transitionType];return void 0===a&&(a=_n.Interpolate),(this.tagsViewData.getCapabilities(e.id).focus||e.force)&&(await this.issueCommand(new this.FocusOnPinInsideCommand({pinPosition:Object.assign(Object.assign({},n),{stemLength:n.stemHeight,stemNormal:n.stemVector}),transition:a})),(this.annotationsViewData.getCapabilities(e.id).preview||e.force)&&await this.issueCommand(new this.OpenTagCommand(e.id))),e.id}}class so{constructor(e,t){this.tagAllowAction=e,this.annotationsViewData=t}validateInput(e,t){const n=Q(this.tagAllowAction,{id:e.tagId,allow:{}},t),a={navigating:!1,opening:!1};return va(e.prevent)&&(a.navigating=!!e.prevent.navigating,a.opening=!!e.prevent.opening),{tagId:n.id,prevent:a}}exec(e,t){const n=this.annotationsViewData.getCapabilities(e.tagId);return J(this.tagAllowAction,{id:e.tagId,allow:{navigating:!e.prevent.navigating,opening:!e.prevent.opening,docking:n.dock}},t)}}function ro(e,t,n,a,o,s){e.addEnumToInterface({namespace:"Mattertag",name:"DescriptionChunkType",values:I.DescriptionChunkType}),e.addEnumToInterface({namespace:"Mattertag",name:"Event",values:I.Event}),e.addEnumToInterface({namespace:"Mattertag",name:"LinkType",values:I.LinkType}),e.addEnumToInterface({namespace:"Mattertag",name:"MediaType",values:I.MediaType}),e.addEnumToInterface({namespace:"Mattertag",name:"Transition",values:I.Transition});const r=Object.assign(Object.assign({},n),{mediaConverter:new io(t.MediaType)}),[i,c,d,l,u,h]=s;!function(e,t,n){const a=["",!1],o=e=>(a[0]=e.id,a[1]=e.hovering,a);n.subscribe(t.PinHoverChangeMessage,(n=>{n.pinType===t.PinType.MATTERTAG&&e.broadcast(I.Event.HOVER,o,n)}));const s=[""],r=e=>(s[0]=e.id,s);n.subscribe(t.PinClickedMessage,(n=>{n.pinType===t.PinType.MATTERTAG&&e.broadcast(I.Event.CLICK,r,n)}))}(e,t,n),function(e,t,n,a){a.getDependencies().then((([a])=>{const o=["",""],s=e=>{var t;return o[0]=(null===(t=a.billboardAnnotation)||void 0===t?void 0:t.id)||"",o[1]=e.url,o};n.subscribe(t.MattertagLinkOpenedMessage,(t=>{e.broadcast(I.Event.LINK_OPEN,s,t)}))}))}(e,t,n,new z(d));const p=function(e,t,n){const a=Na.create(new z(t.add,t.editIcon,t.attach,n),new $(qa));return e.addAsyncCommandToInterface({namespace:"Mattertag",name:"add",args:["descriptors"],options:{replay:!0,deprecated:"Tag.add"}},a),a}(e,o,h),m=function(e,t,n){const a=sa.create(n,new Ya,new $(Xa,t));return e.addCollectionToInterface({namespace:"Mattertag",name:"data"},a),a}(e,r,new z(i,l,u)),g=function(e,t,n){const a=X.create(new z(n.getDependencies(),t.editBillboard,t.attach),new $(Za));return e.addAsyncCommandToInterface({namespace:"Mattertag",name:"editBillboard",args:["id","properties"],options:{replay:!0,deprecated:"`Tag.editBillboard`, or `Tag.registerAttachment` and `Tag.attach` for media"}},a),a}(e,o,new z(i,h)),f=function(e,t){return e.addAsyncCommandToInterface({namespace:"Mattertag",name:"editColor",args:["id","color"],options:{replay:!0,deprecated:"Tag.editColor"}},t),t}(e,o.editColor),w=function(e,t){return e.addAsyncCommandToInterface({namespace:"Mattertag",name:"editIcon",args:["id","iconId"],options:{replay:!0,deprecated:"Tag.editIcon"}},t),t}(e,o.editIcon),y=function(e,t){return e.addAsyncCommandToInterface({namespace:"Mattertag",name:"editOpacity",args:["id","opacity"],options:{replay:!0,deprecated:"Tag.editOpacity"}},t),t}(e,o.editOpacity),v=function(e,t){return e.addAsyncCommandToInterface({namespace:"Mattertag",name:"editPosition",args:["id","options"],options:{replay:!0,deprecated:"Tag.editPosition"}},t),t}(e,o.editPosition),T=function(e,t){return e.addAsyncCommandToInterface({namespace:"Mattertag",name:"editStem",args:["id","stemParams"],options:{replay:!0,deprecated:"Tag.editStem"}},t),t}(e,o.editStem);!function(e,t,n){const a=X.create(n,new $(Ja,t));e.addAsyncCommandToInterface({namespace:"Mattertag",name:"getData",args:[],options:{deprecated:"Tag.data"}},a)}(e,r,new z(i,l,u));const b=function(e,t,n){const a=Na.create(z.extend(n,t.registerSandbox),new $(to));return e.addCommandToInterface({namespace:"Mattertag",name:"injectHTML",subRoutine:"mattertag.inject",args:["tagId","html","options"],options:{replay:!0,deprecated:"Tag.registerSandbox and Tag.attaach"}},a),a}(e,o,new z(i,h));!function(e,t,n,a){const o=X.create(a,new $(oo,t.FocusOnPinInsideCommand,t.OpenTagCommand,n.issueCommand));e.addAsyncCommandToInterface({namespace:"Mattertag",name:"navigateToTag",args:["id","transitionType","force"]},o)}(e,t,n,new z(i,c,d));const E=function(e,t){const n=X.create(t,new $(so));return e.addAsyncCommandToInterface({namespace:"Mattertag",name:"preventAction",args:["tagId","prevent"],options:{replay:!0,deprecated:"Tag.allowAction"}},n),n}(e,new z(o.allowAction,d));!function(e,t){e.addAsyncCommandToInterface({namespace:"Mattertag",name:"registerIcon",args:["textureId","textureSrc"],options:{deprecated:"Asset.registerTexture"}},t)}(e,a.registerTexture);const S=function(e,t){const n=X.create(new z(t),new $(no));return e.addAsyncCommandToInterface({namespace:"Mattertag",name:"remove",args:["ids"],options:{replay:!0,deprecated:"Tag.remove"}},n),n}(e,o.remove),C=function(e,t){return e.addAsyncCommandToInterface({namespace:"Mattertag",name:"resetIcon",args:["id"],options:{replay:!0,deprecated:"Tag.resetIcon"}},t),t}(e,o.resetIcon);return{data:m,add:p,editBillboard:g,editColor:f,editIcon:w,editOpacity:y,editPosition:v,editStem:T,inject:b,preventAction:E,remove:S,resetIcon:C}}class io{constructor(e){this.toSdkMediaMap={[e.IMAGE]:I.MediaType.PHOTO,[e.VIDEO]:I.MediaType.VIDEO,[e.RICH]:I.MediaType.RICH,[e.APPLICATION]:I.MediaType.NONE,[e.AUDIO]:I.MediaType.NONE,[e.MODEL]:I.MediaType.NONE,[e.PDF]:I.MediaType.NONE,[e.TEXT]:I.MediaType.NONE,[e.ZIP]:I.MediaType.NONE}}toSdkMedia(e){return this.toSdkMediaMap[e]}}class co extends ge{}co.id="MEASUREMENTS_GET";const lo=async(e,t)=>{const n=[];for(const a of e.groups()){const e=a.info,o=t.getFloor(e.floorId);for(let t=1;t<a.count;t++){const s=a.get(t-1),r=a.get(t);n.push({sid:e.sid,label:e.text,floor:o.index,start:{x:s.x,y:s.y,z:s.z},end:{x:r.x,y:r.y,z:r.z}})}}return n};class uo{constructor(e){this.CwfMeasuringPhase=e}create(e,t){let n=t.groupCount,a=t.phase;const o=()=>{const o=t.groupCount,s=t.phase;n===o&&a!==this.CwfMeasuringPhase.EDITING||s!==this.CwfMeasuringPhase.IDLE||(e.onChanged(),n=o),a=s};return new Lt(t.onPhaseChanged(o),t.onSelectedGroupIndexChanged(o))}}class ho{constructor(e){this.measurementModeData=e,this.data={}}update(){for(const e of this.measurementModeData.groups())this.createMeasurement(e);for(const e in this.data){this.measurementModeData.getGroupInfoBySid(e)||delete this.data[e]}}isItemEqual(e,t){return!he(this.data[t],e.data[t])}clear(){this.data={}}createMeasurement(e){const t=e.info.sid,n=this.data[t]||{},a=n.points||[];n.label=e.info.text,n.segmentLengths=e.segmentLengths,n.totalLength=e.length,function(e,t){let n=0;for(const a of t){const t=e[n]||{};t.x=a.x,t.y=a.y,t.z=a.z,e[n]=t,++n}e.length=n}(a,e),n.sid=t,n.points=a,this.data[t]=n}}class po{create(e,t){return t.onChanged((()=>e.onChanged()))}}class mo{constructor(){this._data={active:!1}}get data(){return this._data}equals(e){return this._data.active===e.data.active}copy(e){this._data.active=e.data.active}update(e){this._data.active=e.modeActive()}}(class extends ge{constructor(e){super(),this.payload={collapse:e}}}).id="TOOL_PANEL_TOGGLE_COLLAPSE";(class extends ge{constructor(e){super(),this.payload={collapse:e}}}).id="TOOL_BOTTOM_PANEL_COLLAPSE";class go extends ge{constructor(e,t){super(),this.payload={toolName:e,active:t}}}go.id="TOGGLE_TOOL";(class extends ge{constructor(e){super(),this.payload={checkForEdits:e}}}).id="CLOSE_REMOVE_TOOLS";(class extends ge{constructor(e){super(),this.payload={tools:e}}}).id="REGISTER_TOOLS";(class extends ge{}).id="OPEN_PREVIOUS_TOOL";(class extends ge{}).id="OPEN_INITIAL_TOOL";(class extends ge{constructor(e,t=!1){super(),this.payload={toolName:e,softOpening:t}}}).id="OPEN_TOOL";(class extends ge{}).id="CLOSE_CURRENT_TOOL";(class extends ge{constructor(e){super(),this.payload={toolName:e}}}).id="CLOSE_TOOL";class fo{constructor(e,t){this.toolType=e,this.issueCommand=t}validateInput(e){const t=e.active;if(!Ta(t))throw Error(Z("active","boolean",t));return{active:t}}async exec(e){await this.issueCommand(new go(this.toolType.MEASUREMENTS,e.active))}}class wo extends Sn{constructor(e="Unhandled Transition Exception"){super(e),this.name="TransitionException"}}class yo extends wo{constructor(e="Unhandled Viewmode Exception",t){super(e),this.originalError=t,this.name="ViewmodeException"}}class vo extends yo{constructor(e="Tried to start view-mode transition while another transition was active"){super(e),this.name="ViewmodeActiveTransition"}}function To(e){return"number"==typeof e&&!isNaN(e)}function Io(e){return e-0}function bo(e,t,n){return Math.max(t,Math.min(e,n))}function Eo(e){if(e&&"object"==typeof e&&"x"in e&&"y"in e&&"z"in e){const t=e;return To(t.x)&&To(t.y)&&To(t.z)}return!1}const So=new Zt("move-to-mode-command");class Co extends ge{constructor(e){super(),this.payload=e}}Co.id="MOVE_TO_MODE";class Ao{constructor(e,t,n,a){this.THREE=e,this.viewmodeConverter=t,this.conversion=n,this.transitionTypeConverter=a}validateMoveToModeInput(e){if(!e)throw Error("Mode.moveTo -> no arguments provided -- mode is required");e.options||(e.options={});const t=e.mode;if(!yn(b.Mode,e.mode))throw Error(`Mode.moveTo -> ${e.mode} is not a valid viewmode`);if(t===b.Mode.TRANSITIONING)throw Error(`Mode.moveTo -> ${e.mode} is not a valid viewmode`);e.options&&e.options.rotation&&(e.options.rotation.z=e.options.rotation.z||0);const n=this.validatePayloadOptions(e.options);return{mode:this.viewmodeConverter.fromSdk(t),options:{transition:n.transition,position:n.position,rotation:n.rotation,zoom:n.zoom}}}validatePayloadOptions(e){let t,n,a,o;if(e){if(e.transition&&(a=this.transitionTypeConverter.fromSdkTransition(e.transition),void 0===a))throw Error(`Mode.moveTo -> ${e.transition} is not a valid transition style`);e.rotation&&Eo(e.rotation)&&(t=this.conversion.rotationToQuaternion(e.rotation)),e.position&&Eo(e.position)&&(n=new this.THREE.Vector3(parseFloat(e.position.x),parseFloat(e.position.y),parseFloat(e.position.z))),e.zoom&&!isNaN(e.zoom)&&(o=Kn(e.zoom,1,30))}return{rotation:t,position:n,transition:a,zoom:o}}}class Oo{create(e,t,n,a){const o=()=>e.onChanged();return new Lt(a.pose.isPitchFactorOrthoObservable.onChanged(o),n.onChanged(o),t.onChanged(o))}}class Do{constructor(e,t){this._data=b.Mode.INSIDE,this.viewmodeConverter=t.viewmodeConverter}get data(){return this._data}equals(e){return this._data===e.data}copy(e){this._data=e.data}update(e,t,n){const a=t.state.currentSweep&&t.isSweepAligned(t.state.currentSweep);this._data=this.viewmodeConverter.toSdk(e.currentMode,!!a,n.pose.isPitchFactorOrtho)}}class Mo extends ge{}function xo(e,t,n){t.addBinding(Mo,(async()=>{const e=await n.getDependencies();return await async function(e,n,a,o){const s={sid:"",sweeps:[],modelSupportsVr:!1};try{const r=n.getSweepList(),i=e.model;return await t.makeModelData(i.sid,i.options.isVR,r,a,o,s),s}catch(e){throw Error("no model currently loaded")}}(...e)})),e.addCommandCreator({namespace:"Model",name:"getData",args:[]},(()=>new Mo))}Mo.id="GET_MODEL_DATA";class Ro extends ge{}function Po(e,t,n,a){a.getDependencies().then((e=>n.addBinding(Ro,(async()=>function(e,n){function a(e,t){if(n.tryGetSetting(e,!0))return t}const o=e.model;return{sid:o.sid,name:a(t.OptionsKey.DetailsModelName,o.details.name),presentedBy:a(t.OptionsKey.PresentedBy,o.details.presentedBy),summary:a(t.OptionsKey.DetailsSummary,o.details.summary),defaultViewId:a(t.OptionsKey.DetailsSummary,o.details.defaultViewId),description:a(t.OptionsKey.DetailsSummary,o.details.description),formattedAddress:a(t.OptionsKey.DetailsAddress,o.details.formattedAddress),contactEmail:a(t.OptionsKey.DetailsEmail,o.details.contact.email),contactName:a(t.OptionsKey.DetailsName,o.details.contact.name),phone:a(t.OptionsKey.DetailsPhone,o.details.contact.phone),formattedContactPhone:a(t.OptionsKey.DetailsPhone,o.details.contact.formattedPhone),externalUrl:a(t.OptionsKey.DetailsExternalUrl,o.details.externalUrl)}}(...e))))),e.addCommandCreator({namespace:"Model",name:"getDetails",args:[]},(()=>new Ro))}Ro.id="GET_MODEL_DETAILS";const No=e=>null!==e.position?{x:e.position.x,y:e.position.y,z:e.position.z}:null;function _o(e,t){return async function(n,a,o,s,r,i){i.sweeps=[];for(const n of o){const a=n.floorId?s.getFloor(n.floorId).index:-1;i.sweeps.push({uuid:r.getIdForSweep(n),sid:r.getIdForSweep(n),alignmentType:t.toSdkAlignment(n.alignmentType),placementType:t.toSdkPlacement(n.placementType),neighbors:await Promise.all(n.neighbours.map((async e=>await r.getIdFromCwfId(e)))),position:No(n),rotation:e.quaternionToRotation(n.rotation),floor:a})}return i.sid=n,i.modelSupportsVr=a,i}}const ko={namespace:"OAuth",name:"updateToken",args:["token"]};class Lo{constructor(e){this.tokenUpdater=e}validateInput(e){const{token:t}=e;if(!te(t))throw Error();return{token:t}}async exec(e,t){this.tokenUpdater.setToken(e.token)}}var Vo,Fo,Uo;!function(e){e[e.None=0]="None",e[e.AnonymousFetch=1]="AnonymousFetch",e[e.UserFetch=2]="UserFetch"}(Vo||(Vo={})),function(e){e[e.FetchAnonymous=1]="FetchAnonymous",e[e.FetchAsUser=2]="FetchAsUser",e[e.AnyFetch=3]="AnyFetch",e[e.LocalData=4]="LocalData",e[e.EarlyLoad=268435456]="EarlyLoad",e[e.DisableSES=2147483648]="DisableSES"}(Fo||(Fo={})),function(e){e[e.Locked=0]="Locked",e[e.Default=4]="Default",e[e.DefaultEarlyLoad=268435462]="DefaultEarlyLoad",e[e.Fetch=6]="Fetch",e[e.FetchEarlyLoad=268435462]="FetchEarlyLoad",e[e.OpenEnvironment=4294967295]="OpenEnvironment"}(Uo||(Uo={}));const Go=["$fetchLevel","$canPlaceInGrid"];class Ho{constructor(e){this.pluginRegistry=e}validateInput(e){if(!va(e.key))throw Error(e.key+" is not a valid object");const t=e.key;if(!ne(t.applicationKey))throw Error(t.applicationKey+" is not a valid string");if(!ne(t.id))throw Error(t.id+"is not a valid string");if(!ne(e.path))throw Error(e.path+" is not a valid string");return e}async exec(e){var t,n,a;let o=Vo.AnonymousFetch,s=!1;void 0!==(null===(t=e.config)||void 0===t?void 0:t.$fetchLevel)?o=bo(e.config.$fetchLevel&Fo.AnyFetch,Vo.None,Vo.UserFetch):void 0!==(null===(n=e.config)||void 0===n?void 0:n.$canPlaceInGrid)&&(s=e.config.$canPlaceInGrid);const r={};for(const t in e.config)Go.includes(t)||(r[t]=e.config[t]);const i=Object.assign({},null===(a=e.metadata)||void 0===a?void 0:a.peerDependencies);return this.pluginRegistry.load({applicationKey:e.key.applicationKey,id:e.key.id||"default",src:e.path,strict:!1,permissionLevel:o,canPlaceInGrid:s,config:r||{},peerDependencies:i})}}class Bo{constructor(e){this.pluginRegistry=e}validateInput(e){if(!va(e.key))throw Error(e.key+" is not a valid object");if(!ne(e.key.applicationKey))throw Error(e.key+" is not a valid string");return e}async exec(e){return this.pluginRegistry.unload(e.key)}}class zo{create(e,t,n){return new Lt(t.onChanged((()=>e.onChanged())),n.onChanged((()=>e.onChanged())))}}class $o{constructor(e,t){this.pluginData=e,this.pluginUIData=t,this._data={}}get data(){return this._data}isItemEqual(e,t){const n=this.data[t],a=e.data[t];return n.applicationKey===a.applicationKey&&n.id===a.id&&n.visibility===a.visibility}update(){var e;for(const[t,n]of this.pluginData.plugins.entries()){const{id:a,applicationKey:o}=n;this._data[t]={id:a,applicationKey:o,visibility:(null===(e=this.pluginUIData.visibilityData.get(a))||void 0===e?void 0:e.visible)?R.Visibility.ON:R.Visibility.OFF}}for(const e in this.data)this.pluginData.plugins.has(e)||delete this._data[e]}clear(){this._data={}}}class jo{create(e,t){return t.onChanged((()=>e.onChanged()))}}class qo{constructor(e,t){this.colliderTypes=t,this.ZERO=new e.Vector3(0,0,0),this.tempVec=new e.Vector3,this._data={position:{x:0,y:0,z:0},normal:{x:0,y:0,z:0},object:S.Colliders.NONE,floorId:void 0,floorIndex:void 0}}get data(){return this._data}equals(e){const t=1e-5,n=e.data.position,a=this._data.position,o=e.data.normal,s=this._data.normal;return Mn(n,a,t)&&Mn(o,s,t)&&e.data.object===this._data.object}update(e,t,n,a,o){const s=e.hit;s?(En(this._data.position,s.point),En(this._data.normal,s.face.normal),this._data.floorId=void 0,s.object instanceof this.colliderTypes.ModelColliderTarget?(this._data.object=S.Colliders.MODEL,this._data.floorId=function(e,t,n,a,o,s){let r;const i=o.floorIdFromObject(e.object);if(i)return r=t.getFloor(i),r.index;s.copy(e.point);const c=a.meshSubGroupsFromPoint(s);if(!c.length)return;const d=n.getByMeshSubgroup(c[0]);if(!d)return;return r=t.getFloor(d.floorId),r.index}(s,t,n,a,o,this.tempVec)):s.object instanceof this.colliderTypes.PinHeadMesh||s.object instanceof this.colliderTypes.InstancedPinHeads?this._data.object=S.Colliders.TAG:s.object instanceof this.colliderTypes.PuckCollider?this._data.object=S.Colliders.SWEEP:this._data.object=S.Colliders.UNKNOWN):(En(this._data.position,this.ZERO),En(this._data.normal,this.ZERO),this._data.object=S.Colliders.NONE,this._data.floorId=void 0),this._data.floorIndex=this._data.floorId}copy(e){En(this._data.position,e.data.position),En(this._data.normal,e.data.normal),this._data.object=e.data.object,this._data.floorId=e.data.floorId,this._data.floorIndex=e.data.floorIndex}}class Wo{constructor(e,t){this.cursorController=e,this.textureAaps=t}validateInput(e){if(!te(e.textureId))throw Error("textureId is not a valid string");return{textureId:e.textureId}}async exec(e,t){const{textureId:n}=e,a=this.textureAaps.get(t.client.applicationKey).map[n];this.cursorController.setTexture(a)}}class Ko{constructor(e){this.cursorController=e}validateInput(e){return e}async exec(e,t){this.cursorController.setTexture(null)}}class Yo{constructor(e){this.cursorController=e}validateInput(e){(e=e||{}).props=e.props||{};const t=e.props;if(t.fadeIn){const e=t.fadeIn;if(e.duration&&(!To(e.duration)||e.duration<=0))throw Error(`Pointer.setFadeProps: fadeIn.duration was specified but was not a valid duration; got ${e.duration}`)}if(t.fadeOut){const e=t.fadeOut;if(e.duration&&(!To(e.duration)||e.duration<=0))throw Error(`Pointer.setFadeProps: fadeOut.duration was specified but was not a valid duration; got ${e.duration}`);if(e.delay&&(!To(e.delay)||e.delay<=0))throw Error(`Pointer.setFadeProps: fadeOut.delay was specified but was not a valid delay; got ${e.delay}`)}return e}async exec(e,t){this.cursorController.setFadeProps(e.props)}}class Xo{constructor(e){this.cursorController=e,this.visible=!0,this.ruleAdded=!1}isVisible(){return this.visible}validateInput(e){if(!Ta(e.visible))throw Error(`Pointer.setVisible: visible was specified but was not a valid boolean; got ${e.visible}`);return e}async exec(e,t){this.ruleAdded||(this.isVisible=this.isVisible.bind(this),this.cursorController.addVisibilityRule(this.isVisible),this.ruleAdded=!0),this.visible=e.visible}}class Zo{constructor(e){this.r3fModule=e}validateInput(e){return e}async exec(e,t){return this.r3fModule.registerExternalR3F(e.callbacks)}}const Qo=new Zt("mpSdk.R3F.navigationToggle");class Jo{constructor(e){this.enabled=!0,this.userNavigationEnabled=()=>this.enabled,e.addNavigationRule(this.userNavigationEnabled.bind(this))}validateInput(e){return e}async exec(e,t){this.enabled=e.enabled,Qo.debug(e)}}class es{constructor(e,t,n,a,o){this.THREE=e,this.cwfTypes=t,this.commands=n,this.navigation=a,this.viewmodeData=o}validateInput(e){if(!e)throw Error('focus: no arguments provided -- "target" point|box is required');const t=e.target;if(!function(e){if(e&&"object"==typeof e&&"min"in e&&"max"in e){const t=e;if(Eo(t.min)&&Eo(t.max))return!0}return!1}(t)&&!Eo(t))throw new Error('focus: invalid "target"');const n=e.options;if(n){const{from:e,mode:t,transition:a}=n;if(e&&!Eo(e))throw new Error('focus: "options.from" must be a Vector3|undefined');if(t){if(void 0===this.commands.viewmodeConverter.fromSdk(t))throw Error(`focus: ${t} is not a valid "options.mode"`)}let o=this.cwfTypes.CameraTransitionType.Interpolate;if(a&&(o=this.commands.cameraTransitionConverter.fromSdkTransition(a),void 0===o))throw Error(`focus: ${a} is not a valid "options.transition"`)}return e}async exec(e,t){const n=e.target,a=this.convertOptions(e);try{await this.navigation.focus(n,a)}catch(e){console.warn("focus: unable to focus",e)}}convertOptions(e){var t,n,a,o;const s=null===(t=e.options)||void 0===t?void 0:t.mode,r=s?this.commands.viewmodeConverter.fromSdk(s):null!==(n=this.viewmodeData.currentMode)&&void 0!==n?n:void 0,i=null===(a=e.options)||void 0===a?void 0:a.from,c=i&&Eo(i)?new this.THREE.Vector3(i.x,i.y,i.z):void 0,d=null===(o=e.options)||void 0===o?void 0:o.transition;return{from:c,mode:r,transition:d?this.commands.cameraTransitionConverter.fromSdkTransition(d):this.cwfTypes.CameraTransitionType.Interpolate}}}class ts{constructor(){}onAccessGranted(e){}onAccessRevoked(e){}}const ns=new Zt("mpSdk.R3F.controlsToggle");class as{constructor(e){this.controls=e,this.sub=null}validateInput(e){return e}async exec(e,t){if(ns.debug(e),this.sub&&e.enabled&&(this.sub.cancel(),this.sub=null),!this.sub&&!e.enabled){const e=this.controls.cameraPoseProxy;this.sub=e.newSession(new ts)}}}class os{constructor(e){this.rendererModule=e}validateInput(e){return e}async exec(e,t){return this.rendererModule.getScene().scene}}class ss{constructor(e,t){this.captureCamera=e,this.encodeRenderTarget=t}async capture(e,t,n,a){const{camera:o,scene:s}=t.getScene();return o.getWorldPosition(this.captureCamera.position),o.getWorldQuaternion(this.captureCamera.quaternion),this.captureCamera.projectionMatrix.copy(o.projectionMatrix),this.captureCamera.layers.mask=e.visibleObjects.mask,a.setSize(e.resolution.width,e.resolution.height),n.render(a.target,s,this.captureCamera),await this.encodeRenderTarget(a)}}function rs(e){return To(e)&&e%1==0}const is=new Zt("command.takeScreenshot");var cs,ds;!function(e){e.Base64JPG="screenshot.base64.jpg",e.ArrayBufferJPG="screenshot.arraybuffer.jpg"}(cs||(cs={}));class ls{constructor(e,t,n,a,o,s){this.canvasData=a,this.rendererModule=o,this.renderToTexture=s,this.RenderLayers=t.RenderLayers,this.screenCapturer=e,this.requestTarget=n.requestTarget,this.getRenderLayer=n.getRenderLayer,this.jpegAsBase64=n.jpegAsBase64}validateInput(e){return{resolution:this.validateResolution(e.resolution,this.canvasData,this.rendererModule),visibleObjects:this.buildVisibilityOptions(e.visibleObjects),returnType:e.returnType===cs.ArrayBufferJPG?cs.ArrayBufferJPG:cs.Base64JPG}}async exec(e,t){const n=await this.requestTarget(),a=await this.screenCapturer.capture({resolution:e.resolution,visibleObjects:this.buildVisibilityLayers(e.visibleObjects)},this.rendererModule,this.renderToTexture,n);return e.returnType===cs.ArrayBufferJPG?a.buffer instanceof ArrayBuffer?a.buffer:new Uint8Array(a).buffer:this.jpegAsBase64(a)}validateResolution(e,t,n){const a={width:0,height:0};if(!e)return a.width=t.width,a.height=t.height,a;if(!function(e){const t=e;return!!t&&("number"==typeof t.width&&"number"==typeof t.height)}(e))throw Error('"resolution" provided was not valid. Expected .width and .height to be numbers.');a.width=e.width,a.height=e.height;const o=n.maxTextureSize;if(e.width<=0||e.width>o)throw Error('"resolution.width" provided was outside the valid range of [0, '+o+"]");if(e.height<=0||e.height>o)throw Error('"resolution.height" provided was outside the valid range of [0, '+o+"]");if(!rs(a.width)){const e=Math.round(a.width);is.info(`Integer width expected. Rounding from ${a.width} to ${e}`),a.width=e}if(!rs(a.height)){const e=Math.round(a.height);is.info(`Integer width expected. Rounding from ${a.height} to ${e}`),a.height=e}return a}buildVisibilityOptions(e){const t=e||{};return{measurements:!!t.measurements,mattertags:!!t.mattertags,sweeps:!!t.sweeps,views:!!t.views}}buildVisibilityLayers(e){const t=this.RenderLayers.ALL;return e.mattertags||t.removeLayers(this.getRenderLayer("pins")),e.measurements||t.removeLayers(this.getRenderLayer("measurements")),e.sweeps||t.removeLayers(this.getRenderLayer("sweep-pucks")),e.views||(t.removeLayers(this.getRenderLayer("sweep-portal-mesh")),t.removeLayers(this.getRenderLayer("sweep-pin-mesh"))),t}}class us{constructor(e,t,n,a,o,s,r,i){this.renderer=a,this.renderToTexture=o,this.viewmodeData=s,this.sweepData=r,this.sweepTextureLoader=i,this.Viewmode=t.Viewmode,this.requestTarget=n.requestTarget,this.encodeRenderTarget=n.encodeRenderTarget,this.jpegAsBase64=n.jpegAsBase64,this.getXmp=n.getXmp,this.getOrientedAngleTo=n.getOrientedAngleTo,this.forward=new e.Vector3(0,0,-1),this.sweepForward=new e.Vector3,this.viewForward=new e.Vector3}validateInput(e){return e}async exec(e,t){if(!this.sweepData.state.currentSweep||this.viewmodeData.currentMode!==this.Viewmode.Panorama)throw new Error("Can only capture equirectangular projections while stationary in a sweep");const n=this.renderer.getScene().camera,a=this.sweepData.getSweep(this.sweepData.state.currentSweep),o=await this.sweepTextureLoader.load(a);this.sweepForward.copy(this.forward),this.sweepForward.copy(this.forward).applyQuaternion(a.rotation).setY(0);const s=this.getOrientedAngleTo(this.sweepForward,n.getWorldDirection(this.viewForward).setY(0))+Math.PI,r=await this.requestTarget();r.setSize(us.equirectangularRes.width,us.equirectangularRes.height),this.renderToTexture.renderEquirectangular(o,r.target,s);const i=await this.encodeRenderTarget(r,this.getXmp(r.width,r.height,0,0));return this.jpegAsBase64(i)}}us.equirectangularRes={width:4096,height:2048};class hs{constructor(e,t){this.issueCommand=t.issueCommand,this.GetScreenPositionCommand=e.GetScreenPositionCommand}validateInput(e){if(!Eo(e.worldPosition))throw Error(`Renderer.getScreenPosition: 'worldPosition' was specified but was not a valid Vector3; got ${e.worldPosition}`);return e}async exec(e,t){return await this.issueCommand(new this.GetScreenPositionCommand(e))}}class ps{constructor(e,t){this.floorsData=e,this.floorCaster=t}validateInput(e){if(!function(e){if(e&&"object"==typeof e&&"x"in e&&"y"in e){const t=e;return To(t.x)&&To(t.y)}return!1}(e.screenPosition))throw Error(`Renderer.getWorldPositionData: 'screenPosition' was not a valid Vector2; got ${e.screenPosition}`);return e}async exec(e,t){const n=await this.floorCaster.getFloorIntersect(e.screenPosition,e.height,e.includeHiddenFloors),a=this.floorsData.getFloorAtIndex(n.floorIndex);return a?{position:n.position,floorInfo:{id:a.id,sequence:a.index},floor:n.floorIndex}:{position:n.position,floorInfo:{id:"",sequence:-1},floor:-1}}}function ms(e,t,n,a,o,s,r){e.id=n.getIdFromCwfId(t.id),e.label=r&&r.hasRoom(t.id)?r.getRoomLabel(t.id,""):"",e.bounds=e.bounds||{},e.bounds.min=Wa(a.boundingBox,"min",e.bounds.min),e.bounds.max=Wa(a.boundingBox,"max",e.bounds.max),e.floorInfo=function(e,t,n,a){a=a||{};try{const o=t.getFloor(e);a.id=n.getIdFromCwfId(o.id),a.sequence=o.index}catch(e){a.id="",a.sequence=-1}return a}(t.floorId,o,s,e.floorInfo)}class gs{constructor(){this.wasTransitioning360=!1,this.cameraPosition={x:0,y:0,z:0}}create(e,t,n,a,o){return new Lt(a.onChanged((()=>this.throttleCameraPositionChanges(e,a))),o.onChanged((()=>this.throttleSweepChanges(e,o))))}throttleCameraPositionChanges(e,t){const n=t.pose.position;n.x===this.cameraPosition.x&&n.y===this.cameraPosition.y&&n.z===this.cameraPosition.z||(this.cameraPosition.x=n.x,this.cameraPosition.y=n.y,this.cameraPosition.z=n.z,e.onChanged())}throttleSweepChanges(e,t){const n=t.state.transition;t.state.transition.active?(t.isSweepUnaligned(n.from)||t.isSweepUnaligned(n.to))&&(this.wasTransitioning360=!0):this.wasTransitioning360&&!t.isSweepUnaligned(t.state.currentSweep)&&(e.onChanged(),this.wasTransitioning360=!1)}}class fs{constructor(){this.currentRooms={rooms:[]}}get data(){return this.currentRooms}equals(e){return this.data.rooms.length===e.data.rooms.length&&this.currentRooms.rooms.every((t=>e.data.rooms.findIndex((e=>e.id===t.id))>-1))}copy(e){this.currentRooms.rooms.length=e.data.rooms.length,Cn(this.currentRooms.rooms,e.data.rooms)}update(e,t,n,a,o,s,r,i,c){if(o.isInside()&&a.isSweepUnaligned(a.state.currentSweep)||a.state.transition.active&&(a.isSweepUnaligned(a.state.transition.to)||a.isSweepUnaligned(a.state.transition.from)))return void(this.currentRooms.rooms.length=0);const d=s.meshSubGroupsFromPoint(n.pose.position);this.currentRooms.rooms.length=0;for(let n=0;n<d.length;++n){const a=d[n],o=e.getByMeshSubgroup(a),l=s.meshGroups.rooms.get(a);if(!o||!l)continue;const u=this.currentRooms.rooms[n]||{};ms(u,o,r,l,t,i,c.get()),this.currentRooms.rooms.push(u)}}}class ws{constructor(){}create(e,t){return{renew(){},cancel(){}}}}class ys{constructor(e,t,n,a,o,s){this.roomData=e,this.floorData=t,this.roomIdMap=n,this.floorIdMap=a,this.meshData=o,this.roomBoundData=s,this._data={}}get data(){return this._data}isItemEqual(e,t){const n=this.data[t],a=e.data[t];return n.id===a.id&&Mn(n.bounds.min,a.bounds.min)&&Mn(n.bounds.max,a.bounds.max)}update(){for(const e of this.roomData.rooms()){const t=this.meshData.meshGroups.rooms.get(e.meshSubgroup);if(!t)continue;const n=this.roomIdMap.getIdFromCwfId(e.id),a=this._data[n]||{};ms(a,e,this.roomIdMap,t,this.floorData,this.floorIdMap,this.roomBoundData.get()),this._data[n]=a}for(const e in this.data){this.roomIdMap.getRoomForId(e)||delete this._data[e]}}clear(){this._data={}}}class vs{constructor(e,t){this.RoomData=e,this.FloorsData=t}validateInput(e){return{invert:!!(null==e?void 0:e.invert)||!1}}async exec(e,t){return this.RoomData.getRoomIdMap(this.FloorsData,e.invert)}}class Ts{constructor(e){this.roomBoundViewData=e}validateInput(e){return{visible:!!e.visible}}async exec(e){await this.roomBoundViewData.forceRoomDimensionVisibility(e.visible)}}!function(e){e.OUTPUT="output",e.INPUT="input",e.EVENT="event",e.EMIT="emit"}(ds||(ds={}));class Is{constructor(e){this.sceneModule=e}validateInput(e){if(!te(e.name))throw Error(`Scene.register name ${e.name} is not a string`);if(!e.factory||"function"!=typeof e.factory)throw Error("Scene.register factory is not a function");return e}async exec(e,t){if(this.sceneModule.registerFactory({scope:t.client.applicationKey,name:e.name},e.factory))return{dispose:()=>{this.sceneModule.unregisterFactory(e.name,e.factory)}};throw Error("There was an error registering the scene component")}}class bs{constructor(e){this.sceneModule=e}validateInput(e){return e}async exec(e,t){return this.sceneModule.createNode(t.client.applicationKey,{owner:t.client.id}).publicFacade()}}class Es extends ge{constructor(e){super(),this.payload=e}}Es.id="SCENE_QUERY";class Ss extends ge{constructor(e){super(),this.payload=e}}Ss.id="SCENE_CONFIGURE";class Cs extends ge{constructor(e){super(),this.payload=e}}Cs.id="SCENE_GETIMAGE";(class extends ge{constructor(e){super(),this.payload=e}}).id="SCENE_EXPORT";class As{constructor(e){this.sceneModule=e}validateInput(e){return e}async exec(e,t){return this.sceneModule.deserialize(t.client.applicationKey,e.text,t.client.id).object}}const Os=new Zt("serialize");class Ds{constructor(e){this.sceneModule=e}validateInput(e){return e}async exec(e,t){Array.isArray(e.objects)&&Os.warn("Serializing an array of ISceneNodes is deprecated and may produce an unexpected result.                Serialization of the ISceneObject container should be done instead.");return Array.isArray(e.objects)?this.sceneModule.serializeNodeList(e.objects):this.sceneModule.serialize(e.objects)}}class Ms{constructor(e){this.sceneModule=e}validateInput(e){if(!To(e.count))throw Error("count is not a valid number");return e}async exec(e,t){const n=[];for(let a=0;a<e.count;a++){const e=this.sceneModule.createNode(t.client.applicationKey,{owner:t.client.id});n.push(e.publicFacade())}return n}}class xs{constructor(e){this.sceneModule=e}validateInput(e){if(!Da(e.components,va))throw Error("Scene.registerComponents array elements must be objects");for(const t of e.components){if(!te(t.name))throw Error(`Scene.registerComponents name ${t.name} is not a string`);if(!t.factory||"function"!=typeof t.factory)throw Error("Scene.registerComponents factory is not a function")}return e}async exec(e,t){const n=[];for(const a of e.components){if(!this.sceneModule.registerFactory({scope:t.client.applicationKey,name:a.name},a.factory))throw Error("There was an error registering a scene component");{const e=this.sceneModule,t=function(t,n){return{dispose:function(){e.unregisterFactory(t,n)}}}(a.name,a.factory);n.push(t)}}return n}}class Rs{constructor(e){this.sceneModule=e}validateInput(e){if(!To(e.count))throw Error("count is not a valid number");return e}async exec(e,t){const n=[];for(let a=0;a<e.count;a++)n.push(this.sceneModule.createObject(t.client.applicationKey,{owner:t.client.id}).publicFacade());return n}}(class extends ge{constructor(e){super(),this.payload=e}}).id="SCENE_UNREGISTER_COMPONENTS";class Ps{constructor(e){this.sceneModule=e}validateInput(e){if(e=e||{},!Array.isArray(e.components))throw Error("components must be an array");return e.components=e.components||[],e}async exec(e){for(const t of e.components)this.sceneModule.unregisterFactory(t.name,t.factory)}}class Ns{constructor(e,t){this.sensorModule=e,this.sensorMap=t}validateInput(e){if(!te(e.sensorId)||!this.sensorMap.has(e.sensorId))throw Error("dev error: this should not occur unless the sdk was not setup properly");if(!Ta(e.show))throw Error(`Sensor.showDebug: 'show' was not a boolean; got ${e.show}`);return{sensorId:e.sensorId,show:e.show}}async exec(e){if(e.show){const t=this.sensorMap.get(e.sensorId);this.sensorModule.setDebugSensor(t)}else this.sensorModule.setDebugSensor(null)}}class _s{constructor(e){this.sensor=e,this.sourceMap=new Map,this.reverseSourceLookup=new Map,this.sourceId=0,this._data={}}get data(){return this._data}isItemEqual(e,t){return e.data[t].inRange===this.data[t].inRange&&e.data[t].inView===this.data[t].inView}update(){for(const[e,t]of this.sensor.readings){const n=this.addOrGetSourceId(e),a=this._data[n]||{};a.inRange=t.inRange,a.inView=t.inView,a.distanceSquared=t.distanceSq,a.direction=Wa(t,"direction",a.direction),this._data[n]=a}for(const e in this.data){const t=this.reverseSourceLookup.get(e);t&&!this.sensor.readings.get(t)&&(this.sourceMap.delete(t),this.reverseSourceLookup.delete(e),delete this._data[e])}}clear(){this._data={}}addOrGetSourceId(e){const t=this.sourceMap.get(e);if(t)return t;const n="source-"+ ++this.sourceId;return this.sourceMap.set(e,n),this.reverseSourceLookup.set(n,e),n}}class ks{constructor(){this._data={origin:{x:0,y:0,z:0},forward:{x:0,y:0,z:-1}}}get data(){return this._data}equals(e){const t=1e-5;return Mn(this.data.origin,e.data.origin,t)&&Mn(this.data.forward,e.data.forward,t)}copy(e){En(this._data.origin,e.data.origin),En(this._data.forward,e.data.forward)}update(e){En(this._data.origin,e.frustum.origin),En(this._data.forward,e.frustum.forward)}}class Ls{constructor(e,t,n,a,o){this.sdk=e,this.sensorFactories=t,this.sensors=n,this.sensorMap=a,this.removerMap=o}validateInput(e){if(!yn(C.SensorType,e.type))throw Error(e.type+" is not a valid sensor type");return this.sensorFactories[e.type].validateInput(e)}async exec(e,t){const n=this.sensorFactories[e.type].create(e,this.sensors),a="sensor-"+ ++Ls.nextSensorId;this.sensorMap.set(a,n);const o=de.create(new z(n),new Fs,new $(ks)),s=this.sdk.addObservable(a,o),r=sa.create(new z(n),new Us,new $(_s)),i=this.sdk.addCollection(a,r);return this.removerMap.set(a,{dispose(){s.dispose(),i.dispose()}}),{sensorId:a}}}Ls.nextSensorId=0;class Vs{validateInput(e){return e}create(e,t){return t.createCameraBoundSensor()}}class Fs{create(e,t){return t.frustum.observe(new Gs(e))}}class Us{create(e,t){return t.onReadingsUpdated(new Gs(e))}}class Gs{constructor(e){this.dependencyObserver=e}notify(){this.dependencyObserver.onChanged()}}class Hs{constructor(e,t){this.sensorMap=e,this.sourceMap=t}validateInput(e){if(!te(e.sensorId)||!this.sensorMap.has(e.sensorId))throw Error("dev error: this should not occur unless the sdk was not setup properly");if(!Da(e.sourceIds,te))throw Error("dev error: this should not occur unless the sdk was not setup properly");for(const t of e.sourceIds)if(!this.sourceMap.has(t))throw Error("dev error: this should not occur unless the sdk was not setup properly");return{sensorId:e.sensorId,sourceIds:e.sourceIds}}async exec(e){const t=this.sensorMap.get(e.sensorId),n=e.sourceIds.map(this.sourceMap.get,this.sourceMap);t.addSource(...n)}}class Bs{constructor(e,t){this.sensorMap=e,this.removerMap=t}validateInput(e){if(!te(e.sensorId)||!this.sensorMap.has(e.sensorId))throw Error("dev error: this should not occur unless the sdk was not setup properly");return{sensorId:e.sensorId}}async exec(e){this.removerMap.get(e.sensorId).dispose();this.sensorMap.get(e.sensorId).dispose()}}const zs={namespace:"Sensor",name:"createSensor",subRoutine:"sensor.create",args:[]},$s={namespace:"Sensor",name:"addSource",varArg:!0,args:["sensorId","sourceIds"]},js={namespace:"Sensor",name:"dispose",args:["sensorId"]},qs={namespace:"Sensor",name:"showDebug",args:["sensorId","show"]},Ws={namespace:"Sensor",name:"createSource",subRoutine:"source.create",args:["type","options"]},Ks={namespace:"Sensor",name:"updateSource",args:["sourceId","type","options"]};class Ys{constructor(e,t,n){this.radius=1/0,this.type=e.SPHERE,this._volume=t}get origin(){return this._volume.origin}get volume(){return this._volume}describeVolume(){return{origin:this._volume.origin,radius:this._volume.radius}}}const Xs=Math.PI/180;class Zs{constructor(e,t,n){this.type=e.BOX,this._volume=t,this.eulerCache=new n.Euler,this.quaternionCache=new n.Quaternion}get origin(){return this._volume.origin}get volume(){return this._volume}describeVolume(){return{center:this._volume.center,size:this._volume.size,orientation:this.convertQuaternionToOrientation(this._volume.orientation)}}updateOrientation(e){this.eulerCache.set(e.pitch*Xs,e.yaw*Xs,e.roll*Xs,"YXZ"),this.quaternionCache.setFromEuler(this.eulerCache),this._volume.updateOrientation(this.quaternionCache)}convertQuaternionToOrientation(e){return this.eulerCache.setFromQuaternion(this.quaternionCache.set(e.x,e.y,e.z,e.w)).reorder("YXZ"),{yaw:this.eulerCache.y*Xs,pitch:this.eulerCache.x*Xs,roll:this.eulerCache.z*Xs}}}class Qs{constructor(e,t,n){this.type=e.CYLINDER,this._volume=t}get origin(){return this._volume.origin}get volume(){return this._volume}describeVolume(){return{basePoint:this._volume.basePoint,height:this._volume.height,radius:this._volume.radius}}}function Js(e){if(e&&"object"==typeof e&&"yaw"in e&&"pitch"in e&&"roll"in e){const t=e;return To(t.yaw)&&To(t.pitch)&&To(t.roll)}return!1}class er{constructor(e,t){this.sourceFactories=e,this.sourceMap=t}validateInput(e){if(!yn(C.SourceType,e.type))throw Error(e.type+" is not a valid source type");return this.sourceFactories[e.type].validateInput(e)}async exec(e){const t=this.sourceFactories[e.type].create(e),n="source-"+ ++er.nextSourceId;return this.sourceMap.set(n,t),{sourceId:n,type:e.type,volume:t.describeVolume()}}}er.nextSourceId=0;class tr{constructor(e,t,n){this.sourceType=e,this.sphereVolumeFactory=t,this.THREE=n}validateInput(e){if(va(e.options)){if(e.options.origin&&!Eo(e.options.origin))throw Error(`Source.Box: 'origin' was specified but was not a valid Vector3; got ${e.options.origin}`);if(e.options.radius&&(!To(e.options.radius)||e.options.radius<0))throw Error(`Source.Sphere: 'radius' was specified but was not a positive number or Infinity; got ${e.options.radius}`)}const t=e.options||{};return{type:e.type,options:{origin:t.origin||{x:0,y:0,z:0},radius:t.hasOwnProperty("radius")?t.radius:1/0}}}create(e){const t=new Ys(this.sourceType,new this.sphereVolumeFactory,this.THREE),n=t.volume;return n.updateOrigin(e.options.origin),n.updateRadius(e.options.radius),t}}class nr{constructor(e,t,n){this.sourceType=e,this.boxVolumeFactory=t,this.THREE=n}validateInput(e){if(va(e.options)){if(e.options.center&&!Eo(e.options.center))throw Error(`Source.Box: 'center' was specified but was not a valid Vector3; got ${e.options.center}`);if(e.options.size&&(!Eo(e.options.size)||e.options.size.x<0||e.options.size.y<0||e.options.size.z<0))throw Error(`Source.Box: 'size' was specified but was not a valid Vector3; got ${e.options.size}`);if(e.options.orientation&&!Js(e.options.orientation))throw Error(`Source.Box: 'orientation' was specified but was not a valid Orientation; got ${e.options.orientation}`)}const t=e.options||{};return{type:e.type,options:{center:t.center||{x:0,y:0,z:0},size:t.size||{x:1/0,y:1/0,z:1/0},orientation:t.orientation||{yaw:0,pitch:0,roll:0}}}}create(e){const t=new Zs(this.sourceType,new this.boxVolumeFactory,this.THREE),n=t.volume;return n.updateCenter(e.options.center),n.updateDimensions(e.options.size),t.updateOrientation(e.options.orientation),t}}class ar{constructor(e,t,n){this.sourceType=e,this.cylinderVolumeFactory=t,this.THREE=n}validateInput(e){if(va(e.options)){if(e.options.basePoint&&!Eo(e.options.basePoint))throw Error(`Source.Cylinder: 'basePoint' was specified but was not a valid Vector3; got ${e.options.basePoint}`);if(e.options.hasOwnProperty("height")&&(!To(e.options.height)||e.options.height<0))throw Error(`Source.Cylinder: 'height' was specified but was not a positive number or Infinity; got ${e.options.height}`);if(e.options.hasOwnProperty("radius")&&(!To(e.options.radius)||e.options.radius<0))throw Error(`Source.Cylinder: 'radius' was specified but was not a positive number or Infinity; got ${e.options.radius}`)}const t=e.options||{};return{type:e.type,options:{basePoint:t.basePoint||{x:0,y:0,z:0},height:t.hasOwnProperty("height")?t.height:1/0,radius:t.hasOwnProperty("radius")?t.radius:1/0}}}create(e){const t=new Qs(this.sourceType,new this.cylinderVolumeFactory,this.THREE),n=t.volume;return n.updateBasePoint(e.options.basePoint),n.updateHeight(e.options.height),n.updateRadius(e.options.radius),t}}class or{constructor(e,t){this.sourceUpdaters=e,this.sourceMap=t}validateInput(e){if(!te(e.sourceId)||!this.sourceMap.has(e.sourceId))throw Error("dev error: this should not occur unless the sdk was not setup properly");const t=this.sourceMap.get(e.sourceId);return this.sourceUpdaters[t.type].validateInput(e)}async exec(e){const t=this.sourceMap.get(e.sourceId);this.sourceUpdaters[t.type].update(e,t)}}class sr{validateInput(e){if(!va(e.options))throw Error("Source.Sphere.update: invalid options provided to .update");if(!Eo(e.options.origin))throw Error(`Source.Sphere.update: 'origin' was specified but was not a valid Vector3; got ${e.options.origin}`);if(!To(e.options.radius)||e.options.radius<0)throw Error(`Source.Sphere.update: 'radius' was specified but was not a positive number or Infinity; got ${e.options.radius}`);return e}update(e,t){const n=t.volume;n.updateOrigin(e.options.origin),n.updateRadius(e.options.radius),n.notify()}}class rr{validateInput(e){if(!va(e.options))throw Error("Source.Box.update: invalid options provided to .update");if(e.options.center&&!Eo(e.options.center))throw Error(`Source.Box.update: 'center' was specified but was not a valid Vector3; got ${e.options.center}`);if(e.options.size&&!(Eo(e.options.size)&&e.options.size.x>=0&&e.options.size.y>=0&&e.options.size.z>=0))throw Error(`Source.Box.update: 'size' was specified but was not a valid Vector3; got ${JSON.stringify(e.options.size)}\n        ${"object"==typeof e}`);if(e.options.orientation&&!Js(e.options.orientation))throw Error(`Source.Box.update: 'orientation' was specified but was not a valid Orientation; got ${e.options.orientation}`);return e}update(e,t){const n=t.volume;n.updateCenter(e.options.center),n.updateDimensions(e.options.size),t.updateOrientation(e.options.orientation),n.notify()}}class ir{validateInput(e){if(!va(e.options))throw Error("Source.Cylinder.update: invalid options provided to .update");if(e.options.basePoint&&!Eo(e.options.basePoint))throw Error(`Source.Cylinder.update: 'basePoint' was specified but was not a valid Vector3; got ${e.options.basePoint}`);if(e.options.hasOwnProperty("height")&&(!To(e.options.height)||e.options.height<0))throw Error(`Source.Cylinder.update: 'height' was specified but was not a positive number or Infinity; got ${e.options.height}`);if(e.options.hasOwnProperty("radius")&&(!To(e.options.radius)||e.options.radius<0))throw Error(`Source.Cylinder: 'radius' was specified but was not a positive number or Infinity; got ${e.options.radius}`);return e}update(e,t){const n=t.volume;n.updateBasePoint(e.options.basePoint),n.updateHeight(e.options.height),n.updateRadius(e.options.radius),n.notify()}}function cr(e,t,n){const a=new Map,o=new Map;return function(s,r){!function(e,t,n,a){const o=new Map,s=X.create(new z(t,n),new $(Hs)),r=X.create(new z(t,o),new $(Bs)),i=X.create(z.extend(a,t),new $(Ns));e.addCommandUnlisted($s,s),e.addCommandUnlisted(js,r),e.addCommandUnlisted(qs,i);const c={[C.SensorType.CAMERA]:new Vs},d=X.create(z.extend(a,t,o),new $(Ls,e,c));e.addCommandToInterface(zs,d),e.addEnumToInterface({namespace:"Sensor",name:"SensorType",values:C.SensorType})}(s,a,o,r),function(e,t,n,a,o){const s=new z(t),r={[a.SPHERE]:new sr,[a.BOX]:new rr,[a.CYLINDER]:new ir},i=X.create(s,new $(or,r));e.addCommandUnlisted(Ks,i);const c={[C.SourceType.SPHERE]:new tr(a,o.sphere,n),[C.SourceType.BOX]:new nr(a,o.box,n),[C.SourceType.CYLINDER]:new ar(a,o.cylinder,n)},d=X.create(s,new $(er,c));e.addCommandToInterface(Object.assign({},Ws),d),e.addEnumToInterface({namespace:"Sensor",name:"SourceType",values:C.SourceType})}(s,o,e,t,n)}}var dr;!function(e){e.FPS="stat.fps"}(dr||(dr={}));class lr{constructor(e,t){this.perfStatInterval=1e3,this.elapsedTime=0,this.frameCount=0,this.lastCalcTime=0,this.fps=[0],this.waitForUpdate=e,this.perfStatInterval=t.tryGetSetting("perfInterval",this.perfStatInterval)}async calcAndBroadcast(e){await this.waitForUpdate();const t=Date.now(),n=t-this.lastCalcTime;this.lastCalcTime=t,this.elapsedTime+=n,this.frameCount++,this.elapsedTime>=this.perfStatInterval&&(this.fps[0]=1e3*this.frameCount/this.elapsedTime,this.elapsedTime=0,this.frameCount=0,e.broadcast(dr.FPS,(()=>this.fps))),this.calcAndBroadcast(e)}}function ur(e,t="",n=""){let a="sdkStorage/";return t&&t.length>0&&(a=a+t+"/"),n&&n.length>0&&(a=a+n+"/"),a+e}class hr{constructor(e){this.modelData=e}validateInput(e){const t=null==e?void 0:e.key;if(!t||"string"!=typeof t)throw Error(t+" is not a valid key");return e}async exec(e){localStorage.setItem(ur(e.key,this.modelData.model.sid),JSON.stringify(e.data))}}class pr{constructor(e){this.modelData=e}validateInput(e){const t=null==e?void 0:e.key;if(!t||"string"!=typeof t)throw Error(t+" is not a valid key");return{key:e.key}}async exec(e){const t=localStorage.getItem(ur(e.key,this.modelData.model.sid));return t?JSON.parse(t):null}}class mr{constructor(e){this.modelData=e}validateInput(e){let t=null==e?void 0:e.modelId;if(null==t)t=this.modelData.model.sid;else if("*"===t)t="";else if("string"!=typeof t)throw Error(t+" is not a valid key");return{modelId:t}}async exec(e){const t=ur("",e.modelId),n={};for(const[e,a]of Object.entries(localStorage))e.startsWith(t)&&(n[e.slice(t.length)]=JSON.parse(a));return n}}class gr{constructor(e){this.modelData=e}validateInput(e){const t=null==e?void 0:e.key;if(!t||"string"!=typeof t)throw Error(t+" is not a valid key");return{key:e.key}}async exec(e){localStorage.removeItem(ur(e.key,this.modelData.model.sid))}}class fr{constructor(e,t){this.toSdkAlignmentMap={[e.ALIGNED]:A.Alignment.ALIGNED,[e.UNALIGNED]:A.Alignment.UNALIGNED},this.toSdkPlacementMap={[t.UNPLACED]:A.Placement.UNPLACED,[t.AUTO]:A.Placement.AUTO,[t.MANUAL]:A.Placement.MANUAL}}toSdkAlignment(e){return this.toSdkAlignmentMap[e]}toSdkPlacement(e){return this.toSdkPlacementMap[e]}}const wr=Object.freeze({signedUrlDefaultExpireTime:24e4,signedUrlCheckInterval:1e4,signedUrlRefreshBuffer:15e3,visionTilingStartDate:new Date("8/26/2016"),visionTilingStartVersion:"1.1.407.13667",defurnishableStartDate:new Date("03/10/2023"),defurnishableStartVersion:"1.2.29221.4-gcac59bd3ec.REL_1425",epsilon:1e-5,skyboxMeshGroup:"_group_skybox_",skysphereMeshGroup:"_group_skysphere_"});function yr(e,t){if(!e||!t)return null;let n=null;for(const a of t.rooms.values())if(a.floorId===e.floorId&&a.containsPoint(e.floorPosition.x,e.floorPosition.z)){n=a;break}return n}class vr{constructor(){this.currentSweep="",this.sweepTransitionActive=!1,this.currentMode=null,this.modeTransitionActive=!1}create(e,t,n){return new Lt(t.onChanged((()=>this.throttleSweepDataChanges(e,t))),n.onChanged((()=>this.throttleViewmodeDataChanges(e,n))))}throttleSweepDataChanges(e,t){const n=t.state.currentSweep||"",a=t.state.transition.active&&t.state.transition.to!==t.state.transition.from;this.currentSweep===n&&this.sweepTransitionActive===a||(this.currentSweep=n,this.sweepTransitionActive=a,e.onChanged())}throttleViewmodeDataChanges(e,t){const n=t.currentMode,a=t.transition.active;this.currentMode===n&&this.modeTransitionActive===a||(this.currentMode=n,this.modeTransitionActive=a,e.onChanged())}}class Tr{constructor(e,t){this.currentSweep=Object.assign(Object.assign({},Tr.empty),{puckPosition:Object.assign({},Tr.empty.puckPosition),floorInfo:Object.assign({},Tr.empty.floorInfo),neighbors:[],position:Object.assign({},Tr.empty.position),rotation:Object.assign({},Tr.empty.rotation)}),this.Viewmode=e.Viewmode,this.sweepPlacementConverter=t.sweepPlacementConverter}get data(){return this.currentSweep}equals(e){const t=wr.epsilon;return this.currentSweep.id===e.data.id&&this.currentSweep.enabled===e.data.enabled&&this.currentSweep.alignmentType===e.data.alignmentType&&this.currentSweep.placementType===e.data.placementType&&this.currentSweep.floorInfo.id===e.data.floorInfo.id&&this.currentSweep.floorInfo.sequence===e.data.floorInfo.sequence&&this.compareNeighbors(e.currentSweep)&&Mn(this.currentSweep.position,e.data.position,t)&&Mn(this.currentSweep.rotation,e.data.rotation,t)&&Mn(this.currentSweep.puckPosition,e.data.puckPosition,t)}copy(e){this.copySweep(e.data)}update(e,t,n,a,o,s){const r=e.currentSweepObject;if(!r||e.state.transition.active||t.transition.active||!t.isInside()&&t.currentMode!==this.Viewmode.Outdoor)return void this.copySweep(Tr.empty);let i;try{i=n.getFloor(r.floorId||"")}catch(e){i={id:void 0,index:void 0}}const c=s&&yr(r,s.get()||null),d=a.getIdForSweep(r);this.currentSweep.uuid=r.uuid,this.currentSweep.sid=d,this.currentSweep.id=d,this.currentSweep.enabled=r.enabled,this.currentSweep.alignmentType=this.sweepPlacementConverter.toSdkAlignment(r.alignmentType),this.currentSweep.placementType=this.sweepPlacementConverter.toSdkPlacement(r.placementType),this.currentSweep.neighbors=[...r.neighbours.map((t=>e.getSweep(t)?a.getIdFromCwfId(t):null))].filter((e=>null!==e)),this.currentSweep.roomInfo.id=c?c.id:void 0,En(this.currentSweep.position,r.position),En(this.currentSweep.rotation,r.rotation),En(this.currentSweep.puckPosition,r.floorPosition),this.currentSweep.alignmentType===A.Alignment.UNALIGNED&&this.currentSweep.placementType===A.Placement.UNPLACED?(this.currentSweep.floorInfo.id=void 0,this.currentSweep.floorInfo.sequence=void 0):(this.currentSweep.floorInfo.id=i.id?o.getIdFromCwfId(i.id):i.id,this.currentSweep.floorInfo.sequence=i.index)}copySweep(e){this.currentSweep.uuid=e.uuid,this.currentSweep.sid=e.sid,this.currentSweep.id=e.id,this.currentSweep.enabled=e.enabled,this.currentSweep.alignmentType=e.alignmentType,this.currentSweep.placementType=e.placementType,this.currentSweep.floorInfo.id=e.floorInfo.id,this.currentSweep.floorInfo.sequence=e.floorInfo.sequence,this.currentSweep.neighbors=[...e.neighbors],this.currentSweep.roomInfo.id=e.roomInfo.id,En(this.currentSweep.position,e.position),En(this.currentSweep.rotation,e.rotation),En(this.currentSweep.puckPosition,e.puckPosition)}compareNeighbors(e){const t=this.currentSweep.neighbors.length;for(let n=0;n<t;++n)if(this.currentSweep.neighbors[n]!==e.neighbors[n])return!1;return t===e.neighbors.length}}Tr.empty={uuid:"",sid:"",id:"",enabled:!1,alignmentType:A.Alignment.ALIGNED,placementType:A.Placement.UNPLACED,puckPosition:{x:0,y:0,z:0},floorInfo:{id:void 0,sequence:void 0},neighbors:[],position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},roomInfo:{id:void 0}};class Ir{constructor(e,t,n,a){this.sweepData=n,this.sweepIdMap=a,this.NavigateToSweepCommand=e.NavigateToSweepCommand,this.issueCommand=t.issueCommand,this.cameraTransitionConverter=t.cameraTransitionConverter,this.conversion=t.conversionUtils}validateInputSweepId(e,t,n){if(!e||!te(e))throw Error(`Sweep.moveTo: 'sweep' was not a valid sweep id; got ${e}`);const a=n.getSweepForId(e);if(!a)throw Error(e+" does not map to a valid sweep in this model");return a.id}validateInputRotation(e){if(!e)return;const t=Error(`Sweep.moveTo: 'options.rotation' was specified but was not a valid Rotation; got ${e}`);if(e&&!va(e))throw t;const n=e||{},a={x:Io(n.x),y:Io(n.y)};if(n.z&&(a.z=Io(n.z)),!function(e){const t=e;return!!t&&!("object"!=typeof t||"z"in t&&!To(t.z))&&To(t.x)&&To(t.y)}(a))throw t;return a}validateTransitionTime(e){if(!e)return;const t=Error(`Sweep.moveTo: options.transitionTime was specified but was not a valid, positive time; got ${e}`);if(!To(e)&&!te(e))throw t;const n="number"==typeof e?e:Io(e);if(!To(n)||n<=0)throw t;return n}validateInput(e){const t=this.validateInputSweepId(e.sweep,this.sweepData,this.sweepIdMap),n=e.options||{},a=this.validateInputRotation(n.rotation),o=this.validateTransitionTime(n.transitionTime);if(n.transition&&!yn(P,n.transition))throw Error(`Sweep.moveTo: options.transition was specified but was not a valid transition type; got ${n.transition}`);return{sweep:t,options:{rotation:a,transition:n.transition,transitionTime:o}}}async exec(e,t){const n=e.options.rotation?this.conversion.rotationToQuaternion(e.options.rotation):void 0,a=e.options.transition,o=e.options.transition?this.cameraTransitionConverter.fromSdkTransition(a):void 0,s=e.options.transitionTime;return await this.issueCommand(new this.NavigateToSweepCommand({sweep:e.sweep,rotation:n,transition:o,transitionTime:s}))}}class br{create(e,t){return t.onChanged((()=>e.onChanged()))}}class Er{constructor(e,t,n,a,o,s,r){this.sweepData=n,this.floorsData=a,this.sweepIdMap=o,this.floorIdMap=s,this.roomBoundData=r,this._data={},this.conversionUtils=e,this.sweepPlacementConverter=t}get data(){return this._data}isItemEqual(e,t){return!he(this.data[t],e.data[t])}update(){const e={};for(const t of this.sweepData.sweeps()){const{id:n,index:a}=t.floorId?this.floorsData.getFloor(t.floorId):{id:"",index:-1},o=n?this.floorIdMap.getIdFromCwfId(n):void 0,s=this.sweepIdMap.getIdFromCwfId(t.id);e[s]=t.id;const r=this.data[s]||{};r.uuid=t.uuid,r.sid=s,r.id=s,r.enabled=t.enabled,r.alignmentType=this.sweepPlacementConverter.toSdkAlignment(t.alignmentType),r.placementType=this.sweepPlacementConverter.toSdkPlacement(t.placementType),r.neighbors=[...t.neighbours.map((e=>this.sweepData.getSweep(e)?this.sweepIdMap.getIdFromCwfId(e):null))].filter((e=>null!==e)),r.position=Sr(t.position,r.position),r.rotation=this.conversionUtils.quaternionToRotation(t.rotation,r.rotation),r.puckPosition=Sr(t.floorPosition,r.puckPosition),r.floorInfo=o?{id:o,sequence:a}:{id:"",sequence:-1};const i=this.roomBoundData&&yr(t,this.roomBoundData.get()||null);r.roomInfo={id:i?i.id:void 0},this.data[r.id]=r}for(const t in this.data)this.sweepData.containsSweep(e[t])||delete this.data[t]}clear(){this._data={}}}function Sr(e,t){return(t=t||{}).x=e.x,t.y=e.y,t.z=e.z,t}class Cr{constructor(e){this.sweepData=e}validateInput(e){return{invert:!!(null==e?void 0:e.invert)||!1}}async exec(e,t){return this.sweepData.getSweepIdMap(e.invert)}}class Ar{constructor(e){this.sweepData=e}validateInput(e,t){const n=null==e?void 0:e.id;if(!n)throw Error("Sweep.GetLabelFromIdExecutor: Missing input 'id' field");if(!ne(n))throw Error(`Sweep.GetLabelFromIdExecutor: provided ${null==e?void 0:e.id} is not a valid string`);return{id:n}}async exec(e,t){var n,a;let o=null===(n=this.sweepData.getSweep(e.id))||void 0===n?void 0:n.index;return void 0===o&&(o=null===(a=this.sweepData.getSweepByUuid(e.id))||void 0===a?void 0:a.index),void 0!==o?(o+1).toString():null}}class Or{constructor(e,t){this.sweepData=e,this.sweepIdMap=t}validateInput(e){return{sweepIds:Mr(e.sweepIds,this.sweepData,this.sweepIdMap)}}async exec(e,t){for(const t of e.sweepIds)xr(t,!0,this.sweepData)}}class Dr{constructor(e,t){this.sweepData=e,this.sweepIdMap=t}validateInput(e){return{sweepIds:Mr(e.sweepIds,this.sweepData,this.sweepIdMap)}}async exec(e,t){for(const t of e.sweepIds)xr(t,!1,this.sweepData)}}function Mr(e,t,n){if(!Array.isArray(e))throw Error();return e.map((e=>function(e,t,n){if(!te(e))throw Error(e+" is not a valid string input");const a=n.getSweepForId(e);if(!a)throw Error(e+" does not map to a valid sweep in this model");return a.id}(e,0,n)))}function xr(e,t,n){const a=n.getSweep(e);a.enabled=t,a.commit()}class Rr{constructor(e,t,n){this.sweepData=n,this.SweepNeighborModifyCommand=e.SweepNeighborModifyCommand,this.issueCommand=t.issueCommand}validateInput(e,t){const n=null==e?void 0:e.sweepId;if(!n)throw Error("Sweep.AddSweepNeighborsExecutor: Missing input 'sweepId' field");if(!ne(n))throw Error(`Sweep.AddSweepNeighborsExecutor: provided "${null==e?void 0:e.sweepId}" is not a valid string`);if(!this.sweepData.containsSweep(e.sweepId))throw Error(`Sweep.AddSweepNeighborsExecutor: provided sweep ID "${null==e?void 0:e.sweepId}" is not a valid V2 ID`);const a=this.sweepData;const o=null==e?void 0:e.toAdd;if(!o||!Da(o,(function(e){const t=a.containsSweep(e);return ne(e)&&t})))throw Error("Sweep.AddSweepNeighborsExecutor: Invalid list of neighbors to add");return{sweepId:n,toAdd:o}}async exec(e,t){const n=this.sweepData.getSweep(e.sweepId);return await this.issueCommand(new this.SweepNeighborModifyCommand(n.id,e.toAdd)),this.sweepData.getSweep(e.sweepId).neighbours}}class Pr{constructor(e,t,n){this.sweepData=n,this.SweepNeighborModifyCommand=e.SweepNeighborModifyCommand,this.issueCommand=t.issueCommand}validateInput(e,t){const n=null==e?void 0:e.sweepId;if(!n)throw Error("Sweep.RemoveSweepNeighborsExecutor: Missing input 'sweep' field");if(!ne(n))throw Error(`Sweep.RemoveSweepNeighborsExecutor: provided "${null==e?void 0:e.sweepId}" is not a valid string`);if(!this.sweepData.containsSweep(e.sweepId))throw Error(`Sweep.AddSweepNeighborsExecutor: provided sweep ID "${null==e?void 0:e.sweepId}" is not a valid V2 Sweep ID`);const a=this.sweepData;const o=null==e?void 0:e.toRemove;if(!o||!Da(o,(function(e){const t=a.getSweep(n).neighbours.includes(e);return ne(e)&&t})))throw Error("Sweep.RemoveSweepNeighborsExecutor: Invalid list of neighbors to remove.");return{sweepId:n,toRemove:o}}async exec(e,t){const n=this.sweepData.getSweep(e.sweepId);return await this.issueCommand(new this.SweepNeighborModifyCommand(n.id,[],e.toRemove)),this.sweepData.getSweep(e.sweepId).neighbours}}class Nr{create(e,t){return t.onChanged({notify(){e.onChanged()}})}}class _r{constructor(e){this.attachmentRegistry=e,this._data={}}get data(){return this._data}isItemEqual(e,t){return this.data[t].id===e.data[t].id&&this.data[t].src===e.data[t].src&&this.data[t].type===e.data[t].type}update(){for(const[,e]of this.attachmentRegistry.descriptors()){const t=this._data[e.id]||{};t.id=e.id,t.src=e.src,t.type=e.type,this._data[e.id]=t}for(const e in this.data){this.attachmentRegistry.has(e)||delete this._data[e]}}clear(){this._data={}}}class kr{constructor(e,t){this.mattertagData=e,this.attachmentRegistry=t,this.attachmentCounts=new Map}validateInput(e,t){te(e.tagId)||this.throw(Z("tagId","string",e.tagId)),this.mattertagData.getTag(e.tagId)||this.throw(`${e.tagId} does not map to a valid tag`),Da(e.attachmentIds,te)||this.throw(Z("attachmentId","string or strings",e.tagId));for(const n of e.attachmentIds)this.attachmentRegistry.get(t.client.applicationKey,n)||this.throw(`${n} does not map to a valid attachment`);return{tagId:e.tagId,attachmentIds:e.attachmentIds}}async exec(e,t){for(const n of e.attachmentIds){const a=this.attachmentRegistry.get(t.client.applicationKey,n);a||this.throw(`${n} does not map to a valid attachment`);const o=this.attachmentCounts.get(a)||0;this.attachmentCounts.set(a,o+1);const s=this.mattertagData.getTag(e.tagId);a.category===Va.UPLOAD?s.fileAttachments.push(a):a.category===Va.EXTERNAL?s.externalAttachments.push(a):a.category===Va.SANDBOX&&s.sandboxAttachments.push(Object.assign(Object.assign({},a),{src:a.src+`?id=${a.id}&parent=${e.tagId}&${o}`}))}this.mattertagData.commit()}throw(e){throw Error("Tag.attach: "+e)}}class Lr{constructor(e,t){this.mattertagData=e,this.attachmentRegistry=t}validateInput(e,t){te(e.tagId)||this.throw(Z("tagId","string",e.tagId)),this.mattertagData.getTag(e.tagId)||this.throw(`${e.tagId} does not map to a valid tag`),Da(e.attachmentIds,te)||this.throw(Z("attachmentId","string or strings",e.tagId));for(const n of e.attachmentIds)this.attachmentRegistry.get(t.client.applicationKey,n)||this.throw(`${n} does not map to a valid attachment`);return{tagId:e.tagId,attachmentIds:e.attachmentIds}}async exec(e,t){for(const n of e.attachmentIds){const a=this.attachmentRegistry.get(t.client.applicationKey,n);if(!a)return void this.throw(`${n} does not map to a valid attachment`);const o=this.mattertagData.getTag(e.tagId);a.category===Va.UPLOAD?Vr(o.fileAttachments,a.id):a.category===Va.EXTERNAL?Vr(o.externalAttachments,a.id):a.category===Va.SANDBOX&&Vr(o.sandboxAttachments,a.id)}this.mattertagData.commit()}throw(e){throw Error("Tag.detach: "+e)}}function Vr(e,t){const n=e.findIndex((e=>e.id===t));n>=0&&e.splice(n,1)}class Fr{constructor(e){this.attachmentRegistry=e,this.log=new Zt("tag.registerAttachment")}validateInput(e){const t=e.srcs;return Da(t,ne)||(Da(t,this.validateDescriptor)&&this.log.warn("Using attachment descriptors is deprecated and will be removed when Early Access closes."),this.throw(Z("descriptors","Array of AttachmentDescriptors or strings",t))),{srcs:t}}validateDescriptor(e,t){return va(e)||this.throw(`descriptor #${t} is not an object`),te(e.src)||this.throw(`descriptor[${t}].src is not a string`),yn(O.AttachmentType,e.type)&&e.type!==O.AttachmentType.UNKNOWN||this.throw(`descriptor[${t}].type is not a valid attachment type`),e.type===O.AttachmentType.SANDBOX&&this.throw(`descriptor[${t}] has type ${O.AttachmentType.SANDBOX} and should be registered using 'Tag.registerSandbox' instead`),!0}async exec(e,t){const n=[];for(const a of e.srcs){const e="string"==typeof a?await this.attachmentRegistry.addBySrc(t.client.applicationKey,a):this.attachmentRegistry.add(t.client.applicationKey,a);n.push(e)}return n}throw(e){throw Error("Tag.registerAttachment: "+e)}}(class extends ge{constructor(e){super(),this.payload={tags:e}}}).id="MATTERTAG_DISC_POSITIONS";class Ur extends ge{constructor(e){super(),this.payload=e}}Ur.id="ADD_MATTERTAG";(class extends ge{constructor(e){super(),this.payload={sid:e}}}).id="DELETE_MATTERTAG";class Gr extends ge{constructor(e,t,n,a){super(),this.payload={sid:e,standardOptions:t,mediaOptions:n,positionOptions:a}}}Gr.id="MATTERTAG_EDIT";class Hr extends ge{constructor(e,t,n){super(),this.payload={sid:e,attachmentOptions:t,operation:n}}}Hr.id="MATTERTAG_EDIT_ATTACHMENTS",function(e){let t;!function(e){e[e.ADD=1]="ADD",e[e.REPLACE=2]="REPLACE"}(t=e.Operation||(e.Operation={}))}(Hr||(Hr={}));class Br extends ge{constructor(e,t,n=[],a){super(),this.payload={id:e,properties:t,fileAttachments:n,embed:a}}}Br.id="MATTERTAG_NEW_SAVE";class zr extends ge{constructor(e,t,n=[],a=[],o){super(),this.payload={id:e,properties:t,pendingAttachments:n,removedAttachments:a,embed:o}}}zr.id="MATTERTAG_SAVE";const $r=new Zt("mattertag-util");function jr(e,t,n,a){const o=a.meshSubGroupsFromPoint(e);let s=1/0,r="";for(const t of n.rooms())if(o.includes(t.meshSubgroup)){const n=a.meshGroups.rooms.get(t.meshSubgroup),o=e.y-((null==n?void 0:n.boundingBox.min.y)||-1/0);o<s&&(s=o,r=t.floorId)}try{return t.getFloor(r).index}catch(e){return $r.debug("Unable to deduce floor index from position; defaulting to floor 0"),0}}function qr(e,t){return e instanceof Function?e(t):t===e}class Wr extends bt{constructor(e){super(),this.value=e}notifyObserver(e){e(this.value)}get value(){return this._value}set value(e){this._value!==e&&(this.removeChildObservables(this._value),this.addChildObservable(e),this._value=e,this.setDirty())}deepCopy(){return ue(this._value)}waitFor(e){return new Promise((t=>{if(qr(e,this._value))t();else{const n=this.onChanged((a=>{qr(e,a)&&(n.cancel(),t())}))}}))}}const Kr=new Zt("ProgressTracker");class Yr{constructor(e){this.totalTasks=e,this.taskCompleted=0,this.percentCompleted=new Wr(-1)}start(){Kr.debug("start"),this.percentCompleted.value=0}notifyTaskCompleted(){this.taskCompleted>=this.totalTasks||(this.taskCompleted++,this.percentCompleted.value=this.taskCompleted/this.totalTasks,Kr.debug(`percent completed: ${this.percentCompleted.value}`))}forceComplete(){this.percentCompleted.value=1,Kr.debug(`forceComplete: ${this.percentCompleted.value}`)}}const Xr=new Zt("command.importTags");class Zr{constructor(e,t,n,a,o,s,r,i,c){this.sdkLayer=e,this.THREE=t,this.externals=n,this.getTagsQuery=a,this.mattertagsData=o,this.floorsData=s,this.roomData=r,this.meshData=i,this.layersModule=c}validateInput(e,t){if(te(e.spaceSid)||this.throw(Z("spaceSid","string",e.spaceSid)),!e.options)return{spaceSid:e.spaceSid,options:{}};const n={};va(e.options)||this.throw("options is not an object");const a=e.options;return a.progress&&("function"==typeof a.progress?n.progress=a.progress:this.throw("progress option is not a function")),a.allowedLayers&&(Da(a.allowedLayers,ne)?n.allowedLayers=a.allowedLayers:this.throw("allowedLayers option is not an array")),{spaceSid:e.spaceSid,options:n}}async exec(e,t){const n=await this.getTagsQuery(e.spaceSid),a=[];for(const t of n)t.sid="imported-"+t.sid,this.mattertagsData.getTag(t.sid)||(e.options.allowedLayers?e.options.allowedLayers.includes(t.layerId)&&a.push(t):a.push(t));const o=[],s=a.length+1,r=new Yr(s),i=[];if(e.options.progress&&i.push(r.percentCompleted.onChanged(e.options.progress)),r.start(),!this.sdkLayer)return Xr.warn("SDK Layers is not ready to be used."),[];await this.layersModule.selectLayer(this.sdkLayer.id,!0),r.notifyTaskCompleted();for(const t of a){const n=new this.THREE.Vector3,a=new this.THREE.Vector3;n.set(t.anchorPosition.x,t.anchorPosition.y,t.anchorPosition.z),a.set(t.stemVector.x,t.stemVector.y,t.stemVector.z);const s=a.length();a.normalize();const r=jr(n,this.floorsData,this.roomData,this.meshData),i=this.floorsData.getFloorAtIndex(r);i||this.throw(`Could not add Tag ${t.sid} due to invalid floor position floorIndex: ${r} spaceId ${e.spaceSid}`),o.push({id:t.sid,positionOptions:{position:t.anchorPosition,normal:a,floorId:i.id},standardOptions:{label:t.label,description:t.description,stemVisible:t.stemVisible,stemHeight:s,color:t.color,icon:t.icon},attachmentOptions:{fileAttachments:t.fileAttachments,externalAttachments:t.externalAttachments,refreshIds:[e.spaceSid]}})}i.push(this.mattertagsData.mattertags.onElementChanged({onAdded:()=>{r.notifyTaskCompleted()}}));const c=await this.externals.issueCommand(new Ur(o));for(let e=0;e<a.length;e++){const t=a[e],n=this.mattertagsData.getTag(c[e]);n.enabled=t.enabled;for(const e of t.keywords)n.keywords.push(e)}return r.forceComplete(),i.forEach((e=>e.cancel())),c}throw(e){throw Error("Tag.importTags: "+e)}}class Qr{create(e,t){return t.onChanged((()=>e.onChanged()))}}class Jr{constructor(e,t,n,a,o,s){this.THREE=e,this.mattertagData=t,this.tagsViewData=n,this.roomIdMap=a,this.roomData=o,this.meshData=s,this._data={}}get data(){return this._data}isItemEqual(e,t){return!he(this.data[t],e.data[t])}update(){const e=e=>{const t=(new this.THREE.Vector3).set(e.x,e.y,e.z);for(const e of this.roomData.rooms()){const n=this.meshData.meshGroups.rooms.get(e.meshSubgroup);if(n&&n.boundingBox.containsPoint(t))return e}};for(const t of this.tagsViewData.getOrderedTags()){const n=this.mattertagData.getTag(t.id),a=this.data[n.sid]||{};if(a.id=n.sid,a.enabled=n.enabled,a.anchorPosition=Wa(n,"anchorPosition",a.anchorPosition),a.stemVector=Wa(n,"stemVector",a.stemVector),a.stemVisible=n.stemVisible,a.label=n.label,a.description=n.description,a.color=Ka(n,"color",a.color),a.keywords=Cn(a.keywords||[],n.keywords.values()),a.iconId=n.icon?n.icon:"",a.fontId=n.icon?n.icon.split("_")[2]:"",n.roomId)a.roomId=this.roomIdMap.getIdFromCwfId(n.roomId);else{const t=e(a.anchorPosition);t&&t.id&&(a.roomId=this.roomIdMap.getIdFromCwfId(t.id))}const o=n.fileAttachments.map((e=>e.id)),s=n.externalAttachments.map((e=>e.id)),r=n.sandboxAttachments.map((e=>e.id));a.attachments=[...o,...s,...r],this._data[n.sid]=a}for(const e in this.data){this.mattertagData.getTag(e)||delete this._data[e]}}clear(){this._data={}}}function ei(e){if(e&&"object"==typeof e&&"r"in e&&"g"in e&&"b"in e){const t=e;return To(t.r)&&To(t.g)&&To(t.b)}return!1}const ti=new Zt("command.add");class ni{constructor(e,t,n,a,o,s,r,i,c,d,l){this.THREE=e,this.Mattertag=t.Mattertag,this.issueCommand=n.issueCommand,this.isMpFontId=n.isMpFontId,this.mattertagsData=a,this.tagAttach=o,this.tagEditIcon=s,this.tagEditOpacity=r,this.attachmentRegistry=i,this.iconMaps=c,this.meshQuery=d}validateInput(e,t){const{descriptors:n}=e;return Da(n,((e,n)=>this.validateDescriptor(e,n,t)))||this.throw("descriptors is not an array"),{descriptors:n}}validateDescriptor(e,t,n){var a,o,s;if(va(e)||this.throw(`descriptor #${t} is not an object`),Eo(e.anchorPosition)||this.throw(`descriptor[${t}].anchorPosition is not vector`),Eo(e.stemVector)||this.throw(`descriptor[${t}].stemVector is not vector`),void 0===e.id||te(e.id)||this.throw(`descriptor[${t}].id is not a valid string`),void 0===e.enabled||Ta(e.enabled)||this.throw(`descriptor #${t}.enabled is not a boolean`),void 0===e.stemVisible||Ta(e.stemVisible)||this.throw(`descriptor[${t}].stemVisible is not a boolean`),void 0===e.label||ne(e.label)||this.throw(`descriptor[${t}].label is not a string`),void 0===e.description||ne(e.description)||this.throw(`descriptor[${t}].description is not a string`),void 0!==e.attachments){Da(e.attachments,ne)||this.throw(`descriptor[${t}].attachments is not an array of strings`);for(let a=0;a<e.attachments.length;++a){const o=e.attachments[a];this.attachmentRegistry.get(n.client.applicationKey,o)||this.throw(`descriptor[${t}].attachment[${a}] does not map to a valid attachment`)}}return void 0===e.color||ei(e.color)||this.throw(`descriptor[${t}].color is not a Color`),void 0!==e.opacity&&(To(e.opacity)||this.throw(`descriptor[${t}].opacity is not a number`),o=e.opacity,s=1,0<=o&&o<=s||(ti.warn(`descriptor[${t}].opacity was clamped from ${e.opacity} to the range [0, 1]`),e.opacity=bo(e.opacity,0,1))),void 0===e.iconId||te(e.iconId)||this.throw(`descriptor[${t}].iconId is not a valid string`),e.id=e.id?this.Mattertag.idGenerator.reserve(e.id):this.Mattertag.idGenerator.generate(),e.id&&te(e.id)&&this.mattertagsData.getTag(e.id)&&this.throw(`descriptor[${t}].id (${e.id}) is already in use`),!e.iconId||this.isMpFontId(e.iconId)||(null===(a=this.iconMaps.get(n.client.applicationKey))||void 0===a?void 0:a.imagePromise[e.iconId])||this.throw(`descriptor[${t}].iconId (${e.iconId}) does not map to a registered icon`),e.keywords&&!Da(e.keywords,ne)&&this.throw(`descriptor[${t}].keywords is not an array of strings`),!0}async exec(e,t){const n=[],a=[];for(let t=0;t<e.descriptors.length;t++){const o=new this.THREE.Vector3,s=new this.THREE.Vector3,r=e.descriptors[t];o.set(r.anchorPosition.x,r.anchorPosition.y,r.anchorPosition.z),s.set(r.stemVector.x,r.stemVector.y,r.stemVector.z);const i=s.length();s.normalize();const c={floorId:"",roomId:"",layerId:""};this.meshQuery.inferMeshIdsFromPoint(c,o,!0),c.floorId||this.throw(`Could not add Tag on invalid floor with index: ${c.floorId}`),n.push({id:r.id,positionOptions:{position:o,normal:s,floorId:c.floorId},standardOptions:{enabled:r.enabled,label:r.label,description:r.description,stemVisible:r.stemVisible,stemHeight:i,color:r.color,keywords:r.keywords}}),r.attachments&&a.push(t)}const o=await this.issueCommand(new Ur(n));for(let n=0;n<e.descriptors.length;n++){const a=o[n],s=e.descriptors[n];void 0!==s.opacity&&await this.tagEditOpacity.exec({id:a,opacity:s.opacity},t),void 0!==s.iconId&&this.tagEditIcon.exec({id:a,iconId:s.iconId},t),s.attachments&&this.tagAttach.exec({tagId:a,attachmentIds:s.attachments},t)}return o}throw(e){throw Error("Tag.add: "+e)}}function ai(e,t){return te(e)&&!!t.getTag(e)}class oi{constructor(e,t){this.externals=e,this.mattertagsData=t}validateInput(e,t){var n;if(!ai(e.id,this.mattertagsData))throw Error(`${e.id} does not map to a valid Tag`);if(void 0!==e.options&&!va(e.options))throw Error(Z("options","object",e.options));return{id:e.id,options:{force:!!(null===(n=e.options)||void 0===n?void 0:n.force)}}}async exec(e,t){await this.externals.issueCommand(new this.externals.OpenTagCommand(e.id,{forceOpen:e.options.force}))}}var si,ri;!function(e){e.NOTE="note",e.TAG="tag",e.OBJECT="object"}(si||(si={}));class ii{constructor(e,t){this.mattertagsData=e,this.annotationsModule=t}validateInput(e,t){var n;if(!ai(e.id,this.mattertagsData))throw Error(`${e.id} does not map to a valid Tag`);if(void 0!==e.options&&!va(e.options))throw Error(Z("options","object",e.options));return{id:e.id,options:{force:!!(null===(n=e.options)||void 0===n?void 0:n.force)}}}async exec(e,t){this.annotationsModule.dockAnnotation(e.id,si.TAG,e.options.force)}}class ci{constructor(e,t,n){this.externals=e,this.mattertagsData=t,this.tagsViewData=n}validateInput(e,t){if(!ai(e.id,this.mattertagsData))throw Error(`${e.id} does not map to a valid Tag`);return{id:e.id}}async exec(e,t){var n;(null===(n=this.tagsViewData.openTagView)||void 0===n?void 0:n.id)===e.id&&await this.externals.issueCommand(new this.externals.CloseTagCommand)}}!function(e){e.MATTERTAG="mattertag",e.NOTE="note",e.OBJECT="object"}(ri||(ri={}));ri.MATTERTAG,ri.NOTE,ri.OBJECT;var di,li,ui,hi;!function(e){e.DEFAULT="default",e.HIGHLIGHTED="highlighted",e.DIMMED="dimmed"}(di||(di={})),function(e){e.IDLE="idle",e.CREATING="creating",e.PRESSING="pressing",e.PLACING="placing",e.PLACED="placed"}(li||(li={})),function(e){e.UP="up",e.UP_LEFT="up-left",e.UP_RIGHT="up-right",e.DOWN="down",e.DOWN_LEFT="down-left",e.DOWN_RIGHT="down-right",e.LEFT="left",e.RIGHT="right"}(ui||(ui={}));class pi{constructor(){this.focusedPin=null,this.selectedPin=null,this.dockedAnnotation=null}create(e,t,n){return new Lt(t.onChanged((()=>this.throttlePinChanges(e,t))),n.onChanged((()=>this.throttleAnnotationChanges(e,n))))}throttlePinChanges(e,t){var n,a;const o=null!==(a=null===(n=t.focusedPin)||void 0===n?void 0:n.id)&&void 0!==a?a:null,s=t.selectedPinId;this.focusedPin===o&&this.selectedPin===s||(this.focusedPin=o,this.selectedPin=s,e.onChanged())}throttleAnnotationChanges(e,t){var n,a;const o=null!==(a=null===(n=t.dockedAnnotation)||void 0===n?void 0:n.id)&&void 0!==a?a:null;this.dockedAnnotation!==o&&(this.dockedAnnotation=o,e.onChanged())}}class mi{constructor(){this._data={hovered:null,selected:new Set,docked:null}}get data(){return this._data}equals(e){return this.data.hovered===e.data.hovered&&this.data.docked===e.data.docked&&(t=this.data.selected,n=e.data.selected,t.size===n.size&&[...t].every((e=>n.has(e))));var t,n}update(e,t){var n,a;const o=e.focusedPin,s=e.selectedPinId?e.getPin(e.selectedPinId):null,r=null!==(a=null===(n=t.dockedAnnotation)||void 0===n?void 0:n.id)&&void 0!==a?a:null;this._data.hovered=(null==o?void 0:o.pinType)===ri.MATTERTAG?o.id:null,this._data.selected.clear(),s&&s.pinType===ri.MATTERTAG&&this._data.selected.add(s.id),this._data.docked=r}copy(e){this._data.hovered=e.data.hovered,this._data.docked=e.data.docked,function(e,t){e.clear();for(const n of t)e.add(n)}(this._data.selected,e.data.selected)}}!function(e){e.SETUP="sandbox.setup",e.TO_SANDBOX="sandbox.to.sandbox",e.TO_CLIENT="sandbox.to.client"}(hi||(hi={}));Symbol.iterator;Symbol.iterator;class gi{constructor(){this.values=new Map}add(e,t){this.getValuesAtKey(e).add(t)}remove(e,t){const n=this.values.get(e);null==n||n.delete(t)}removeKey(e){this.values.delete(e)}getValuesAtKey(e){const t=this.values.get(e)||new Set;return this.values.set(e,t),t}valuesPerKey(e){return this.getValuesAtKey(e).size}get keys(){return this.values.keys()}hasKey(e){return this.values.has(e)}has(e,t){var n;return!!(null===(n=this.values.get(e))||void 0===n?void 0:n.has(t))}*[Symbol.iterator](){for(const[e,t]of this.values)for(const n of t)yield[e,n]}}Map;class fi{constructor(){this.usedIds=new Set,this.usedIds.add(0)}generate(){let e;do{e=Math.floor(1e6*Math.random())}while(this.usedIds.has(e));return this.usedIds.add(e),e}isInUse(e){return this.usedIds.has(e)}}class wi{constructor(e,t,n,a){this.sdk=e,this.attachmentRegistry=t,this.tagViewData=n,this.iframeSrcDoc=a,this.idGenerator=new fi,this.sandboxSubs=new Set}validateInput(e){if(!e.html||"string"!=typeof e.html)throw Error(e.html+" is not valid html");if(!To(e.clientId))throw Error("Unexpected error: unable to create iframe");const t=e.options||{},n={on:"on",off:"off",send:"send",tag:"tag",docked:"docked"};t.globalVariableMap&&(te(t.globalVariableMap.on)&&(n.on=t.globalVariableMap.on),te(t.globalVariableMap.off)&&(n.off=t.globalVariableMap.off),te(t.globalVariableMap.send)&&(n.send=t.globalVariableMap.send),te(t.globalVariableMap.tag)&&(n.tag=t.globalVariableMap.tag),te(t.globalVariableMap.docked)&&(n.docked=t.globalVariableMap.docked));const a={w:0,h:0};if(t.size){if(!(To(t.size.w)&&t.size.w>=0&&To(t.size.h)&&t.size.h>=0))throw Error(Z("options.size","Size",t.size));a.w=t.size.w,a.h=t.size.h}return{clientId:e.clientId,html:e.html,options:{name:t.name||"",globalVariableMap:n,size:a}}}async exec(e,t){const n=this.idGenerator.generate(),a=e=>{const a=a=>{a.source===e&&a.data.sandboxId===n&&this.sdk.sendPrivateMessage(hi.TO_CLIENT,a.data,t.client.id)};window.addEventListener("message",a),this.sandboxSubs.add({dispose(){window.removeEventListener("message",a)}})},o=e=>{const a=this.sdk.addPrivateMessageHandler({clientId:t.client.id,messageType:hi.TO_SANDBOX,onMessage(t){t.sandboxId===n&&e.postMessage(t,"*")}});this.sandboxSubs.add(a)},[s]=this.attachmentRegistry.addSandbox(t.client.applicationKey,{name:e.options.name,srcDoc:this.iframeSrcDoc,sandboxLoadedHandler:(t,s)=>{var r;const i=t.contentWindow;for(const e of this.sandboxSubs)e.dispose();this.sandboxSubs.clear(),a(i),o(i),i.postMessage({type:hi.SETUP,sandboxId:n,customHTML:e.html,parentTag:s,docked:(null===(r=this.tagViewData.dockedAnnotation)||void 0===r?void 0:r.id)===s,globalVariableMap:e.options.globalVariableMap},"*")},size:e.options.size});return{sandboxId:n,attachmentId:s}}}class yi{constructor(e,t,n,a){this.pinViewData=e,this.tagsViewData=t,this.annotationsViewData=n,this.annotationsModule=a}validateInput(e,t){const n=e.id;te(n)&&this.pinViewData.getPin(n)||this.throw(`${e.id} does not map to a valid tag`);const a={opening:!1,navigating:!1,docking:!1,sharing:!1};return va(e.allow)&&(a.opening=!!e.allow.opening,a.navigating=!!e.allow.navigating,a.docking=!!e.allow.docking,a.sharing=!!e.allow.sharing),{id:n,allow:a}}async exec(e,t){var n,a;const o=this.pinViewData.getPin(e.id);o?(this.annotationsViewData.updateCapabilities(o.id,{dock:e.allow.docking,preview:e.allow.opening,share:e.allow.sharing}),this.tagsViewData.updateCapabilities(o.id,{focus:!!e.allow.navigating}),(!e.allow.docking&&(null===(n=this.annotationsViewData.dockedAnnotation)||void 0===n?void 0:n.id)===e.id||!e.allow.opening&&(null===(a=this.annotationsViewData.selectedAnnotation)||void 0===a?void 0:a.id)===e.id)&&this.annotationsModule.closeAnnotation(o.id,si.TAG)):this.throw(`${e.id} does not map to a valid tag`)}throw(e){throw Error("Tag.allowAction: "+e)}}class vi{constructor(e,t,n){this.mattertagData=n,this.EditMattertagCommand=e.EditMattertagCommand,this.issueCommand=t.issueCommand}validateInput(e,t){const{id:n}=e;return te(n)||this.throw(Z("id","string",n)),this.mattertagData.getTag(n)||this.throw(`${n} does not map to a valid tag`),{id:n,properties:this.validateProperties(e.properties)}}validateProperties(e){va(e)||this.throw("'properties' input is not an object");const{label:t,description:n}=e;return void 0===t||ne(t)||this.throw(Z("label","string (or undefined)",t)),void 0===n||ne(n)||this.throw(Z("description","string (or undefined)",n)),{label:t,description:n}}async exec(e,t){try{await this.issueCommand(new this.EditMattertagCommand(e.id,{label:e.properties.label,description:e.properties.description}))}catch(e){this.throw(e)}}throw(e){throw Error("Tag.editBillboard: "+e)}}class Ti{constructor(e,t,n,a){this.THREE=e,this.EditMattertagCommand=t.EditMattertagCommand,this.issueCommand=n.issueCommand,this.mattertagData=a}validateInput(e,t){return te(e.id)||this.throw(Z("id","string",e.id)),this.mattertagData.getTag(e.id)||this.throw(`${e.id} does not map to a valid tag`),ei(e.color)||this.throw(Z("color","Color",e.color)),{id:e.id,color:e.color}}async exec(e,t){try{const t=(new this.THREE.Color).setRGB(e.color.r,e.color.g,e.color.b);await this.issueCommand(new this.EditMattertagCommand(e.id,{color:t}))}catch(e){this.throw(e)}}throw(e){throw Error("Tag.editColor: "+e)}}class Ii{constructor(e,t,n,a,o,s){this.THREE=t,this.isMpFontId=n,this.mattertagData=a,this.pinsModule=o,this.iconMaps=s,this.issueCommand=e.issueCommand}validateInput(e,t){var n;te(e.id)||this.throw(Z("id","string",e.id));this.mattertagData.getTag(e.id)||this.throw(`${e.id} does not map to a valid tag`),te(e.iconId)||this.throw(Z("iconId","string",e.iconId));const a=this.isMpFontId(e.iconId);return(null===(n=this.iconMaps.get(t.client.applicationKey))||void 0===n?void 0:n.imagePromise[e.iconId])||a||this.throw(`${e.iconId} does not map to a registered icon or font id`),{id:e.id,iconId:e.iconId}}async exec(e,t){const{id:n,iconId:a}=e,o=this.iconMaps.get(t.client.applicationKey);if(o&&e.iconId in o.imagePromise){let e;try{e=await o.imagePromise[a]}catch(e){this.throw(e)}const t=o.map[a],s=e.naturalWidth/e.naturalHeight,r=new this.THREE.Vector3;s>1?r.set(s,1,1):r.set(1,1/s,1),this.pinsModule.setPinRenderOverrides(n,t,r)}else{this.mattertagData.getTag(e.id).icon=e.iconId,await this.issueCommand(new Gr(e.id,{icon:e.iconId}))}}throw(e){throw Error("Tag.editIcon: "+e)}}class bi{constructor(e,t,n,a,o){this.cwfTypes=e,this.closeTag=n,this.mattertagData=a,this.annotationsViewData=o,this.issueCommand=t.issueCommand}validateInput(e,t){ne(e.id)&&this.mattertagData.getTag(e.id)||this.throw(`${e.id} does not map to a valid tag`),e.stemParams&&va(e.stemParams)||this.throw("invalid stem parameters objeect");const{stemHeight:n,stemVisible:a}=e.stemParams;return void 0===n||To(n)||this.throw(Z("stemHeight","number",e.id)),void 0===a||Ta(a)||this.throw(Z("stemVisibility","boolean",e.id)),{id:e.id,stemParams:{stemHeight:n,stemVisible:a}}}async exec(e,t){var n;const{stemHeight:a,stemVisible:o}=e.stemParams,s={};void 0!==a&&(s.stemHeight=a,(null===(n=this.annotationsViewData.dockedAnnotation)||void 0===n?void 0:n.id)!==e.id&&this.closeTag.exec({id:e.id},t)),void 0!==o&&(s.stemVisible=o),await this.issueCommand(new this.cwfTypes.EditMattertagCommand(e.id,s))}throw(e){throw Error("Tag.editStem: "+e)}}class Ei{constructor(e,t,n,a){this.ChangePinOpacityScaleCommand=e.ChangePinOpacityScaleCommand,this.PinType=e.PinType,this.issueCommand=t.issueCommand,this.mattertagData=n,this.pinsViewData=a}validateInput(e,t){return te(e.id)||this.throw(Z("id","string",e.id)),this.mattertagData.getTag(e.id)||this.throw(`${e.id} does not map to a valid tag`),(!To(e.opacity)||e.opacity<0||e.opacity>1)&&this.throw("'opacity' should be a number in the range of [0, 1]"),{id:e.id,opacity:e.opacity}}async exec(e,t){await this.waitForTagView(e.id),await this.issueCommand(new this.ChangePinOpacityScaleCommand(e.id,this.PinType.MATTERTAG,e.opacity))}async waitForTagView(e){if(!this.pinsViewData.getPin(e))return new Promise((t=>{const n=this.pinsViewData.onPinUpdate({onAdded(a,o){o===e&&(n.cancel(),t())}})}))}throw(e){throw Error("Tag.editOpacity: "+e)}}class Si{constructor(e){this.editPositions=e}validateInput(e,t){return this.editPositions.validateInput({descriptors:[{id:e.id,options:e.options}]},t).descriptors[0]}async exec(e,t){this.editPositions.exec({descriptors:[{id:e.id,options:e.options}]},t)}}class Ci{constructor(e,t,n,a){this.closeTag=e,this.mattertagData=t,this.annotationsViewData=n,this.roomIdMap=a}validateInput(e,t){const{descriptors:n}=e;return Da(n,((e,n)=>this.validateDescriptor(e,n,t)))||this.throw("descriptors is not an array"),{descriptors:n}}validateDescriptor(e,t,n){return va(e)||this.throw(`descriptor #${t} is not an object`),void 0===e.id||te(e.id)||this.throw(`descriptor[${t}].id is not a valid string`),this.validateOptions(e.options)||this.throw(`descriptor #${t}.options is not an object`),!0}validateOptions(e){return e&&va(e)||this.throw("invalid options provided"),{anchorPosition:this.validateVector3(e.anchorPosition,"`anchorPosition` was provided but not a valid Vector3"),stemVector:this.validateVector3(e.stemVector,"`stemVector` was provided, but not a valid Vector3"),roomId:this.validateRoomId(e.roomId)}}validateVector3(e,t){return void 0===e||Eo(e)||this.throw(t),e}validateRoomId(e){return void 0===e||te(e)||this.throw(Z("roomId","string (or undefined)",e)),e&&!this.roomIdMap.getRoomForId(e)&&this.throw(`${e} does not map to a valid room`),e}throw(e){throw Error("Tag.editPositions: "+e)}async exec(e,t){this.mattertagData.atomic((()=>{var n;for(const a of e.descriptors){const{anchorPosition:e,stemVector:o}=a.options,s=this.mattertagData.getTag(a.id),r=a.options.roomId&&this.roomIdMap.getRoomForId(a.options.roomId),i=r?r.floorId:s.floorId,c=e?s.anchorPosition.clone().set(e.x,e.y,e.z):s.anchorPosition,d=o?s.stemVector.clone().set(o.x,o.y,o.z):s.stemVector,l=o?d.length():s.stemHeight;d.normalize(),(e||o)&&(null===(n=this.annotationsViewData.dockedAnnotation)||void 0===n?void 0:n.id)!==a.id&&this.closeTag.exec({id:a.id},t),s.atomic((()=>{s.anchorPosition.set(c.x,c.y,c.z),s.anchorNormal.set(d.x,d.y,d.z),s.floorId=i,s.stemHeight=l,s.anchorPosition.set(c.x,c.y,c.z),s.stemVector.set(d.x,d.y,d.z),s.floorId=i,s.commit()}))}}))}}const Ai={namespace:"Tag",name:"editKeywords",args:["tagId","keywords"]};class Oi{constructor(e){this.tagsData=e,this.keywordUpdates=[]}validateInput(e){if(!Da(e.keywords,te))throw Error();if(te(e.tagId)){const t=this.tagsData.getTag(e.tagId);if(t)return{tag:t,keywords:e.keywords}}throw Error(`${e.tagId} does not map to a valid tag`)}async exec(e){this.keywordUpdates.push(e),1===this.keywordUpdates.length&&((e,t=250)=>{let n;return(...a)=>{window.clearTimeout(n),n=window.setTimeout((()=>e.apply(null,a)),t)}})(this.updateKeywords.bind(this),0)()}updateKeywords(){this.tagsData.atomic((()=>{for(const e of this.keywordUpdates){const t=new Set(e.keywords);e.tag.keywords.replace([...t])}})),this.keywordUpdates.length=0}}const Di={namespace:"Tag",name:"editEnabled",args:["tagId","enabled"]};class Mi{constructor(e){this.tagsData=e}validateInput(e,t){if(!Ta(e.enabled))throw Error(Z("enabled","boolean",e.enabled));if(te(e.tagId)){const t=this.tagsData.getTag(e.tagId);if(t)return{tag:t,enabled:e.enabled}}throw Error(`${e.tagId} does not map to a valid tag`)}async exec(e,t){e.tag.enabled=e.enabled,e.tag.commit()}}class xi{constructor(e,t){this.mattertagData=e,this.annotationsModule=t}validateInput(e){const t=e.ids;return Da(t,te)||this.throw("'ids' is expected to be a series of strings"),{ids:t}}async exec(e){const t=[];for(const t of e.ids)this.annotationsModule.closeAnnotation(t,si.TAG);return this.mattertagData.atomic((()=>{for(const n of e.ids)this.mattertagData.removeTag(n),t.push(n)})),t}throw(e){throw Error("Tag.remove: "+e)}}class Ri{constructor(e,t){this.mattertagData=e,this.pinsModule=t}validateInput(e,t){return te(e.id)||this.throw(Z("id","string",e.id)),this.mattertagData.getTag(e.id)||this.throw(`${e.id} does not map to a valid tag`),{id:e.id}}async exec(e,t){const{id:n}=e;this.pinsModule.setPinRenderOverrides(n,null,null)}throw(e){throw Error(`Tag.resetIcon: ${e}`)}}const Pi="TAG_NAV_OVERLAY",Ni="TAG_BILLBOARD_SHARE",_i="TAG_BILLBOARD_DOCK";Object.freeze({colors:["#d44441","#f44336","#e91e63","#f78da7","#9c4b92","#673ab7","#03687d","#03a9f4","#00bcd4","#417505","#51a868","#37d67a","#cddc39","#fbcd00","#ffac17","#ff6900","#abb8c3","#607d8b"]});class ki{constructor(e,t){this.setting=e,this.settingsData=t}validateInput(e){if(void 0===e.enable&&(e.enable=!this.settingsData.tryGetSetting(this.setting,!0)),!Ta(e.enable))throw Error(Z("enable","boolean or undefined",e.enable));return{enable:e.enable}}async exec(e){this.settingsData.setSetting(this.setting,e.enable)}}const Li=new Zt("command.saveToLayer");class Vi{constructor(e,t,n,a,o){this.sdkLayer=e,this.externalCommands=t,this.mattertagsData=n,this.layersModule=a,this.attachmentsModule=o}validateInput(e,t){const n={};if(!e.options)return{options:n};if(!va(e.options))throw new Error("Validation Error: `options` must be an object.");if(e.options.progress){if("function"!=typeof e.options.progress)throw new Error("Validation Error: `progress` must be a function.");n.progress=e.options.progress}if(e.options.tagsToUpdate){if(!Da(e.options.tagsToUpdate,te))throw new Error("tagsToUpdate' is expected to be a series of strings");n.tagsToUpdate=e.options.tagsToUpdate}if(e.options.tagsToIgnore){if(!Da(e.options.tagsToIgnore,te))throw new Error("ignoreTags' is expected to be a series of strings");n.tagsToIgnore=e.options.tagsToIgnore}if(e.options.layerName){if(!ne(e.options.layerName)||0===e.options.layerName.trim().length)throw new Error("Validation Error: `layerName` must be a non-empty string.");n.layerName=e.options.layerName}return{options:n}}async exec(e,t){var n,a,o;if(null===this.sdkLayer)return Li.warn("Layers must be enabled to use Tag.saveToLayer."),[];const s=[];let r=0;for(const t of this.mattertagsData){const o={isTransientTag:t.layerId===this.sdkLayer.id,isIgnoredTag:null===(n=e.options.tagsToIgnore)||void 0===n?void 0:n.includes(t.sid),isUpdateTag:null===(a=e.options.tagsToUpdate)||void 0===a?void 0:a.includes(t.sid)};o.isIgnoredTag||!o.isTransientTag&&!o.isUpdateTag||s.push(t),r+=t.externalAttachments.length,o.isTransientTag&&!o.isIgnoredTag&&(r+=t.fileAttachments.length)}if(0===s.length)return[];const i=new Yr(s.length+r+1);let c;e.options.progress&&(c=i.percentCompleted.onChanged(e.options.progress)),i.start();const d=(new Date).toLocaleString(),l=e.options.layerName?e.options.layerName.trim():`Imported ${d}`,u=s.filter((e=>{var t;return e.layerId===(null===(t=this.sdkLayer)||void 0===t?void 0:t.id)})).length;u>0&&await this.layersModule.addLayer(l,!1),i.notifyTaskCompleted();const h=[];for(const t of s){const n={position:t.anchorPosition,normal:t.anchorNormal,roomId:t.roomId,floorId:t.floorId,color:Object.assign({},t.color),description:t.description,label:t.label,stemHeight:t.stemHeight,stemVisible:t.stemVisible,enabled:t.enabled,keywords:t.keywords.values(),icon:t.icon},a=null===(o=e.options.tagsToUpdate)||void 0===o?void 0:o.includes(t.sid),s=[];if(!a){for(const e of t.fileAttachments){const n=await fetch(await e.url.get()),a=await n.blob(),o=new File([a],e.filename||"image.jpg",{type:a.type}),r=await this.attachmentsModule.uploadAttachments(t.sid,on.MATTERTAG,[o]);r[0].attachment&&s.push(r[0].attachment),i.notifyTaskCompleted()}t.fileAttachments.length=0,s.forEach((e=>{t.fileAttachments.push(e)}))}let r=null;if(t.externalAttachments&&t.externalAttachments.length>0&&(r=await this.attachmentsModule.embedMedia(t.sid,on.MATTERTAG,t.externalAttachments.get(0).src),i.notifyTaskCompleted()),a){const e=[];try{await this.externalCommands.issueCommand(new zr(t.sid,n,s,e,r))}catch(e){Li.warn(`Could not save tag sid:${t.sid} label: ${t.label}}, skipping it.`)}}else{const e=t.sid.replace(/^.*?_/,"");try{await this.externalCommands.issueCommand(new Br(e,n,s,r)),h.push(t.sid)}catch(n){Li.warn(`Could not save tag sid:${e} label: ${t.label}}, skipping it.`)}}i.notifyTaskCompleted(),this.attachmentsModule.resetAttachmentChanges()}return i.forceComplete(),null==c||c.cancel(),h}}class Fi{constructor(){this.activePromise=Promise.resolve(new Ui)}async lock(){const e=new Promise((async e=>{(await this.activePromise).onUnlock((()=>e(new Ui)))})),t=this.activePromise;return this.activePromise=e,t}}class Ui{onUnlock(e){this.unlockCB=e}unlock(){this.unlockCB()}}const Gi=new Zt("command.importAttachments");class Hi{constructor(e,t){this.externals=e,this.getTagsQuery=t,this.lock=new Fi,this.lastImportCache=null}validateInput(e,t){if(!te(e.srcSpaceId))throw Error("invalid space id"+e.srcSpaceId);if(!te(e.destTagId))throw Error("invalid tag id"+e.destTagId);if(!Da(e.attachmentIds,te))throw Error("invalid attachment ids"+JSON.stringify(e.attachmentIds));return e}async exec(e,t){const n=await this.lock.lock();let a;if(this.lastImportCache&&this.lastImportCache.spaceId===e.srcSpaceId&&Date.now()<this.lastImportCache.validUntil)a=this.lastImportCache.tags,n.unlock();else try{a=await this.getTagsQuery(e.srcSpaceId),this.lastImportCache={spaceId:e.srcSpaceId,tags:a,validUntil:Date.now()+6e4}}catch(t){throw Error(`Tag.importAttachments: Error reading tags from space id ${e.srcSpaceId}`)}finally{n.unlock()}const o=a.reduce(((e,t)=>({fileAttachments:Object.fromEntries([...Object.entries(e.fileAttachments),...t.fileAttachments.map((e=>[e.id,e]))]),externalAttachments:Object.fromEntries([...Object.entries(e.externalAttachments),...t.externalAttachments.map((e=>[e.id,e]))])})),{fileAttachments:{},externalAttachments:{}}),s=Object.values(o.fileAttachments).filter((t=>e.attachmentIds.includes(t.id))),r=Object.values(o.externalAttachments).filter((t=>e.attachmentIds.includes(t.id))),i=[...s,...r],c=new Set(e.attachmentIds);return i.forEach((e=>c.delete(e.id))),c.size>0&&Gi.warn(`couldn't find ${c.size} attachments. Continuing without them.\n         \n\t${[...c].join("\n\t")}`),(s.length||r.length)&&await this.externals.issueCommand(new Hr(e.destTagId,{fileAttachments:s,externalAttachments:r,refreshIds:[e.srcSpaceId]},Hr.Operation.ADD)),{copied:e.attachmentIds.filter((e=>!c.has(e))),missing:[...c]}}}function Bi(e,t,n,a,o,s,r,i,c,d,l){const{mattertagData:u,pinsModule:h,meshData:p,floorData:m,pinViewData:g,annotationsViewData:f,tagsViewData:w,roomData:y,roomIdMap:v,settingsData:T,meshQuery:I,layersModule:b,annotationsModule:E,attachmentsModule:S}=l;e.addEnumToInterface({namespace:"Tag",name:"AttachmentType",values:O.AttachmentType});const C=function(e,t){const n=sa.create(t,new Nr,new $(_r));return e.addCollectionToInterface({namespace:"Tag",name:"attachments"},n),n}(e,new z(s)),A=function(e,t){const n=X.create(t,new $(Fr));return e.addAsyncCommandToInterface({namespace:"Tag",name:"registerAttachment",args:["srcs"],varArg:!0},n),n}(e,new z(s)),D=function(e,t){const n=X.create(t,new $(wi,e));return e.addAsyncCommandToInterface({namespace:"Tag",name:"registerSandbox",args:["html","options"],subRoutine:"tag.registerSandbox"},n),n}(e,new z(s,f,r)),M=function(e,t){const n=X.create(t,new $(kr));return e.addAsyncCommandToInterface({namespace:"Tag",name:"attach",args:["tagId","attachmentIds"],varArg:!0,options:{replay:!0}},n),n}(e,new z(u,s)),x=function(e,t){const n=X.create(t,new $(Lr));return e.addAsyncCommandToInterface({namespace:"Tag",name:"detach",args:["tagId","attachmentIds"],varArg:!0,options:{replay:!0}},n),n}(e,new z(u,s)),R=function(e,t){const n=de.create(t,new pi,new $(mi));return e.addObservableToInterface({namespace:"Tag",name:"openTags"},n),n}(e,new z(g,f)),P=function(e,t,n){const a=sa.create(n,new Qr,new $(Jr,t));return e.addCollectionToInterface({namespace:"Tag",name:"data",elementFactory:"tag.data"},a),a}(e,t,new z(u,w,v,y,p)),N=function(e,t,n,a){const o=X.create(a,new $(oi,Object.assign(Object.assign({},t),n)));return e.addAsyncCommandToInterface({namespace:"Tag",name:"open",args:["id","options"]},o),o}(e,n,a,new z(u,w)),_=function(e,t){const n=X.create(t,new $(ii));return e.addAsyncCommandToInterface({namespace:"Tag",name:"dock",args:["id","options"]},n),n}(e,new z(u,E)),k=function(e,t,n,a){const o=X.create(a,new $(ci,Object.assign(Object.assign({},t),n)));return e.addAsyncCommandToInterface({namespace:"Tag",name:"close",args:["id"]},o),o}(e,n,a,new z(u,w)),L=function(e,t){const n=X.create(t,new $(yi));return e.addAsyncCommandToInterface({namespace:"Tag",name:"allowAction",args:["id","allow"],options:{replay:!0}},n),n}(e,new z(g,w,f,E)),V=function(e,t,n,a){const o=X.create(a,new $(vi,t,n));return e.addAsyncCommandToInterface({namespace:"Tag",name:"editBillboard",args:["id","properties"],options:{replay:!0}},o),o}(e,n,a,new z(u)),F=function(e,t,n,a,o){const s=X.create(o,new $(Ti,t,n,a));return e.addAsyncCommandToInterface({namespace:"Tag",name:"editColor",args:["id","color"],options:{replay:!0}},s),s}(e,t,n,a,new z(u)),U=function(e,t,n,a,o){const s=X.create(o,new $(Ii,t,n,a));return e.addAsyncCommandToInterface({namespace:"Tag",name:"editIcon",args:["id","iconId"],options:{replay:!0}},s),s}(e,a,t,d,new z(u,h,o,w)),G=function(e,t,n,a){const o=X.create(a,new $(Ei,t,n));return e.addAsyncCommandToInterface({namespace:"Tag",name:"editOpacity",args:["id","opacity"],options:{replay:!0}},o),o}(e,n,a,new z(u,g)),H=function(e,t,n,a){const o=X.create(a,new $(bi,t,n));return e.addAsyncCommandToInterface({namespace:"Tag",name:"editStem",args:["id","stemParams"],options:{replay:!0}},o),o}(e,n,a,new z(k,u,f)),B=function(e,t){const n=X.create(t,new $(Ci));return e.addAsyncCommandToInterface({namespace:"Tag",name:"editPositions",args:["descriptors"],varArg:!0,options:{replay:!0}},n),n}(e,new z(k,u,f,v)),j=function(e,t){const n=X.create(t,new $(Si));return e.addAsyncCommandToInterface({namespace:"Tag",name:"editPosition",args:["id","options"],options:{replay:!0}},n),n}(e,new z(B)),q=function(e,t){const n=Na.create(t,new $(Oi));return e.addCommandUnlisted(Ai,n),n}(e,new z(u)),W=function(e,t){const n=Na.create(t,new $(Mi));return e.addCommandUnlisted(Di,n),n}(e,new z(u)),K=function(e,t){const n=X.create(t,new $(xi));return e.addAsyncCommandToInterface({namespace:"Tag",name:"remove",args:["ids"],varArg:!0,options:{replay:!0}},n),n}(e,new z(u,E)),Y=function(e,t){const n=X.create(t,new $(Ri));return e.addAsyncCommandToInterface({namespace:"Tag",name:"resetIcon",args:["id"],options:{replay:!0}},n),n}(e,new z(u,h)),Z=function(e,t,n,a,o){const s=X.create(o,new $(ni,t,n,a));return e.addAsyncCommandToInterface({namespace:"Tag",name:"add",args:["descriptors"],varArg:!0,options:{replay:!0}},s),s}(e,t,n,a,new z(u,M,U,G,s,o,I,w)),Q=function(e,t,n,a,o,s){const r=X.create(o,new $(Zr,t,n,a,s));return e.addAsyncCommandToInterface({namespace:"Tag",name:"importTags",args:["spaceSid","options"],varArg:!1,origins:ae,options:{replay:!1}},r),r}(e,c,t,a,new z(u,m,y,p,b),i),J=function(e,t,n,a){const o=X.create(a,new $(Vi,t,n));return e.addAsyncCommandToInterface({namespace:"Tag",name:"saveToLayer",args:["options"],varArg:!1,origins:ae,options:{replay:!1}},o),o}(e,c,a,new z(u,b,S)),ee=function(e,t,n){const a=X.create(z.none,new $(Hi,t,n));return e.addAsyncCommandToInterface({namespace:"Tag",name:"importAttachments",args:["destTagId","srcSpaceId","attachmentIds"],origins:ae},a),a}(e,a,i),te=new z(T),ne=function(e,t){const n=X.create(t,new $(ki,_i));return e.addAsyncCommandToInterface({namespace:"Tag",name:"toggleDocking",args:["enable"]},n),n}(e,te),oe=function(e,t){const n=X.create(t,new $(ki,Pi));return e.addAsyncCommandToInterface({namespace:"Tag",name:"toggleNavControls",args:["enable"]},n),n}(e,te),se=function(e,t){const n=X.create(t,new $(ki,Ni));return e.addAsyncCommandToInterface({namespace:"Tag",name:"toggleSharing",args:["enable"]},n),n}(e,te);return{attachments:C,registerAttachment:A,registerSandbox:D,attach:M,importTags:Q,detach:x,data:P,openTags:R,add:Z,open:N,dock:_,close:k,allowAction:L,editBillboard:V,editColor:F,editIcon:U,editOpacity:G,editStem:H,editPosition:j,editPositions:B,editKeywords:q,editEnabled:W,remove:K,resetIcon:Y,toggleDocking:ne,toggleNavControls:oe,toggleSharing:se,saveToLayer:J,importAttachments:ee}}class zi{constructor(e,t){this.tagsViewData=e,this.layersData=t}validateInput(e,t){return{}}async exec(e,t){const n={};for(const e of this.tagsViewData.getCollection()){const t=this.layersData.getLayer(e.layerId);n[e.id]=!!(null==t?void 0:t.toggled)||!e.layerId}return n}}class $i{validateInput(e){if(!te(e.arg0))throw Error(`Stat.test: arg0 was specified but was not a valid string; got ${e.arg0}`);return e}async exec(e,t){return e.arg0}}class ji{create(){return De((()=>{}),(()=>{}))}}class qi{constructor(){this._data={}}get data(){return this._data}isItemEqual(e,t){const n=this.data[t],a=e.data[t];return n.test===a.test}update(){}clear(){this._data={}}}var Wi;!function(e){e.ENUM1="test.enum1",e.ENUM2="test.enum2"}(Wi||(Wi={}));class Ki{validateInput(e){return e}async exec(e,t){}}class Yi{create(e){return De((()=>{}),(()=>{}))}}class Xi{constructor(){this._data={testString:"hello"}}get data(){return this._data}equals(e){return this._data.testString===e.data.testString}copy(e){this._data.testString=e.data.testString}update(){}}function Zi(e,t){const{tagsViewData:n,layersData:a}=t,o=function(e,t){const n=sa.create(t,new ji,new $(qi));return e.addCollectionToInterface({namespace:"Test",name:"directCollection",sdkTypes:[Ut.DIRECT],origins:ae},n),e.addCollectionToInterface({namespace:"Test",name:"postMessageCollection",sdkTypes:[Ut.POSTMESSAGE],origins:ae},n),n}(e,z.none),s=function(e,t){const n=de.create(t,new Yi,new $(Xi));return e.addObservableToInterface({namespace:"Test",name:"directObservable",sdkTypes:[Ut.DIRECT],origins:ae},n),e.addObservableToInterface({namespace:"Test",name:"postMessageObservable",sdkTypes:[Ut.POSTMESSAGE],origins:ae},n),n}(e,z.none),r=function(e,t){const n=X.create(t,new $(zi));return e.addAsyncCommandToInterface({namespace:"Test",name:"getTagVisibility",args:[],origins:ae},n),n}(e,new z(n,a));return function(e){e.addEnumToInterface({namespace:"Test",name:"directEnum",values:Wi,sdkTypes:[Ut.DIRECT],origins:ae}),e.addEnumToInterface({namespace:"Test",name:"postMessageEnum",values:Wi,sdkTypes:[Ut.POSTMESSAGE],origins:ae})}(e),function(e,t){const n=X.create(t,new $($i));e.addCommandToInterface({namespace:"Test",name:"echo",args:["arg0"],origins:ae},n),e.addAsyncCommandToInterface({namespace:"Test",name:"echoAsync",args:["arg0"],origins:ae},n),e.addCommandToInterface({namespace:"Test.Sub",name:"echo",args:["arg0"],origins:ae},n),e.addAsyncCommandToInterface({namespace:"Test.Sub",name:"echoAsync",args:["arg0"],origins:ae},n),e.addCommandToInterface({namespace:"Test.Sub.Sub2",name:"echo",args:["arg0"],origins:ae},n),e.addAsyncCommandToInterface({namespace:"Test.Sub.Sub2",name:"echoAsync",args:["arg0"],origins:ae},n)}(e,z.none),function(e,t){const n=X.create(t,new $(Ki));e.addCommandToInterface({namespace:"Test",name:"directCommand",args:[],sdkTypes:[Ut.DIRECT],varArg:!1,origins:ae},n),e.addCommandToInterface({namespace:"Test",name:"postMessageCommand",args:[],sdkTypes:[Ut.POSTMESSAGE],varArg:!1,origins:ae},n)}(e,z.none),{collection:o,observable:s,visibleTagsCheckCommand:r}}(class extends ge{constructor(){super()}}).id="LOCK_NAVIGATION";(class extends ge{constructor(){super()}}).id="UNLOCK_NAVIGATION";(class extends ge{constructor(e){super(),this.payload=e}}).id="FOCUS_ON_POINT_INSIDE";(class extends ge{constructor(e){super(),this.payload=e}}).id="FOCUS_ON_PIN_INSIDE";class Qi extends ge{constructor(e){super(),this.payload=Object.assign({},e)}}Qi.id="MOVE_TO_SWEEP";(class extends ge{constructor(e){super(),this.payload=e}}).id="NAVIGATE_TO_LABEL";(class extends ge{constructor(e){super(),this.payload={room:e}}}).id="NAVIGATE_TO_ROOM";(class extends ge{constructor(e){super(),this.payload={pose:e}}}).id="NAVIGATE_TO_POSE";class Ji{constructor(e,t,n){this.commands=e,this.sweepData=t,this.roomBoundData=n}validateInput(e){const t=this.validateInputRoomId(e.roomId),n=e.options||{};if(n.transition&&!yn(P,n.transition))throw Error(`PI.Room.moveTo: options.transition was specified but was not a valid transition type; got ${n.transition}`);const a=this.validateTransitionTime(n.transitionTime),o=this.validateCenterOnSweeps(n.centerOnSweeps);return{roomId:t,options:{transition:n.transition,transitionTime:a,centerOnSweeps:o}}}validateInputRoomId(e){if(!e||!te(e))throw Error(`PI.Room.moveTo: 'roomId' was not a valid room id; got ${e}`);if(!this.roomBoundData.tryGetRoom(e))throw Error(e+" does not map to a valid room in this model");return e}validateTransitionTime(e){if(!e)return;const t=Error(`PI.Room.moveTo: transitionTime was specified but was not a valid, positive time; got ${e}`);if(!To(e))throw t;if(e<=0)throw t;return e}validateCenterOnSweeps(e){if(null==e)return!1;if("boolean"!=typeof e)throw Error(`PI.Room.moveTo: options.centerOnSweeps was specified but was not a boolean; got ${e}`);return e}findSweepsInRoom(e){const t=this.roomBoundData.getRoom(e),n=Array.from(this.sweepData.sweeps()).filter((t=>t.enabled&&t.roomId===e));if(0===n.length)throw Error(`No enabled sweeps found in room with id: ${e}`);return{sweeps:n,targetRoom:t}}calculateRotationFromOtherSweeps(e,t){const n=t.length;if(0===n)return;const a=t.reduce(((e,t)=>({x:e.x+t.x,y:e.y+t.y,z:e.z+t.z})),{x:0,y:0,z:0}),o=a.x/n-e.x,s=a.z/n-e.z,r=a.y/n-e.y,i=Math.atan2(o,s);return{x:Math.atan2(r,Math.sqrt(o*o+s*s)),y:Math.PI+i}}calculateRotationFromViewCenter(e,t){const n={x:t.x-e.x,y:t.y-e.y,z:t.z-e.z};return{x:0,y:Math.atan2(n.x,n.z)-Math.PI}}getFirstSweepIdAndRotation(e,t){const{sweeps:n,targetRoom:a}=this.findSweepsInRoom(e),o=n[0];let s;if(t&&n.length>1)s=this.calculateRotationFromOtherSweeps(o.position,n.slice(1).map((e=>e.position)));else if(!t){const e=a.getViewCenter();s=this.calculateRotationFromViewCenter(o.position,e)}return{sweepId:o.id,rotation:s}}async exec(e){var t,n,a,o;const s=null!==(n=null===(t=e.options)||void 0===t?void 0:t.centerOnSweeps)&&void 0!==n&&n,r=this.getFirstSweepIdAndRotation(e.roomId,s),i=r.rotation?this.commands.conversionUtils.rotationToQuaternion({x:180*r.rotation.x/Math.PI,y:180*r.rotation.y/Math.PI}):void 0,c=(null===(a=e.options)||void 0===a?void 0:a.transition)?this.commands.cameraTransitionConverter.fromSdkTransition(e.options.transition):void 0,d=null===(o=e.options)||void 0===o?void 0:o.transitionTime;return await this.commands.issueCommand(new Qi({sweep:r.sweepId,rotation:i,transition:c,transitionTime:d}))}}class ec{create(e,t){return t.makeCurrentRoomWithSweepDataSubscription((()=>e.onChanged()))}}class tc{constructor(){this._data=null}get data(){return this._data}equals(e){return null===this._data&&null===e._data||null!==this._data&&null!==e._data&&(this._data.id===e._data.id&&this._data.name===e._data.name&&this._data.area===e._data.area&&JSON.stringify(this._data.roomTypes)===JSON.stringify(e._data.roomTypes))}copy(e){this._data=e._data?Object.assign({},e._data):null}update(e){if(e.isInTransitionState())return void(this._data=null);const t=e.currentRoom;if(t){const n=e.roomClassifications;this._data={id:t.id,name:t.name,area:t.area,roomTypes:(t.roomTypeIds||[]).map((e=>{const t=n[e];return{id:e,label:(null==t?void 0:t.label)||e,defaultKeywords:null==t?void 0:t.defaultKeywords}}))}}else this._data=null}}const nc="internal_2",ac="spaces.plugins.groups";const oc=new Zt("sdk: tours");class sc{constructor(e,t){this.tourControls=e,this.tourData=t}validateInput(e){return void 0!==e.index&&isNaN(e.index)&&(oc.warn(e.index,"is not a valid number"),e.index=void 0),void 0!==e.steps&&isNaN(e.steps)&&(oc.warn(e.steps,"is not a valid number"),e.steps=void 0),e}async exec(e){if(0===this.tourData.getHighlightsCount())throw Error("No tour data found");if(!this.tourControls.canChangeTourLocation())throw Error("TourStart ignored, cannot change location at this time, another transition is active");try{this.tourControls.startTour(e)}catch(e){throw Error(`Error occurred while starting tour - ${e}`)}}}class rc{constructor(e){this.tourControls=e}validateInput(e){return e}async exec(e){try{await this.tourControls.stopTour()}catch(e){throw Error(`Error occurred while stopping tour - ${e}`)}}}class ic{constructor(e,t){this.tourControls=e,this.tourData=t}validateInput(e){const t=e.index;if(!To(t))throw Error(t+" is not a valid tour snapshot index");if(t<0||t>this.tourData.getHighlightsCount())throw Error(`${t} is outside of the range of tour snapshots: [0 , ${this.tourData.getHighlightsCount()-1}]`);return{index:t}}async exec(e){if(0===this.tourData.getHighlightsCount())throw Error("No tour data found");if(!this.tourControls.canChangeTourLocation())throw Error("TourStep ignored, cannot change location at this time, another transition is active");try{await this.tourControls.tourGoTo(e.index)}catch(e){throw Error(`Error occurred while jumping to new tour location - ${e}`)}}}class cc{constructor(e,t,n){this.forward=e,this.tourControls=t,this.tourData=n}validateInput(e){return e}async exec(e){if(0===this.tourData.getHighlightsCount())throw Error("No tour data found");if(!this.tourControls.canChangeTourLocation())throw Error("TourStep ignored, cannot change location at this time, another transition is active");try{this.forward?await this.tourControls.tourGoNext():await this.tourControls.tourGoPrevious()}catch(e){throw Error(`Error while trying to travel to the next tour snapshot - ${e}`)}}}class dc{constructor(e,t,n){this.tourData=t,this.settingsData=n}validateInput(e){let t=null==e?void 0:e.options;return t&&"object"==typeof t||(t={}),"boolean"!=typeof t.forceRegenerate&&(t.forceRegenerate=!1),"boolean"!=typeof t.forceAutotour&&(t.forceAutotour=!1),{options:{forceRegenerate:t.forceRegenerate,forceAutotour:t.forceAutotour}}}async exec(e){(0===this.tourData.getHighlightsCount()||e.options.forceAutotour)&&await this.tourData.setupTour(this.settingsData,e.options.forceRegenerate)}}function lc(e,t,n,a){!function(e,t,n){t.addBinding(uc,(async()=>n.getDependencies().then((async([n,a])=>{const o=await Promise.all(a.getEnabledSnapshots().map((n=>async function(e,t,n){const a=!e.is360,o=n.viewmodeConverter.toSdk(e.metadata.cameraMode,a);if(!o||o===n.commandModeConverter.toSdk(t.CommandViewmode.TRANSITIONING))throw Error("Failed to convert snapshot, invalid viewmode");const s={sid:e.sid,thumbnailUrl:await e.thumbnailUrl.get(),imageUrl:await e.imageUrl.get(),is360:e.is360,name:e.name,mode:o,zoom:e.metadata.ssZoom,position:e.metadata.cameraPosition,rotation:n.conversionUtils.quaternionToRotation(e.metadata.cameraQuaternion)};return s}(n,e,t))));if(0===o.length)throw Error("No tour data found");return o}))))}(t,n,a),e.addCommandCreator({namespace:"Tour",name:"getData",args:[]},(()=>new uc));const o=a,s=X.create(o,new $(sc)),r=X.create(o,new $(rc)),i=X.create(o,new $(ic)),c=X.create(o,new $(cc,!0)),d=X.create(o,new $(cc,!1)),l=X.create(o,new $(dc));e.addAsyncCommandToInterface({namespace:"Tour",name:"setup",args:["options"],origins:ae},l),e.addAsyncCommandToInterface({namespace:"Tour",name:"start",args:["index"]},s),e.addCommandToInterface({namespace:"Tour",name:"stop",args:[]},r),e.addCommandToInterface({namespace:"Tour",name:"step",args:["index"]},i),e.addCommandToInterface({namespace:"Tour",name:"prev",args:[]},d),e.addCommandToInterface({namespace:"Tour",name:"next",args:[]},c)}class uc extends ge{}uc.id="GET_TOUR_DATA";class hc{create(e,t){return t.onChanged((()=>e.onChanged()))}}class pc{constructor(){this._data={step:null,index:null}}get data(){return this._data}equals(e){return this._data.step===e.data.step&&this._data.index===e.data.index}copy(e){this._data.step=e.data.step,this._data.index=e.data.index}update(e){var t,n;this._data.step=e.isTourActive()&&null!==(t=e.getTourCurrentSnapshotSid())&&void 0!==t?t:null,this._data.index=e.isTourActive()&&null!==(n=e.getTourCurrentSnapshotIndex())&&void 0!==n?n:null}}class mc{create(e,t){return t.onChanged((()=>e.onChanged()))}}class gc{constructor(e){this._data={current:D.PlayState.INACTIVE},this.tourStateConverter=e.tourStateConverter}get data(){return this._data}equals(e){return this._data.current===e.data.current}copy(e){this._data.current=e.data.current}update(e){this._data.current=this.tourStateConverter.toSdkTourState(e.getTourState())}}class fc{constructor(e){this.toSdkTourStateMap={[e.Inactive]:D.PlayState.INACTIVE,[e.Active]:D.PlayState.ACTIVE,[e.StopScheduled]:D.PlayState.STOP_SCHEDULED}}toSdkTourState(e){return this.toSdkTourStateMap[e]}}class wc{create(e,t){return t.onChanged((()=>e.onChanged()))}}class yc{constructor(){this._data={from:null,to:null}}get data(){return this._data}equals(e){return this._data.from===e.data.from&&this._data.to===e.data.to}copy(e){this._data.from=e.data.from,this._data.to=e.data.to}update(e){const t=this.hasEnded;if(this.hasEnded=e.tourEnded,!t&&this.hasEnded)return this._data.from=null,void(this._data.to=null);const n=-1===e.tourCurrentSnapshot?null:e.getTourEntrySidFromIndex(e.tourCurrentSnapshot),a=-1===e.transition.toIndex?null:e.getTourEntrySidFromIndex(e.transition.toIndex);null!==a&&(n===a?(this._data.from=null,this._data.to=null):(this._data.from=n,this._data.to=a))}}const vc={includeDefurnish:!0,includeDisabled:!1,includeInsights:!1};function Tc(e,t){var n;const a={[ve.BASE_LAYER]:M.LayerType.BASE,[ve.VIEW_DATA_LAYER]:M.LayerType.VIEW_DATA,[ve.USER_LAYER]:M.LayerType.USER,[ve.COMMON_USER_LAYER]:M.LayerType.USER,[ve.IN_MEMORY]:M.LayerType.IN_MEMORY,[ve.COMMON_IN_MEMORY]:M.LayerType.IN_MEMORY};var o;return(t=t||{}).id=e.id,t.name=e.name,t.type=null!==(n=a[e.layerType])&&void 0!==n?n:M.LayerType.OTHER,t.toggled=e.toggled,t.common=(o=e.layerType)===ve.COMMON_IN_MEMORY||o===ve.COMMON_USER_LAYER||o===ve.PROXY_LAYER,t}class Ic{constructor(){this.layerSubscriptions=new Map}create(e,t){const n=t.layersData.onCurrentLayersChanged((()=>{this.subscribeToLayers(e,t.layersData),e.onChanged()}));return{renew:()=>{n.renew();for(const[,e]of this.layerSubscriptions)e.renew()},cancel:()=>{n.cancel();for(const[,e]of this.layerSubscriptions)e.cancel()}}}subscribeToLayers(e,t){for(const n of t.getOrderedModelViews(vc)){if(n.enabled)for(const a of t.filterUserFacingLayers(n.layers))this.layerSubscriptions.has(a)||this.layerSubscriptions.set(a,a.onChanged((()=>e.onChanged())));for(const n of t.inMemoryLayers)this.layerSubscriptions.has(n)||this.layerSubscriptions.set(n,n.onChanged((()=>e.onChanged())))}}}class bc{constructor(e){this._data={},this.layersData=e.layersData}get data(){return this._data}isItemEqual(e,t){return this.isLayerEqual(this.data[t],e.data[t])}isLayerEqual(e,t){return e.id===t.id&&e.name===t.name&&e.toggled===t.toggled&&e.type===t.type}update(){const e=new Set;for(const t of this.layersData.getOrderedModelViews(vc))if(t.enabled)for(const n of this.layersData.filterUserFacingLayers(t.layers))this._data[n.id]=Tc(n,this._data[n.id]),e.add(n.id);for(const t of this.layersData.inMemoryLayers)this._data[t.id]=Tc(t,this._data[t.id]),e.add(t.id);for(const t in this.data)e.has(t)||delete this._data[t]}clear(){this._data={}}}function Ec(e,t,n){const a={[ye.DEFURNISH]:M.ViewType.DEFURNISH,[ye.BASE]:M.ViewType.BASE,[ye.LAYERED_BASE]:M.ViewType.LAYERED_BASE,[ye.USER]:M.ViewType.USER};(n=n||{}).id=t.id,n.name=t.name,n.type=(t.viewType?a[t.viewType]:M.ViewType.OTHER)||M.ViewType.OTHER,n.active=e.currentViewId===t.id,n.transient=t.transient;const o=e.filterUserFacingLayers(t.layers).map((e=>Tc(e)));return n.layers=Cn(n.layers||[],o),n}class Sc{constructor(){this.viewSubscriptions=new Map}create(e,t){return new Lt(t.layersData.onModelViewsChanged((()=>e.onChanged())),t.layersData.onCurrentLayersChanged((()=>e.onChanged())),this.watchViews(t.layersData,e))}watchViews(e,t){return e.onModelViewsChanged((()=>{for(const[t,n]of[...this.viewSubscriptions])e.hasView(t.id)||(n.cancel(),this.viewSubscriptions.delete(t));e.getOrderedModelViews().forEach((e=>{if(e.enabled&&!this.viewSubscriptions.has(e)){const n=e.layers.onChanged((()=>t.onChanged()));this.viewSubscriptions.set(e,n)}}))})),{renew:()=>{this.viewSubscriptions.forEach((e=>e.renew()))},cancel:()=>{this.viewSubscriptions.forEach((e=>e.cancel()))}}}}class Cc{constructor(e){this._data={},this.layersData=e.layersData}get data(){return this._data}isItemEqual(e,t){return this.isViewEqual(this.data[t],e.data[t])}isViewEqual(e,t){return e.id===t.id&&e.name===t.name&&e.layers.length===t.layers.length&&e.active===t.active&&e.type===t.type&&e.layers.every(((e,n)=>{const a=t.layers[n];return e.id===a.id&&e.name===a.name&&e.toggled===a.toggled}))}update(){for(const e of this.layersData.getOrderedModelViews(vc))this._data[e.id]=Ec(this.layersData,e,this._data[e.id]);for(const e in this.data)try{this.layersData.getView(e)||delete this._data[e]}catch(t){delete this._data[e]}}clear(){this._data={}}}class Ac{constructor(e,t){this.ownedViews=e,this.layersModule=t}validateInput(e){if(!te(e.name))throw Z("name","string",e.name);return{name:e.name}}async exec(e,t){const n=await this.layersModule.addUserView(e.name,!0);return this.ownedViews.add(t.client.applicationKey,n.id),Ec(this.layersModule.layersData,n)}}class Oc{constructor(e,t){this.ownedViews=e,this.layersModule=t}validateInput(e,t){if(!te(e.viewId))throw Z("name","string",e.viewId);const n=this.layersModule.layersData.getView(e.viewId);if(!n||!n.transient)throw Error(`${e.viewId} does not map to a valid view`);if(!this.ownedViews.has(t.client.applicationKey,n.id))throw Error("Cannot delete a view not associated with this SDK connection");return{view:n}}async exec(e,t){await this.layersModule.deleteView(e.view.id),this.ownedViews.remove(t.client.applicationKey,e.view.id)}}var Dc;!function(e){e.ADD="view.add.layer",e.REMOVE="view.remove.layer"}(Dc||(Dc={}));const Mc={namespace:"View",name:"update",args:["op","viewId","layerId"]},xc={namespace:"View",name:"activate",args:["viewId","returnToStart"]};const Rc={namespace:"View",name:"toggleLayer",args:["layerId","activate"]},Pc={namespace:"View",name:"queryLayerInterface",args:[]},Nc={namespace:"View",name:"persist",args:["viewId"]};class _c extends ge{constructor(e){super(),this.payload=e}}var kc;_c.id="SAVE_COMMAND",function(e){e.BLURS="blurs",e.BLUR_SUGGESTIONS="blur-suggestions",e.FLOORS="floors",e.HIGHLIGHTS="highlights",e.LABELS="labels",e.MATTERTAGS="mattertags",e.MEASUREMENTS="measurements",e.NOTES="notes",e.OBJECT_ANNOTATIONS="objectAnnotations",e.ORDERED_LISTS="orderedLists",e.PHOTOS="photos",e.PLUGINS="plugins",e.SETTINGS="settings",e.START_LOCATION="startlocation",e.SWEEPS="sweeps",e.LAYERS="layers",e.ROOM_BOUNDS="room_bounds"}(kc||(kc={}));class Lc{constructor(e,t,n){this.issueCommand=e,this.ignoredLayerer=t,this.layersModule=n}validateInput(e,t){const n=this.layersModule.layersData.getView(e.viewId);if(!n)throw Error(`View id ${e.viewId} does not map to a valid View. Was it deleted or already persisted?`);return{view:n}}async exec(e,t){const n=await this.layersModule.addUserView(e.view.name);for(const t of e.view.layers)this.ignoredLayerer.includes(t)||(await this.layersModule.addLayer(t.name,!1),await t.applyTransactions());return await this.layersModule.deleteView(e.view.id),await this.issueCommand(new _c({dataTypes:[...Object.values(kc)]})),Ec(this.layersModule.layersData,n)}}class Vc{constructor(e,t){this.ownedLayers=e,this.layersModule=t}validateInput(e,t){if(!te(e.name))throw Error("an empty name is not allowed");const n=e.options;if(n&&!va(n))throw Error("invalid `options` object");const a=null==n?void 0:n.common;if(void 0!==a&&!Ta(a))throw Z("options.common","boolean",a);return{name:e.name,options:{common:!!a}}}async exec(e,t){const{options:{common:n}}=e,a=this.layersModule.addInMemoryLayer({name:e.name,toggled:!0,visible:!0,common:n});return this.ownedLayers.add(t.client.applicationKey,a.id),{id:a.id,name:a.name,type:M.LayerType.IN_MEMORY,toggled:!0,common:n}}}class Fc{constructor(e,t){this.ownedLayers=e,this.layersModule=t}validateInput(e,t){if(!te(e.layerId))throw Error(`${e.layerId} does not map to a valid layer`);const n=this.layersModule.layersData.findLayer(e.layerId);if(!n)throw Error(`${e.layerId} does not map to a valid layer`);if(!this.ownedLayers.has(t.client.applicationKey,n.id))throw Error("Cannot delete a layer not associated with this SDK connection");return{layer:n}}async exec(e,t){for(const t of this.layersModule.layersData.getOrderedModelViews()){const n=t.layers.findIndex((t=>t.id===e.layer.id));n>-1&&t.layers.remove(n)}this.layersModule.deleteInMemoryLayer(e.layer.id),this.ownedLayers.remove(t.client.applicationKey,e.layer.id)}}const Uc=new Zt("View.updateLayer");class Gc{constructor(e,t){this.ownedLayers=e,this.layersData=t.layersData}validateInput(e,t){if(!yn(Dc,e.op))throw Error(`${e.op} is an unsupported operation`);if(!te(e.viewId))throw Error(`${e.viewId} is not a valid view id`);const n=this.layersData.getView(e.viewId);if(!n)throw Error(`${e.viewId} does not map to a valid View`);if(!te(e.layerId))throw Error(`${e.layerId} is not a valid layer id`);const a=this.layersData.inMemoryLayers.find((t=>t.id===e.layerId));if(!a)throw Error(`Only SDK created layers can be manipulated. ${e.layerId} does not map to an SDK-owned layer`);if(!this.ownedLayers.has(t.client.applicationKey,a.id))throw Error("Cannot manipulate layers not associated with this SDK connection");return{op:e.op,view:n,layer:a}}async exec(e,t){({[Dc.ADD]:(e,t)=>{this.layersData.commonInMemoryLayers.includes(t)?Uc.debug("Layer is common. No need to add."):e.layers.includes(t)||e.layers.push(t)},[Dc.REMOVE]:(e,t)=>{const n=e.layers.findIndex((e=>e.id===t.id));if(n>=0){this.layersData.commonInMemoryLayers.includes(t)?Uc.debug("Layer is common. Cannot be removed from View."):e.layers.remove(n)}}})[e.op](e.view,e.layer)}}class Hc{constructor(e,t){this.layersModule=e,this.cameraStartModule=t}validateInput(e,t){if(!te(e.viewId)||!this.layersModule.layersData.getView(e.viewId))throw Error(`${e.viewId} does not map to a valid View`);return{viewId:e.viewId,returnToStart:!!e.returnToStart}}async exec(e,t){e.returnToStart?await this.layersModule.setActiveModelView(e.viewId):(this.cameraStartModule.setMoveCameraOnViewChange(!1),await this.layersModule.setActiveModelView(e.viewId),this.cameraStartModule.setMoveCameraOnViewChange(!0))}}class Bc{create(e,t){return new Lt(t.layersData.onPropertyChanged("currentViewId",(()=>e.onChanged())),t.layersData.onCurrentLayersChanged((()=>e.onChanged())))}}class zc{constructor(){this._data={id:"",name:"",active:!1,type:M.ViewType.OTHER,layers:[],transient:!1}}get data(){return this._data}copy(e){this._data.id=e.data.id,this._data.name=e.data.name,this._data.active=e.data.active,this._data.type=e.data.type,this._data.transient=e.data.transient,Cn(this._data.layers,e.data.layers)}equals(e){return this.data.id===e.data.id&&this.data.name===e.data.name&&this.data.active===e.data.active&&this.data.type===e.data.type&&this.data.transient===e.data.transient&&this.data.layers.length===e.data.layers.length&&this._data.layers.every(((e,t)=>{const n=this.data.layers[t];return e.id===n.id&&e.name===n.name&&e.toggled===n.toggled}))}update(e){const t=e.layersData,n=t.getView(t.currentViewId);Ec(t,n,this._data)}}class $c{static isValue(e){return new $c(new jc(e))}static isType(e){return new $c(new qc(e))}static isInstanceOf(e){return new $c(new Wc(e))}static is(e){return new $c(new Kc(e))}static isAny(){return new $c(new Yc)}constructor(e){this.matcher=e}compare(e){return this.matcher.matches(e)}}class jc{constructor(e){this.value=e}matches(e){return this.value===e}}class qc{constructor(e){this.type=e}matches(e){return Object.getPrototypeOf(e).constructor===this.type}}class Wc{constructor(e){this.type=e}matches(e){if("object"==typeof e)return e instanceof this.type;const t=this.type;switch(typeof e){case"number":return t===Number;case"string":return t===String;case"boolean":return t===Boolean;case"function":return t===Function}return!1}}class Kc{constructor(e){this.predicate=e}matches(e){return this.predicate(e)}}class Yc{constructor(){}matches(){return!0}}class Xc{constructor(e,t){this.sdk=e,this.commandFilter=t,this._data=new Map}validateInput(){return{}}async exec(){return this.data}get data(){return this._data=new Map(this.sdk.registeredCommands(this.commandFilter)),this._data}}class Zc{constructor(e){this.layersData=e.layersData}validateInput(e,t){if(!te(e.layerId))throw Error(`${e.layerId} does not map to a valid Layer`);const n=this.layersData.getLayer(e.layerId);if(!n)throw Error(`${e.layerId} does not map to a valid Layer`);return{layer:n,activate:void 0===e.activate?void 0:!!e.activate}}async exec(e,t){const n=void 0!==e.activate?e.activate:!e.layer.toggled;this.layersData.toggleLayer(e.layer.id,n)}}function Qc(e,t,n,a){e.addEnumToInterface({namespace:"View",name:"ViewType",values:M.ViewType}),e.addEnumToInterface({namespace:"View",name:"LayerType",values:M.LayerType});const o=new gi,s=new gi,r=new z(t.layersModule),i=function(e,t){const n=de.create(t,new Bc,new $(zc));return e.addObservableToInterface({namespace:"View",name:"current",objectFactory:"View"},n),n}(e,r),c=function(e,t){const n=sa.create(t,new Sc,new $(Cc));return e.addCollectionToInterface({namespace:"View",name:"views",elementFactory:"View"},n),n}(e,r),d=function(e,t){const n=sa.create(t,new Ic,new $(bc));return e.addCollectionToInterface({namespace:"View",name:"layers",elementFactory:"Layer"},n),n}(e,r),l=function(e,t,n){const a=Na.create(t,new $(Ac,n));return e.addCommandToInterface({namespace:"View",name:"createView",args:["name"],subRoutine:"View"},a),a}(e,r,o),u=function(e,t,n){const a=Na.create(t,new $(Oc,n));return e.addCommandToInterface({namespace:"View",name:"deleteView",args:["viewId"],subRoutine:"view.deleteView"},a),a}(e,r,o);!function(e,t,n,a){const o=Na.create(t,new $(Lc,n.issueCommand,a));e.addCommandUnlisted(Nc,o)}(e,r,n,a),function(e){const t=$c.is((e=>{var t,n;return!(null===(t=e.options)||void 0===t?void 0:t.deprecated)&&!!(null===(n=e.options)||void 0===n?void 0:n.replay)})),n=Na.create(z.none,new $(Xc,e,t));e.addCommandUnlisted(Pc,n)}(e);const h=function(e,t,n){const a=Na.create(t,new $(Gc,n));return e.addCommandUnlisted(Mc,a),a}(e,r,s),p=function(e,t){const n=Na.create(t,new $(Hc));return e.addCommandUnlisted(xc,n),n}(e,z.extend(r,t.cameraStartModule)),m=function(e,t,n){const a=Na.create(t,new $(Vc,n));return e.addCommandToInterface({namespace:"View",name:"createLayer",args:["name","options"],subRoutine:"Layer"},a),a}(e,r,s),g=function(e,t,n){const a=Na.create(t,new $(Fc,n));return e.addCommandToInterface({namespace:"View",name:"deleteLayer",args:["layerId"],subRoutine:"view.deleteLayer"},a),a}(e,r,s),f=function(e,t){const n=Na.create(t,new $(Zc));return e.addCommandUnlisted(Rc,n),n}(e,r);return{current:i,views:c,layers:d,createView:l,deleteView:u,updateView:h,activateView:p,createLayer:m,deleteLayer:g,toggleLayer:f}}const Jc=new Zt("layer interrupt");class ed{constructor(e,t){this.layersModule=e,this.commonLayer=t}async interrupt({commandDef:e,executionContext:t,command:n,payload:a}){var o;if(!(null===(o=e.options)||void 0===o?void 0:o.replay))return;return{deferTo:new Promise(((o,s)=>{const r=t.layerId?this.layersModule.layersData.getLayerAnyView(t.layerId):this.commonLayer;if(!r)throw Error(t.layerId+" does not map to a valid layer");const i=r.onApply((async r=>{Jc.debug("executing",`${e.namespace}.${e.name}`,a);try{o(await n.exec(a,t))}catch(e){return Jc.debugWarn(e),s(e),r}}).bind(null,(()=>i.delete())))}))}}}class td{constructor(e){this.commands=e,this.issueCommand=this.commands.issueCommand}validateInput(e){return{}}async exec(e){await this.issueCommand(new this.commands.DisableInputCommand)}}class nd{constructor(e){this.commands=e,this.issueCommand=this.commands.issueCommand}validateInput(e){return{}}async exec(e){await this.issueCommand(new this.commands.EnableInputCommand)}}class ad{create(e,t,n){const a=()=>e.onChanged();return new Lt(n.onChanged(a),t.onChanged(a))}}class od{constructor(e){this._data={from:null,to:null},this.viewmodeConverter=e.viewmodeConverter}get data(){return this._data}equals(e){return this._data.from===e._data.from&&this._data.to===e._data.to}copy(e){this._data={from:e._data.from,to:e._data.to}}update(e,t){const n=t.state.currentSweep&&t.isSweepAligned(t.state.currentSweep),a=t.state.transition.to&&t.isSweepAligned(t.state.transition.to);this._data=e.transition.active?{from:this.viewmodeConverter.toSdk(e.transition.from,!!n,e.transition.isFromPitchFactorOrtho),to:this.viewmodeConverter.toSdk(e.transition.to,!!a,e.transition.isToPitchFactorOrtho)}:{from:null,to:null}}}function*sd(e){const t=[...e];for(let e=t.length-1;e>=0;--e)yield t[e]}function*rd(...e){for(const t of e)yield*t}class id{constructor(e){this.sdk=e,this.allRegisteredCommands=new Map,this.commandObservers=new Set,this.globalInterrupts=new Set,this.commandInterrupts=new gi,this.globalCommandHooks=new Set,this.commandHooks=new gi}connect(e,t){return this.sdk.connect(e,t)}connectPlugin(e,t){return this.sdk.connectPlugin(e,t)}getClientAuth(e){return this.sdk.getClientAuth(e)}addEnumToInterface(e){return this.sdk.addEnumToInterface(e)}addCommandToInterface(e,t){return this.sdk.addCommandToInterface(e,this.createCommandProxy(e,t))}addAsyncCommandToInterface(e,t){return this.sdk.addAsyncCommandToInterface(e,this.createCommandProxy(e,t))}addCommandUnlisted(e,t,n){return this.sdk.addCommandUnlisted(e,this.createCommandProxy(e,t),n)}addObservable(e,t){return this.sdk.addObservable(e,t)}addObservableToInterface(e,t){return this.sdk.addObservableToInterface(e,t)}addCollection(e,t){return this.sdk.addCollection(e,t)}addCollectionToInterface(e,t){return this.sdk.addCollectionToInterface(e,t)}broadcast(e,t,n){return this.sdk.broadcast(e,t,n)}sendPrivateMessage(e,t){return this.sdk.sendPrivateMessage(e,t)}addPrivateMessageHandler(e){return this.sdk.addPrivateMessageHandler(e)}addCommandCreator(e,t){return this.sdk.addCommandCreator(e,t)}interruptCommands(e,...t){if(0===t.length)this.globalInterrupts.add(e);else for(const n of t)this.commandInterrupts.add(n,e)}hookCommands(e,...t){if(0===t.length)this.globalCommandHooks.add(e);else for(const n of t)this.commandHooks.add(n,e)}async createCommandProxy(e,t){var n;const a={beforeFirstExec:async e=>{for(const n of rd(this.globalInterrupts,this.commandInterrupts.getValuesAtKey(t))){const t=await n.interrupt(e);if(t)return t}},beforeExec:async e=>{var n;for(const a of rd(this.globalCommandHooks,this.commandHooks.getValuesAtKey(t)))await(null===(n=a.beforeExec)||void 0===n?void 0:n.call(a,e))},afterExec:async e=>{var n;for(const a of rd(sd(this.commandHooks.getValuesAtKey(t)),sd(this.globalCommandHooks)))await(null===(n=a.postExec)||void 0===n?void 0:n.call(a,e))}};if(this.allRegisteredCommands.set(`${e.namespace}.${e.name}`,e),this.triggerCommandObservers(e),null===(n=e.options)||void 0===n?void 0:n.deprecated){const n=`"${e.namespace}.${e.name}" is deprecated`+(ne(e.options.deprecated)?`; use ${e.options.deprecated}`:"");return new cd(a,e,await ee(t,n))}return new cd(a,e,await t)}*registeredCommands(e){for(const t of this.allRegisteredCommands){const[,n]=t;e.compare(n)&&(yield t)}}onCommandsUpdated(e,t){const n=[e,t],a={renew:()=>this.commandObservers.add(n),cancel:()=>this.commandObservers.delete(n)};return a.renew(),a}triggerCommandObservers(e){for(const[t,n]of this.commandObservers)n.compare(e)&&t(e)}track(e,t,n){this.sdk.track(e,t,n)}}class cd{constructor(e,t,n){this.hooks=e,this.commandDef=t,this.command=n}async exec(e,t){const n={commandDef:this.commandDef,executionContext:t,command:this.command,payload:e,proxy:this};if(!t.isReExec){const e=await this.hooks.beforeFirstExec(n);if(e)return e.deferTo}await this.hooks.beforeExec(n);const a=await this.command.exec(e,t);return await this.hooks.afterExec(n),t.isReExec=!0,a}validateInput(e,t){return this.command.validateInput(e,t)}}const dd=new Zt("SDK interface");async function ld(e,t,n,a,f,y,I,C){Zt.level=I.logLevel||W.INFO;const{THREE:O}=t,{api:M,cameraData:B,canvasData:j,deepLinks:q,floorData:K,floorViewData:Y,labelData:Z,layersModule:Q,mattertagData:J,tagsViewData:te,measurementModeData:ne,meshData:le,modelData:ue,annotationsViewData:he,raycasterData:ge,roomData:ye,roomBoundData:ve,roomBoundViewData:Te,settingsData:Ie,sweepData:Se,tourData:Ce,viewmodeData:Ae,attachmentsModule:Oe,commonControlsModule:De,floorCasterModule:Me,meshQuery:xe,modelMeshModule:Re,navigationModule:Pe,plugin:Ne,pluginConfigData:_e,renderToTextureModule:ke,sceneModule:Le,sensorModule:Ve,settingsModule:Fe,tourControlsModule:Ue,webglRendererModule:Ge,zoomControlModule:He,sweepTextureLoader:Be,cursorController:ze,pluginData:$e,pluginUiData:je,externalR3FModule:qe}=f,[We,Ke]=await Promise.all([Q,Ie]);let Ye=Ke.tryGetSetting(Ee,!1)||Ke.tryGetSetting(be,!1),Xe=null;try{Xe=We.addInMemoryLayer({name:"Temporary Layer",visible:!0,toggled:!0,common:!0})}catch(e){Ye=!1,Xe=null,dd.info("Error setting up layers. Views and Layers features will be disabled. -- ",e)}const Ze=new id(e),Qe=new V(O),Je=new _(n.Viewmode),et=function(e){return async function(t,n,a){const o=a.rotationSpeed;let s=a.yAngle;if(a.clampYRotation)if(n.pose.isPitchFactorOrtho)s=0;else{const e=n.pose.phi()+a.yAngle-Fn;e>0&&(s=Math.max(a.yAngle-e,0))}let r=0;const i=Math.abs(a.xAngle),c=Math.abs(s),d=Math.max(i,c);if(d>=Math.PI){const e=d/Math.PI,t=Math.floor(e),n=i/e,a=c/e,o=i-n*t,s=c-a*t;r=Math.acos(Math.cos(n)*Math.cos(a))*t+Math.acos(Math.cos(o)*Math.cos(s))}else r=Math.acos(Math.cos(Math.abs(a.xAngle))*Math.cos(Math.abs(s)));if(r){const n=new e.Vector2(-a.xAngle,s);return n.multiplyScalar(o/r),t.startRotateTransition(r/o,n,!1)}}}(O),tt=new fr(n.SweepAlignmentType,n.SweepPlacementType),nt=Object.assign(Object.assign({},a),{conversionUtils:new V(O),directionConverter:new N(n.Vectors),getPose:na(O,Je),rotateCamera:et,rotateCameraBetweenOrientations:Un(O),orientCamera:Bn(O,n.Viewmode,et),stopCamera:async function(e){return e.stop()},appPhaseConverter:new se(n.AppPhase),applicationConverter:new re(n.Application),mediaConverter:new xa(n.MattertagMediaType,n.TagDescriptionChunkType),chunkTypeConverter:new Ra(n.TagDescriptionChunkType),linkTypeConverter:new Pa(n.TagLinkType),sweepPlacementConverter:tt,viewmodeConverter:Je,commandModeConverter:new k(n.CommandViewmode),cameraTransitionConverter:new L(n.CameraTransitionType),makeLabelData:ma(O,a.worldToScreenPosition),makeModelData:_o(Qe,tt),sweepUtils:new F(n.SweepAlignmentType),tourStateConverter:new fc(n.TourState)});C.bindConstant(o,nt),C.bindConstant(s,n),C.bindConstant(r,t);const at=async function(e){const t=await e;return new U(t)}(Se),ot=async function(e){const t=await e;return new G(t)}(K),st=async function(e){const t=await e;return new H(t)}(ye),rt=async function(e,t,n,a){const[o,s,r]=await Promise.all([e,t,a]);return new $a(o,s,n,r)}(J,Oe,t.oEmbed,void 0),it=new Map;!function(e,t){const n=X.create(new z,new $(oe,t));e.addAsyncCommandToInterface({namespace:"API",name:"getViews",args:["spaceSid"],varArg:!1,origins:ae,options:{replay:!1}},n)}(Ze,nt.getModelViewsQuery),function(e){e.addEnumToInterface({namespace:"App",name:"Phase",values:m.Phase}),e.addEnumToInterface({namespace:"App",name:"Event",values:m.Event}),e.addEnumToInterface({namespace:"App",name:"Feature",values:m.Feature}),e.addEnumToInterface({namespace:"App",name:"Application",values:m.Application})}(Ze),function(e,t){const n=t.get(s),a=t.get(o),r=[void 0],i=e=>(r[0]=a.appPhaseConverter.toSdkAppPhase(e.phase),r);a.subscribe(n.AppPhaseChangeMessage,(t=>{e.broadcast(m.Event.PHASE_CHANGE,i,t)}))}(Ze,C),function(e,t){const n=t.get(o);t.resolve(ie).then((e=>{n.addBinding(fe,(async()=>{try{const t=e.data;return{phase:n.appPhaseConverter.toSdkAppPhase(t.phase),application:n.applicationConverter.toSdkApplication(t.application)}}catch(e){throw Error("Error: Can't get application data at this time")}}))})),e.addCommandCreator({namespace:"App",name:"getState",args:[]},(()=>new fe))}(Ze,C),function(e,t){const n=t.get(o);n.addBinding(we,(async()=>{const e={[m.Phase.WAITING]:null,[m.Phase.LOADING]:null,[m.Phase.STARTING]:null,[m.Phase.PLAYING]:null,[m.Phase.ERROR]:null},a=(await t.resolve(ie)).data;for(const t in a.phaseTimes){const o=Number(t);e[n.appPhaseConverter.toSdkAppPhase(o)]=a.phaseTimes[o]}return e})),e.addCommandCreator({namespace:"App",name:"getLoadTimes",args:[]},(()=>new we))}(Ze,C),function(e,t){const n=t.get(s),a=t.get(o),r=de.createDI(t,[ie],new pe,new $(me,n,a),(e=>[e.data]));e.addObservableToInterface({namespace:"App",name:"state"},r)}(Ze,C),function(e,t){const n=de.createDI(t,[ce,u,c],new Vt,new $(Ft),((e,t,n)=>[e.settingsData,t.data,n.layersData]));e.addObservableToInterface({namespace:"App",name:"features"},n)}(Ze,C),function(e,t){const n=X.createDI(t,[d],(e=>new $t(e)));e.addCommandToInterface({namespace:"App.Locale",name:"getLanguageCode",args:[]},n)}(Ze,C),function(e,t){const n=X.createDI(t,[d],(e=>new jt(e)));e.addCommandToInterface({namespace:"App.Locale",name:"getT",args:[],sdkTypes:[Ut.DIRECT]},n)}(Ze,C),function(e,t){const n=t.get(r),a=X.createDI(t,[i],(t=>new zt(e,n.jsonSchemaValidator)));e.addCommandToInterface({namespace:"App",name:"track",args:["name","options"],sdkTypes:[Ut.DIRECT]},a)}(Ze,C);const ct=hn(Ze,O,nt,it,f,rt);!function(e,t,n){n.getDependencies().then((([e,n,a,o])=>{const s={position:{x:0,y:0,z:0},rotation:{x:0,y:0},projection:new Float32Array(16),sweep:"",mode:b.Mode.TRANSITIONING};t.addBinding(pn,(async()=>t.getPose(s,e,n,a,o)))})),e.addCommandCreator({namespace:"Camera",name:"getPose",args:[]},(()=>new pn))}(Ze,nt,new z(B,Se,Ae,at)),function(e,t,n,a){a.getDependencies().then((([e,a,o])=>{n.addBinding(gn,(async function(s={}){if(!o.isInside())throw Error("Camera.lookAtScreenCoords must be called from Inside mode");const r=n.screenPositionToNDC(s.x,s.y,a.width,a.height),i=new t.Vector3(0,0,-1).applyQuaternion(a.pose.rotation),c=n.ndcToWorldPosition(a,new t.Vector2(r.x,r.y),1).normalize(),d=i.clone().setY(0).angleTo(c.clone().setY(0)),l=Math.asin(c.y-i.y),u=d*Math.sign(r.x),h=l;return n.rotateCamera(e,a,{xAngle:u,yAngle:h,zAngle:0,rotationSpeed:mn,clampYRotation:!1})}))})),e.addCommandCreator({namespace:"Camera",name:"lookAtScreenCoords",args:["x","y"]},(function(e={}){if(e.x=e.x||0,e.y=e.y||0,isNaN(e.x)||isNaN(e.y))throw new Error(`${JSON.stringify(e)} does not contain valid screen coordinates`);return new gn({x:e.x,y:e.y})}))}(Ze,O,nt,new z(De,B,Ae)),function(e,t,n){n.getDependencies().then((([n,a,o,s])=>{const r=[{position:{x:0,y:0,z:0},rotation:{x:0,y:0},projection:new Float32Array(16),sweep:"",mode:b.Mode.TRANSITIONING}],i=(()=>{let c=0,d=!1;const l=()=>(t.getPose(r[0],n,a,o,s),r);return()=>{const t=Date.now(),n=c+wn;if(t>n){d=!1,c=t;try{e.broadcast(g.Event.MOVE,l)}catch(e){fn.debug("failed to broadcast pose, one of the module dependencies are probably not loaded yet")}}else d||(setTimeout((()=>i()),n-t),d=!0)}})();n.onChanged(i),o.onChanged(i)})),e.addEnumToInterface({namespace:"Camera",name:"Event",values:g.Event})}(Ze,nt,new z(B,Se,Ae,at)),function(e,t,n){n.getDependencies().then((([e])=>t.addBinding(vn,(async n=>{const a=n.direction;if(!yn(g.Direction,n.direction))throw new Error(`${n.direction} is not a valid direction`);await e.navigateInLocalDirection(t.directionConverter.toVector(a))})))),e.addEnumToInterface({namespace:"Camera",name:"Direction",values:g.Direction}),e.addCommandCreator({namespace:"Camera",name:"moveInDirection",args:["direction"]},(e=>new vn(e||{})))}(Ze,nt,new z(Pe)),function(e,t,n,a){a.getDependencies().then((([e,a])=>{n.addBinding(In,(async n=>{const o=a.pose.position,s=n.x-o.x,r=n.z-o.z,i=new t.Vector2(s,r),c=i.length();i.setLength(Tn),await e.startTranslateTransition(c/Tn,i,!1)}))})),e.addCommandCreator({namespace:"Camera",name:"pan",args:["position"]},(e=>{if((e=e||{}).position=e.position||{},e.position.x=e.position.x-0,e.position.z=e.position.z-0,isNaN(e.position.x)||isNaN(e.position.z))throw new Error(`${JSON.stringify(e)} does not contain a valid position to pan`);return new In({x:e.position.x,z:e.position.z})}))}(Ze,O,nt,new z(De,B)),function(e,t,n,a){const o=de.create(a,new xn,new $(Rn,t,n.viewmodeConverter));e.addObservableToInterface({namespace:"Camera",name:"pose"},o)}(Ze,O,nt,new z(B,Se,Ae,at)),$n(Ze,O,nt,new z(De,B,Ae)),function(e,t,n){n.getDependencies().then((([e])=>{t.addBinding(jn,(async()=>await t.stopCamera(e)))})),e.addCommandCreator({namespace:"Camera",name:"stop",args:[]},(()=>new jn))}(Ze,nt,new z(De)),function(e,t,n,a){const o=a,s=X.create(o,new $(Xn,t,n)),r=X.create(o,new $(Zn,t,n)),i=X.create(o,new $(Qn,t,n));e.addCommandToInterface({namespace:"Camera",name:"zoomTo",args:["zoomPct"]},s),e.addCommandToInterface({namespace:"Camera",name:"zoomBy",args:["zoomDelta"]},r),e.addCommandToInterface({namespace:"Camera",name:"zoomReset",args:[]},i)}(Ze,n,nt,new z(B,Ae,He)),function(e,t,n){const a=de.create(n,new ea,new $(ta,t));e.addObservableToInterface({namespace:"Camera",name:"zoom"},a)}(Ze,n,new z(B,Ae)),function(e,t,n){const a=de.create(n,new aa,new $(oa,t));e.addObservableToInterface({namespace:"Floor",name:"current"},a)}(Ze,n,new z(Y,Se,B,Ce,ot)),function(e,t,n,a){e.addEnumToInterface({namespace:"Floor",name:"Event",values:w.Event}),a.getDependencies().then((([a])=>{const o=[-1,-1];function s(e){if(a){const t=e.to?a.getFloor(e.to):null,n=e.from?a.getFloor(e.from):null;t&&(o[0]=t.index),n&&(o[1]=n.index)}return o}const r=[-1,""];function i(e){if(a){const t=e.floorId?a.getFloor(e.floorId):null;t&&(r[0]=t.index)}return r[1]=e.floorName,r}n.subscribe(t.StartMoveToFloorMessage,(t=>e.broadcast(w.Event.CHANGE_START,s,t))),n.subscribe(t.EndMoveToFloorMessage,(t=>e.broadcast(w.Event.CHANGE_END,i,t)))}))}(Ze,n,nt,new z(K)),function(e,t){const n=sa.create(t,new ra,new $(ia));e.addCollectionToInterface({namespace:"Floor",name:"data"},n)}(Ze,new z(K,ot)),function(e,t,n){t.addBinding(ca,(async()=>{const[e]=await n.getDependencies();return da(e)})),e.addCommandCreator({namespace:"Floor",name:"getData",args:[]},(()=>new ca))}(Ze,nt,new z(Y)),function(e,t,n,a){a.getDependencies().then((([e])=>n.addBinding(la,(async a=>{if("number"!=typeof a.floorIndex||a.floorIndex<0)throw Error("floor index must be a non-negative number");try{const o="boolean"==typeof a.moveCamera&&!a.moveCamera,s=o?250:void 0;await n.issueCommand(new t.MoveToFloorIndexCommand(a.floorIndex,o,s));const r=e.currentFloor;return r?r.index:-1}catch(e){throw Error(`Could not move to floor at index ${a.floorIndex}`)}})))),e.addCommandCreator({namespace:"Floor",name:"moveTo",args:["floorIndex","moveCamera"]},(e=>new la(e)))}(Ze,n,nt,new z(Y)),function(e,t,n,a){const o=X.create(a,new $(ua,t,n));e.addCommandToInterface({namespace:"Floor",name:"showAll",args:["moveCamera"]},o)}(Ze,n,nt,new z(Y)),function(e,t){const n=X.create(t,new $(ha));e.addCommandToInterface({namespace:"Floor.Conversion",name:"createIdMap",args:["invert"]},n)}(Ze,new z(K)),function(e,t,n){t.addBinding(pa,(async()=>t.makeLabelData(...await n.getDependencies()))),e.addCommandCreator({namespace:"Label",name:"getData",args:[]},(()=>new pa))}(Ze,nt,new z(B,K,Z,ot)),function(e,t,n,a){e.addEnumToInterface({namespace:"Label",name:"Event",values:v.Event}),a.getDependencies().then((([t,a,o,s,r])=>{const i=()=>[n.makeLabelData(t,o,a,r)];t.onChanged((n=>{t.pose.isPitchFactorOrtho&&e.broadcast(v.Event.POSITION_UPDATED,i,n)}))}))}(Ze,0,nt,new z(B,Z,K,Ae,ot)),function(e,t){const n=sa.create(t,new ga,new $(fa));e.addCollectionToInterface({namespace:"Label",name:"data"},n)}(Ze,new z(Z,K,ot)),function(e,t){const n=X.create(t,new $(wa));e.addAsyncCommandToInterface({namespace:"Link",name:"createLink",args:[]},n)}(Ze,new z(q)),function(e,t){const n=X.create(t,new $(ya));e.addAsyncCommandToInterface({namespace:"Link",name:"createDeepLink",args:[]},n)}(Ze,new z(q)),function(e,t){const n=X.create(t,new $(ba,e)),a=X.create(t,new $(Sa,e)),o=X.create(t,new $(Ca,e)),s=X.create(t,new $(Aa,e));e.addEnumToInterface({namespace:"Link",name:"OpenPolicy",values:T.OpenPolicy}),e.addEnumToInterface({namespace:"Link",name:"DestinationPolicy",values:T.DestinationPolicy}),e.addAsyncCommandToInterface({namespace:"Link",name:"setModelLinkPolicy",args:["policy","baseHref"],subRoutine:"link.setopenpolicy"},n),e.addAsyncCommandToInterface({namespace:"Link",name:"setNavigationLinkPolicy",args:["policy","baseHref"],subRoutine:"link.setopenpolicy"},a),e.addAsyncCommandToInterface({namespace:"Link",name:"setSameOriginLinkPolicy",args:["policy"]},o),e.addAsyncCommandToInterface({namespace:"Link",name:"setExternalLinkPolicy",args:["openInNewWindow"]},s)}(Ze,new z(q,y)),function(e,t){const n=X.create(t,new $(Ma));e.addEnumToInterface({namespace:"Link",name:"CreationPolicy",values:T.CreationPolicy}),e.addAsyncCommandToInterface({namespace:"Link",name:"setShareLinkPolicy",args:["policy","baseHref","options"],subRoutine:"link.setsharepolicy"},n)}(Ze,new z(q));const dt=async function(){const e=I.sandboxPath;return(await fetch(e)).text()}(),lt=Bi(Ze,O,n,nt,it,rt,dt,nt.getTagsQuery,Xe,nt.isMpFontId,Object.assign(Object.assign({},f),{roomIdMap:st}));ro(Ze,n,Object.assign(Object.assign({},nt),{getIframeSrcDoc:dt}),ct,lt,[J,te,he,K,ot,rt]),function(e,t,n){t.addBinding(co,(async()=>{const[e,t]=await n.getDependencies();return lo(e,t)})),e.addCommandCreator({namespace:"Measurements",name:"getData",args:[]},(()=>new co))}(Ze,nt,new z(ne,K)),function(e,t,n){const a=sa.create(n,new uo(t.MeasuringPhase),new $(ho));e.addCollectionToInterface({namespace:"Measurements",name:"data"},a)}(Ze,n,new z(ne)),function(e,t){const n=de.create(t,new po,new $(mo));e.addObservableToInterface({namespace:"Measurements",name:"mode"},n)}(Ze,new z(ne)),function(e,t,n,a){const o=X.create(a,(e=>new fo(t.Tools,n.issueCommand)));e.addAsyncCommandToInterface({namespace:"Measurements",name:"toggleMode",args:["active"]},o)}(Ze,n,nt,new z(ne)),function(e,t,n,a){e.addEnumToInterface({namespace:"Mode",name:"Event",values:b.Event}),a.getDependencies().then((([a,o,s])=>{const r=[void 0,void 0],i=e=>{const t=o.currentMode,s=n.sweepUtils.isSweepAligned(a,e.fromSweep),i=n.sweepUtils.isSweepAligned(a,e.toSweep);return r[0]=n.viewmodeConverter.toSdk(t,s),r[1]=n.viewmodeConverter.toSdk(t,i),r};n.subscribe(t.EndMoveToSweepMessage,(t=>{n.sweepUtils.isSweepAligned(a,t.fromSweep)!==n.sweepUtils.isSweepAligned(a,t.toSweep)&&e.broadcast(b.Event.CHANGE_END,i,t)}));const c=[void 0,void 0],d=e=>{const t=n.sweepUtils.isCurrentSweepAligned(a);return c[0]=n.viewmodeConverter.toSdk(e.fromMode,t,s.pose.isPitchFactorOrtho),c[1]=n.viewmodeConverter.toSdk(e.toMode,t,s.pose.isPitchFactorOrtho),c};n.subscribe(t.BeginSwitchViewmodeMessage,(t=>e.broadcast(b.Event.CHANGE_START,d,t)));const l=[void 0,void 0],u=e=>{const t=n.sweepUtils.isCurrentSweepAligned(a);return l[0]=n.viewmodeConverter.toSdk(e.fromMode,t,s.pose.isPitchFactorOrtho),l[1]=n.viewmodeConverter.toSdk(e.toMode,t,s.pose.isPitchFactorOrtho),l};n.subscribe(t.EndSwitchViewmodeMessage,(t=>e.broadcast(b.Event.CHANGE_END,u,t)))}))}(Ze,n,nt,new z(Se,Ae,B)),function(e,t,n,a){a.addBinding(Co,(async e=>{try{e.options=e.options||{};let t=n.CameraTransitionType.Interpolate;const o=e.options.transition;return void 0===o||isNaN(o)||(t=o),await a.issueCommand(new n.ChangeViewmodeCommand(e.mode,t,{position:e.options.position,rotation:e.options.rotation,zoom:e.options.zoom})),e.mode}catch(t){const n=t instanceof vo?`Mode.moveTo -> Cannot move to ${e.mode} during a mode transition`:`Mode.moveTo -> Could not move to ${e.mode}`;if(So.info(t,n),t instanceof vo)throw Error(`Mode.moveTo -> Cannot move to ${e.mode} during a mode transition`);throw Error(`Mode.moveTo -> Could not move to ${e.mode}`)}}));const o=new Ao(t,a.commandModeConverter,a.conversionUtils,a.cameraTransitionConverter);e.addCommandCreator({namespace:"Mode",name:"moveTo",args:["mode","options"]},(e=>new Co(o.validateMoveToModeInput(e)))),e.addEnumToInterface({namespace:"Mode",name:"Mode",values:b.Mode}),e.addEnumToInterface({namespace:"Mode",name:"TransitionType",values:P})}(Ze,O,n,nt,new z),function(e,t,n,a){const o=de.create(a,new Oo,new $(Do,t,n));e.addObservableToInterface({namespace:"Mode",name:"current"},o)}(Ze,n,nt,new z(Ae,Se,B)),function(e,t,n){const a=de.create(n,new ad,new $(od,t));e.addObservableToInterface({namespace:"Mode",name:"transition"},a)}(Ze,nt,new z(Ae,Se)),xo(Ze,nt,new z(ue,Se,K,at)),Po(Ze,n,nt,new z(ue,Ie)),function(e,t,n,a){e.addEnumToInterface({namespace:"Model",name:"Event",values:E.Event});const o={sid:"",sweeps:[],modelSupportsVr:!1},s=[o];a.getDependencies().then((a=>{n.subscribe(t.ModelDataLoadedMessage,(async t=>{const[r,i,c]=a;await n.makeModelData(t.sid,t.vrSupported,r.getSweepList(),i,c,o),e.broadcast(E.Event.MODEL_LOADED,(()=>s))}))}))}(Ze,n,nt,new z(Se,K,at)),function(e,t){const n=X.create(t,new $(Lo));e.addCommandUnlisted(ko,n,!0)}(Ze,new z(n.MpSdkAuthentication)),function(e,t){const n=sa.create(t,new zo,new $($o));e.addCollectionToInterface({namespace:"Plugin",name:"data",origins:ae},n)}(Ze,new z($e,je)),function(e,t){const n=X.create(t,new $(Ho));e.addAsyncCommandToInterface({namespace:"Plugin",name:"load",args:["key","path","config","metadata"],varArg:!1,sdkTypes:[Ut.POSTMESSAGE],origins:ae},n)}(Ze,new z(Ne)),function(e,t){const n=X.create(t,new $(Bo));e.addAsyncCommandToInterface({namespace:"Plugin",name:"unload",args:["key"],varArg:!1,sdkTypes:[Ut.POSTMESSAGE],origins:ae},n)}(Ze,new z(Ne)),function(e){e.addEnumToInterface({namespace:"Plugin",name:"Visibility",values:R.Visibility,origins:ae})}(Ze),async function(){await C.resolve(l).then((e=>{var t,n;const a=e.policyData.getPolicy(ac);null!==(n=null===(t=null==a?void 0:a.options)||void 0===t?void 0:t.includes(nc))&&void 0!==n&&n&&(function(e,t){const n=t.get(o),a=X.createDI(t,[p,u],((e,t)=>new Ji(n,e.data,t.data)));e.addCommandToInterface({namespace:"PI.Room",name:"moveTo",args:["roomId","options"]},a)}(Ze,C),function(e,t){const n=de.createDI(t,[h],new ec,new $(tc),(e=>[e.currentRoomData]));e.addObservableToInterface({namespace:"PI.Room",name:"current"},n)}(Ze,C))})).catch((e=>{dd.debug("PolicyModule resolution failed, skipping PI namespace creation",e)}))}(),function(e,t,n,a){const o=de.create(a,new jo,new $(qo,t,n));e.addEnumToInterface({namespace:"Pointer",name:"Colliders",values:S.Colliders}),e.addObservableToInterface({namespace:"Pointer",name:"intersection"},o)}(Ze,O,n,new z(ge,K,ye,le,xe)),function(e,t,n){const a=X.create(n,new $(Wo)),o=X.create(n,new $(Ko));e.addCommandToInterface({namespace:"Pointer",name:"registerTexture",args:["textureId","textureSrc"],varArg:!1},t),e.addCommandToInterface({namespace:"Pointer",name:"editTexture",args:["textureId"],varArg:!1},a),e.addCommandToInterface({namespace:"Pointer",name:"resetTexture",args:[],varArg:!1},o)}(Ze,ct.registerTexture,new z(ze,it)),function(e,t){const n=X.create(t,new $(Yo));e.addCommandToInterface({namespace:"Pointer",name:"setFadeProps",args:["props"],varArg:!1},n)}(Ze,new z(ze)),function(e,t){const n=X.create(t,new $(Xo));e.addCommandToInterface({namespace:"Pointer",name:"setVisible",args:["visible"],varArg:!1},n)}(Ze,new z(ze)),function(e,t){const n=X.create(t,new $(os));e.addCommandToInterface({namespace:"Renderer",name:"getScene",args:[],sdkTypes:[Ut.DIRECT],origins:ae},n)}(Ze,new z(Ge)),function(e,t,n,a,o){const s=new ss(new t.PerspectiveCamera,a.encodeRenderTarget),r=new $(ls,s,n,a),i=X.create(o,r),c=X.create(o,r);e.addCommandToInterface({namespace:"Renderer",name:"takeScreenShot",args:["resolution","visibleObjects","returnType"]},i),e.addCommandToInterface({namespace:"Camera",name:"takeScreenShot",args:["resolution","visibleObjects","returnType"]},ee(c,"`Camera.takeScreenshot` is deprecated; use `Renderer.takeScreenshot` instead"))}(Ze,O,n,nt,new z(j,Ge,ke)),function(e,t,n,a,o){const s=X.create(o,new $(us,t,n,a));e.addCommandToInterface({namespace:"Renderer",name:"takeEquirectangular",args:[]},s)}(Ze,O,n,nt,new z(Ge,ke,Ae,Se,Be)),function(e,t,n,a){const o=X.create(a,new $(hs,t,n));e.addCommandToInterface({namespace:"Renderer",name:"getScreenPosition",args:["worldPosition"]},o)}(Ze,n,nt,new z(Ge)),function(e,t){const n=X.create(t,new $(ps));e.addCommandToInterface({namespace:"Renderer",name:"getWorldPositionData",args:["screenPosition","height","includeHiddenFloors"]},n)}(Ze,new z(K,Me)),function(e,t){const n=X.create(t,new $(Zo));e.addAsyncCommandToInterface({namespace:"R3F",name:"registerR3F",args:["callbacks"],sdkTypes:[Ut.DIRECT]},n)}(Ze,new z(qe)),function(e,t,n,a,o){e.addAsyncCommandToInterface({namespace:"R3F",name:"focus",args:["target","options"],sdkTypes:[Ut.DIRECT]},X.create(o,new $(es,t,n,a)))}(Ze,O,n,nt,new z(Pe,Ae)),function(e,t){const n=X.create(t,new $(as));e.addAsyncCommandToInterface({namespace:"R3F",name:"controlsToggle",args:["enabled"],sdkTypes:[Ut.DIRECT]},n)}(Ze,new z(De)),function(e,t){const n=X.create(t,new $(Jo));e.addAsyncCommandToInterface({namespace:"R3F",name:"navigationToggle",args:["enabled"],sdkTypes:[Ut.DIRECT]},n)}(Ze,new z(Pe)),function(){const e=z.getBuilder().addDependencies(ye,K,B,Se,Ae,le,st,ot).addOptionals(ve).build();!function(e,t){const n=de.create(t,new gs,new $(fs));e.addObservableToInterface({namespace:"Room",name:"current",objectFactory:"current.room"},n)}(Ze,e);const t=z.getBuilder().addDependencies(ye,K,st,ot,le).addOptionals(ve).build();!function(e,t){const n=sa.create(t,new ws,new $(ys));e.addCollectionToInterface({namespace:"Room",name:"data",elementFactory:"collection.room"},n)}(Ze,t),function(e,t){const n=X.create(t,new $(vs));e.addCommandToInterface({namespace:"Room.Conversion",name:"createIdMap",args:["invert"]},n)}(Ze,new z(ye,K)),function(e,t){const n=X.create(t,new $(Ts));e.addCommandToInterface({namespace:"Room.Bounds",name:"forceRoomDimensionVisibility",args:["visible"]},n)}(Ze,new z(Te))}(),function(e,t,n,a,o,s,r){(function(e){e.addEnumToInterface({namespace:"Scene",name:"InteractionType",values:x.InteractionType,sdkTypes:[Ut.DIRECT]}),e.addEnumToInterface({namespace:"Scene",name:"Component",values:x.Component,sdkTypes:[Ut.DIRECT]}),e.addEnumToInterface({namespace:"Scene",name:"PathType",values:ds,sdkTypes:[Ut.DIRECT]})})(e),function(e,t){const n=X.create(t,new $(Is));e.addAsyncCommandToInterface({namespace:"Scene",name:"register",args:["name","factory"],sdkTypes:[Ut.DIRECT]},n)}(e,new z(a)),function(e,t){const n=X.create(t,new $(bs));e.addAsyncCommandToInterface({namespace:"Scene",name:"createNode",args:[],varArg:!1,sdkTypes:[Ut.DIRECT]},n)}(e,new z(a)),function(e,t,n){t.addBinding(Es,(async e=>{const[t]=await n.getDependencies();return t.sceneTags().getObjects(e.tags)})),e.addCommandCreator({namespace:"Scene",name:"query",args:["tags"],sdkTypes:[Ut.DIRECT]},(e=>new Es(e)))}(e,t,new z(a,o)),function(e,t,n,a){a.getDependencies().then((([e])=>{n.addBinding(Ss,(async n=>{n.callback(e.threeRenderer,t,e.getScene().effectComposer)}))})),e.addCommandCreator({namespace:"Scene",name:"configure",args:["callback"],sdkTypes:[Ut.DIRECT]},(e=>new Ss(e)))}(e,n,t,new z(s)),function(e,t,n){n.getDependencies().then((([e])=>{t.addBinding(Cs,(async t=>e.getImageBitmap(t.path,t.width,t.height,t.options)))})),e.addCommandCreator({namespace:"Scene",name:"getImage",args:["path","width","height","options"],sdkTypes:[Ut.DIRECT]},(e=>new Cs(e)))}(e,t,new z(r)),function(e,t){const n=X.create(t,new $(As));e.addAsyncCommandToInterface({namespace:"Scene",name:"deserialize",args:["text"],varArg:!1,sdkTypes:[Ut.DIRECT]},n)}(e,new z(a)),function(e,t){const n=X.create(t,new $(Ds));e.addCommandToInterface({namespace:"Scene",name:"serialize",args:["objects"],varArg:!1,sdkTypes:[Ut.DIRECT]},n)}(e,new z(a)),function(e,t){const n=X.create(t,new $(Ms));e.addAsyncCommandToInterface({namespace:"Scene",name:"createNodes",args:["count","userContext"],varArg:!1,sdkTypes:[Ut.DIRECT]},n)}(e,new z(a)),function(e,t){const n=X.create(t,new $(xs));e.addAsyncCommandToInterface({namespace:"Scene",name:"registerComponents",args:["components"],sdkTypes:[Ut.DIRECT]},n)}(e,new z(a)),function(e,t){const n=X.create(t,new $(Rs));e.addAsyncCommandToInterface({namespace:"Scene",name:"createObjects",args:["count"],varArg:!1,sdkTypes:[Ut.DIRECT]},n)}(e,new z(a)),function(e,t,n){const a=X.create(n,new $(Ps));e.addCommandToInterface({namespace:"Scene",name:"unregisterComponents",args:["components"],varArg:!1,sdkTypes:[Ut.DIRECT]},a)}(e,0,new z(a))}(Ze,nt,O,Le,Re,Ge,M),cr(O,n.SourceType,n.sensorVolumes)(Ze,new z(Ve)),function(e,t,n,a){n.addBinding(t.SettingGetCommand,(async e=>{const[t]=await a.getDependencies();return t.tryGetSetting(e.key,t.settingsData.getOverrideParam(e.key,void 0))})),e.addCommandCreator({namespace:"Settings",name:"get",args:["key"]},(e=>new t.SettingGetCommand(e.key)))}(Ze,n,nt,new z(Fe)),function(e,t,n,a){n.addBinding(t.SettingUpdateCommand,(async e=>{if(!e.key||"string"!=typeof e.key)throw Error("Settings: invalid key");const[t]=await a.getDependencies();return t.updateSetting(e.key,e.value),t.tryGetSetting(e.key,void 0)})),e.addCommandCreator({namespace:"Settings",name:"update",args:["key","value"]},(e=>new t.SettingUpdateCommand(e.key,e.value)))}(Ze,n,nt,new z(Fe)),function(e,t,n){n.getDependencies().then((([n])=>{new lr(t.waitForUpdate,n).calcAndBroadcast(e)})),e.addEnumToInterface({namespace:"Stat",name:"Event",values:dr})}(Ze,nt,new z(Ie)),function(e,t){const n=X.create(t,new $(hr));e.addAsyncCommandToInterface({namespace:"XStorage",name:"setItem",args:["key","data"],origins:ae},n)}(Ze,new z(ue)),function(e,t){const n=X.create(t,new $(pr));e.addAsyncCommandToInterface({namespace:"XStorage",name:"getItem",args:["key"],origins:ae},n)}(Ze,new z(ue)),function(e,t){const n=X.create(t,new $(mr));e.addAsyncCommandToInterface({namespace:"XStorage",name:"getAllItems",args:["modelId"],origins:ae},n)}(Ze,new z(ue)),function(e,t){const n=X.create(t,new $(gr));e.addAsyncCommandToInterface({namespace:"XStorage",name:"removeItem",args:["key"],origins:ae},n)}(Ze,new z(ue)),function(){!function(e){e.addEnumToInterface({namespace:"Sweep",name:"Transition",values:P}),e.addEnumToInterface({namespace:"Sweep",name:"Alignment",values:A.Alignment}),e.addEnumToInterface({namespace:"Sweep",name:"Placement",values:A.Placement})}(Ze);const e=z.getBuilder().addDependencies(Se,Ae,K,at,ot).addOptionals(ve).build();!function(e,t,n,a){const o=de.create(a,new vr,new $(Tr,t,n));e.addObservableToInterface({namespace:"Sweep",name:"current"},o)}(Ze,n,nt,e),function(e,t,n,a){e.addEnumToInterface({namespace:"Sweep",name:"Event",values:A.Event});const o=["",""],s=()=>o;n.subscribe(t.BeginMoveToSweepMessage,(async t=>{const n=await a;t.fromSweep&&t.fromSweep!==t.toSweep&&(o[0]=t.fromSweep?n.getIdFromCwfId(t.fromSweep):t.fromSweep,o[1]=n.getIdFromCwfId(t.toSweep),e.broadcast(A.Event.EXIT,s,t))})),n.subscribe(t.BeginSwitchViewmodeMessage,(n=>{n.fromMode===t.Viewmode.Panorama&&n.toMode!==t.Viewmode.Panorama&&(o[0]=r[1],o[1]=void 0,e.broadcast(A.Event.EXIT,s))}));const r=["",""],i=()=>r;n.subscribe(t.EndMoveToSweepMessage,(async t=>{const n=await a;r[0]=t.fromSweep?n.getIdFromCwfId(t.fromSweep):t.fromSweep,r[1]=n.getIdFromCwfId(t.toSweep),e.broadcast(A.Event.ENTER,i)}))}(Ze,n,nt,at),function(e,t,n,a){const o=X.create(a,new $(Ir,t,n));e.addEnumToInterface({namespace:"Sweep",name:"Transition",values:P}),e.addCommandToInterface({namespace:"Sweep",name:"moveTo",args:["sweep","options"]},o)}(Ze,n,nt,new z(Se,at,Pe)),function(e,t){const n=X.create(t,new $(Cr));e.addCommandToInterface({namespace:"Sweep.Conversion",name:"createIdMap",args:["invert"]},n);const a=X.create(t,new $(Ar));e.addCommandToInterface({namespace:"Sweep.Conversion",name:"getLabelFromId",args:["id"]},a)}(Ze,new z(Se));const t=z.getBuilder().addDependencies(Se,K,at,ot).addOptionals(ve).build();!function(e,t,n){const a=sa.create(n,new br,new $(Er,t.conversionUtils,t.sweepPlacementConverter));e.addCollectionToInterface({namespace:"Sweep",name:"data"},a)}(Ze,nt,t),function(e,t){const n=X.create(t,new $(Or)),a=X.create(t,new $(Dr));e.addCommandToInterface({namespace:"Sweep",name:"enable",args:["sweepIds"],varArg:!0},n),e.addCommandToInterface({namespace:"Sweep",name:"disable",args:["sweepIds"],varArg:!0},a)}(Ze,new z(Se,at)),function(e,t,n,a){const o=X.create(a,new $(Rr,t,n));e.addCommandToInterface({namespace:"Sweep",name:"addNeighbors",args:["sweepId","toAdd"]},o);const s=X.create(a,new $(Pr,t,n));e.addCommandToInterface({namespace:"Sweep",name:"removeNeighbors",args:["sweepId","toRemove"]},s)}(Ze,n,nt,new z(Se))}(),Zi(Ze,f),function(e){e.addEnumToInterface({namespace:"Tour",name:"PlayState",values:D.PlayState})}(Ze),function(e,t,n){e.addEnumToInterface({namespace:"Tour",name:"Event",values:D.Event}),n.subscribe(t.TourStartedMessage,(()=>e.broadcast(D.Event.STARTED))),n.subscribe(t.TourStoppedMessage,(()=>e.broadcast(D.Event.STOPPED))),n.subscribe(t.TourEndedMessage,(()=>e.broadcast(D.Event.ENDED)));const a=[-1],o=e=>(a[0]=e.index,a);n.subscribe(t.TourSteppedMessage,(t=>e.broadcast(D.Event.STEPPED,o,t)))}(Ze,n,nt),lc(Ze,n,nt,new z(Ue,Ce,Ie)),function(e,t){const n=de.create(t,new hc,new $(pc));e.addObservableToInterface({namespace:"Tour",name:"currentStep"},n)}(Ze,new z(Ce)),function(e,t,n){const a=de.create(n,new mc,new $(gc,t));e.addObservableToInterface({namespace:"Tour",name:"state"},a)}(Ze,nt,new z(Ce)),function(e,t){const n=de.create(t,new wc,new $(yc));e.addObservableToInterface({namespace:"Tour",name:"transition"},n)}(Ze,new z(Ce)),function(e,t,n){const a=X.create(n,new $(td,t)),o=X.create(n,new $(nd,t));e.addCommandToInterface({namespace:"App.Input",name:"disable",args:[]},a),e.addCommandToInterface({namespace:"App.Input",name:"enable",args:[]},o)}(Ze,{issueCommand:nt.issueCommand,DisableInputCommand:n.DisableInputCommand,EnableInputCommand:n.EnableInputCommand},new z),Ye&&Xe&&(Qc(Ze,f,nt,[Xe]),Ze.interruptCommands(new ed(We,Xe)))}dd.info("Showcase SDK interface version","25.11.2_webgl-1327-g527db53a6e");var ud=a.m;export{ud as setup};